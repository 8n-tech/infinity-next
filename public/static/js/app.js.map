{"version":3,"sources":["main.js","widgets/autoupdater.widget.js","widgets/board-favorite.widget.js","widgets/boardlist.widget.js","widgets/captcha.widget.js","widgets/config.widget.js","widgets/donate.widget.js","widgets/gnav.widget.js","widgets/instantclick.widget.js","widgets/js-config.widget.js","widgets/lazyimg.widget.js","widgets/notice.widget.js","widgets/permissions.widget.js","widgets/post.widget.js","widgets/postbox.widget.js","widgets/stylist.widget.js","widgets/time.widget.js"],"names":[],"mappings":"AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1oBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACngBA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1IA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC9dA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/CA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACxbA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AChKA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACzFA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC1PA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACnGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACjGA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC/1BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AC//BA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;ACpEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA","file":"app.js","sourcesContent":["/**\n * Widget Master\n */\n(function(window, $, undefined) {\n\tvar ib = window.ib = function() {};\n\n\t// Store existing Widgets.\n\tib.widgets = {};\n\n\t// Setup directional logic\n\tib.rtl = false;\n\tib.ltr = !ib.rtl;\n\n\t// Binding Widgets to DOM.\n\tib.bindAll = function(eventOrScope) {\n\t\tvar $scope;\n\n\t\tif (typeof eventOrScope !== \"undefined\")\n\t\t{\n\t\t\tif (typeof eventOrScope.target !== \"undefined\")\n\t\t\t{\n\t\t\t\t$scope = $(eventOrScope.target);\n\t\t\t}\n\t\t\telse if (eventOrScope instanceof jQuery)\n\t\t\t{\n\t\t\t\t$scope = eventOrScope;\n\t\t\t}\n\t\t\telse if (eventOrScope instanceof HTMLElement)\n\t\t\t{\n\t\t\t\t$scope = $(eventOrScope);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$scope = $(document);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$scope = $(document);\n\t\t}\n\n\t\tif ($scope instanceof jQuery)\n\t\t{\n\t\t\tif ($scope.is(\"[data-widget]\")) {\n\t\t\t\tib.bindElement($scope[0]);\n\t\t\t}\n\n\t\t\t$(\"[data-widget]\", $scope).each(function() {\n\t\t\t\tib.bindElement(this);\n\t\t\t});\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.log(\"ib.bindAll couldn't make sense of eventOrScope.\", eventOrScope);\n\t\t}\n\t},\n\n\tib.bindOnEvent = function(event) {\n\t\treturn ib.bindElement(this);\n\t},\n\n\tib.bindElement = function(dom) {\n\t\tvar requestedWidget = dom.getAttribute('data-widget');\n\n\t\tif (ib.widgets[requestedWidget])\n\t\t{\n\t\t\treturn ib.bindWidget(dom, ib.widgets[requestedWidget]);\n\t\t}\n\t\telse\n\t\t{\n\t\t\tconsole.log(\"Widget \\\"\"+requestedWidget+\"\\\" does not exist.\");\n\t\t}\n\t};\n\n\tib.bindWidget = function(dom, widget) {\n\t\tif (typeof dom.widget === \"undefined\")\n\t\t{\n\t\t\tdom.widget = new widget(window, jQuery);\n\t\t\tdom.widget.initOnce = false;\n\n\t\t\twidget.instances.push(dom.widget);\n\n\t\t\tif (typeof dom.widget.init === \"function\")\n\t\t\t{\n\t\t\t\tdom.widget.init(dom);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\twindow.ib.widgetArguments.call(dom.widget, [dom]);\n\t\t\t}\n\n\t\t\tdom.widget.initOnce = true;\n\t\t}\n\n\t\treturn dom.widget;\n\t};\n\n\t// Handle config searching.\n\t// This is site config, not user settings.\n\tib.config = function(name, configDefault) {\n\t\tif (typeof window.app !== \"undefined\" && typeof window.app[name] !== \"undefined\")\n\t\t{\n\t\t\treturn window.app[name];\n\t\t}\n\n\t\treturn configDefault;\n\t};\n\n\t// Translate a phrase.\n\tib.trans = function(phrase) {\n\t\t// Split a 'x.y.z' string into ['x','y','z']\n\t\tvar items = phrase instanceof Array ? phrase : phrase.split(\".\");\n\t\t// Point to the application language object-array.\n\t\tvar traverse = window.app.lang;\n\n\t\t// For each item in our phrase key, traverse down.\n\t\tfor (var i = 0; i < items.length; ++i)\n\t\t{\n\t\t\ttraverse = traverse[items[i]];\n\n\t\t\t// If we've hit an undefined point, bail out with an empty string.\n\t\t\tif (traverse === undefined)\n\t\t\t{\n\t\t\t\treturn \"\";\n\t\t\t}\n\t\t}\n\n\t\t// If we didn't come up with a string, bail out.\n\t\tif (typeof traverse !== \"string\")\n\t\t{\n\t\t\treturn \"\";\n\t\t}\n\n\t\treturn traverse;\n\t};\n\n\t// Lpad 5 into \"05\".\n\tib.lpad = function(n, width, z) {\n\t\tz = z || '0';\n\t\tn = n + '';\n\n\t\tif (n.length >= width)\n\t\t{\n\t\t\treturn n;\n\t\t}\n\n\t\treturn new Array(width - n.length + 1).join(z) + n;\n\t};\n\n\t// Generates a random string with alternating case.\n\tib.randomString = function(length) {\n\t\tlength = length || 8;\n\n\t\tvar text = \"\";\n\t\tvar possible = \"ABCDEFGHIJKLMNOPQRSTUVWXYZ\" +\n\t\t\t\"abcdefghijklmnopqrstuvwxyz\" +\n\t\t\t\"0123456789!@#$%^&*()\";\n\n\t\tfor (var i = 0; i < length; ++i)\n\t\t{\n\t\t\ttext += possible.charAt(Math.floor(Math.random() * possible.length));\n\t\t}\n\n\t\treturn text;\n\t};\n\n\t/**\n\t * Options and Settings\n\t */\n\tib.option = function(widget, params) {\n\t\tvar widget  = widget;\n\t\tvar name    = params.name;\n\t\tvar type    = params.type;\n\t\tvar initial = params.initial;\n\t\tvar values  = params.values;\n\n\t\tif (!this.validateWidget(widget)) {\n\t\t\tthrow \"ib.option :: widget \\\"\" + widget + \"\\\" not defined.\";\n\t\t}\n\t\tif (!this.validateName(name)) {\n\t\t\tthrow \"ib.option :: name \\\"\" + name + \"\\\" not valid.\";\n\t\t}\n\t\tif (!this.validateType(type)) {\n\t\t\tthrow \"ib.option :: type \\\"\" + type + \"\\\" not valid.\";\n\t\t}\n\n\t\tvar setting  = this;\n\t\tthis.name    = name;\n\t\tthis.initial = initial;\n\t\tthis.storage = \"ib.setting.\" + widget + \".\" + name;\n\t\tthis.type    = type;\n\t\tthis.values  = values;\n\t\tthis.widget  = widget;\n\n\t\t// Synchronize widgets on update\n\t\tthis.onUpdate(this.eventStorageUpdate);\n\t};\n\n\tib.option.prototype.eventInputChanged = function(event) {\n\t\tvar setting = event.data.setting;\n\t\tvar value;\n\n\t\tswitch (event.data.setting.type)\n\t\t{\n\t\t\tcase 'bool':\n\t\t\t\tvar checked = $(this).prop('checked');\n\t\t\t\tvalue = checked === \"on\" || checked == true ? 1 : 0;\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t\tvalue = this.value;\n\t\t\t\tbreak;\n\t\t}\n\n\t\t// Enforce data integrity if we have a whitelist.\n\t\tif (setting.values instanceof Array\n\t\t\t&& setting.values.indexOf(value) < 0)\n\t\t{\n\t\t\tevent.preventDefault();\n\t\t\treturn false;\n\t\t}\n\n\t\tsetting.set(value);\n\t};\n\n\tib.option.prototype.eventStorageUpdate = function(event) {\n\t\tif (event.originalEvent.key === event.data.setting.storage)\n\t\t{\n\t\t\tvar setting = event.data.setting;\n\t\t\tvar $input  = $(\"#js-config-\"+setting.widget+\"-\"+setting.name);\n\n\t\t\tswitch (setting.type)\n\t\t\t{\n\t\t\t\tcase 'bool':\n\t\t\t\t\t$input.prop('checked', setting.get() == \"1\");\n\t\t\t\t\tbreak;\n\n\t\t\t\tdefault:\n\t\t\t\t\t$input.val(setting.get());\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t};\n\n\tib.option.prototype.get = function() {\n\t\tvar value = localStorage.getItem(this.storage);\n\n\t\tif ((typeof value === \"undefined\" || value === null) && this.initial)\n\t\t{\n\t\t\tvalue = this.initial;\n\t\t}\n\n\t\tswitch (this.type)\n\t\t{\n\t\t\tcase 'bool' :\n\t\t\t\treturn value === \"1\" || value === 1 || value === true;\n\t\t\t\tbreak;\n\t\t}\n\n\t\treturn value;\n\t};\n\n\tib.option.prototype.getLabel = function() {\n\t\treturn ib.trans(this.widget + \".option.\" + this.name);\n\t};\n\n\tib.option.prototype.getName = function() {\n\t\treturn this.name;\n\t};\n\n\tib.option.prototype.getType = function() {\n\t\treturn this.type;\n\t};\n\n\tib.option.prototype.onUpdate = function(closure) {\n\t\tif (typeof closure !== \"function\") {\n\t\t\tthrow \"ib.option :: onUpdate not supplied a closure.\"\n\t\t}\n\n\t\t$(window).on('storage', { setting : this }, closure);\n\t};\n\n\tib.option.prototype.set = function(value) {\n\t\treturn localStorage.setItem(this.storage, value);\n\t};\n\n\tib.option.prototype.setInitial = function(overwrite) {\n\t\tvar value = localStorage.getItem(this.storage);\n\t\tvar isUndefined = (typeof value === \"undefined\" || value === null);\n\n\t\tif (overwrite === true || (isUndefined && this.initial))\n\t\t{\n\t\t\tvalue = this.initial;\n\t\t\tlocalStorage.setItem(this.storage, value);\n\t\t\tconsole.log(\"option.setInitial force writing \" + this.widget +\n\t\t\t\t\".\" + this.name + \" to \\\"\" + value + \"\\\".\");\n\t\t}\n\n\t\treturn value;\n\t};\n\n\tib.option.prototype.toHTML = function() {\n\t\tvar $html;\n\t\tvar value = this.get();\n\n\t\tswitch (this.type)\n\t\t{\n\t\t\tcase 'bool':\n\t\t\t\t$html = $(\"<input />\");\n\t\t\t\t$html.attr('type', \"checkbox\");\n\t\t\t\t$html.prop('checked', value);\n\t\t\t\tvalue = 1;\n\t\t\t\tbreak;\n\n\t\t\tcase 'int':\n\t\t\t\t$html = $(\"<input />\");\n\t\t\t\t$html.attr('type', \"number\");\n\t\t\t\tbreak;\n\n\t\t\tcase 'select':\n\t\t\t\t$html = $(\"<select></select>\");\n\n\t\t\t\tfor (var i = 0; i < this.values.length; ++i)\n\t\t\t\t{\n\t\t\t\t\tvar option = this.values[i];\n\t\t\t\t\toption = \"<option value=\\\"\"+option+\"\\\">\"+option+\"</option>\";\n\t\t\t\t\t$html.append(option);\n\t\t\t\t}\n\t\t\t\tbreak;\n\n\t\t\tcase 'string':\n\t\t\tcase 'text':\n\t\t\t\t$html = $(\"<input />\");\n\t\t\t\t$html.attr('type', \"text\");\n\t\t\t\tbreak;\n\n\t\t\tcase 'textarea':\n\t\t\t\t$html = $(\"<textarea></textarea>\");\n\t\t\t\tbreak;\n\n\t\t\tdefault:\n\t\t\t//case 'array':\n\t\t\t\t$html = $(\"<span></span>\")\n\t\t\t\tbreak;\n\n\t\t}\n\n\t\t$html.attr('id',    \"js-config-\"+this.widget+\"-\"+this.name);\n\t\t$html.attr('class', \"config-option\");\n\t\t$html.val(value);\n\t\t$html.on(\n\t\t\t'change',\n\t\t\t{ 'setting' : this },\n\t\t\tthis.eventInputChanged\n\t\t);\n\n\t\tif (typeof this.eventCustomInputChanged === \"function\")\n\t\t{\n\t\t\t$html.on(\n\t\t\t\t'change',\n\t\t\t\t{ 'setting' : this },\n\t\t\t\tthis.eventCustomInputChanged\n\t\t\t);\n\t\t}\n\n\t\treturn $html;\n\t};\n\n\tib.option.prototype.validateName = function(name) {\n\t\treturn typeof name === \"string\" && name.length > 0;\n\t};\n\n\tib.option.prototype.validateType = function(type) {\n\t\tswitch (type)\n\t\t{\n\t\t\tcase 'array'    :\n\t\t\tcase 'bool'     :\n\t\t\tcase 'int'      :\n\t\t\tcase 'select'   :\n\t\t\tcase 'string'   :\n\t\t\tcase 'text'     :\n\t\t\tcase 'textarea' :\n\t\t\t\treturn true;\n\t\t}\n\n\t\treturn false;\n\t};\n\n\tib.option.prototype.validateWidget = function(widget) {\n\t\treturn typeof ib.widgets[widget] === \"function\" || widget === \"main\";\n\t};\n\n\tib.settings = {\n\t\t// 'main' : {\n\t\t// \t'widgets' : new ib.option(\"main\", 'widgets', \"bool\")\n\t\t// }\n\t};\n\n\n\t// Setup new Widget class.\n\tib.widget = function(name, widget, options) {\n\t\tconsole.log(\"Declaring widget \\\"\"+name+\"\\\".\");\n\n\t\tif (ib.widgets[name] !== undefined)\n\t\t{\n\t\t\tconsole.log(\"Trying to re-declare widget \\\"\"+name+\"\\\".\");\n\t\t\treturn false;\n\t\t}\n\n\t\twidget.instances = [];\n\t\twidget.prototype.name = name;\n\t\tib.widgets[name] = widget;\n\n\t\tif (typeof options === \"object\")\n\t\t{\n\t\t\tif (typeof ib.settings[name] === \"undefined\")\n\t\t\t{\n\t\t\t\tib.settings[name] = {};\n\t\t\t}\n\n\t\t\tjQuery.each(options, function(optionName, optionParams)\n\t\t\t{\n\t\t\t\tvar optionData = {\n\t\t\t\t\twidget : name,\n\t\t\t\t\tname : optionName,\n\t\t\t\t\ttype : null,\n\t\t\t\t\tinitial : null,\n\t\t\t\t\tonChange : null,\n\t\t\t\t\tonUpdate : null\n\t\t\t\t};\n\n\t\t\t\tif (typeof optionParams === \"object\")\n\t\t\t\t{\n\t\t\t\t\toptionData = jQuery.extend(true, optionData, optionParams);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\toptionData.type = optionParams;\n\t\t\t\t}\n\n\t\t\t\t// Declare new option instance.\n\t\t\t\tvar option = new ib.option(name, optionData);\n\n\t\t\t\tib.settings[name][optionName] = option;\n\n\t\t\t\t// On HTML input change\n\t\t\t\tif (typeof optionParams.onChange === \"function\")\n\t\t\t\t{\n\t\t\t\t\toption.eventCustomInputChanged = optionParams.onChange;\n\t\t\t\t}\n\n\t\t\t\t// On option change in another tab\n\t\t\t\tif (typeof optionParams.onUpdate === \"function\")\n\t\t\t\t{\n\t\t\t\t\toption.onUpdate(optionParams.onUpdate);\n\t\t\t\t}\n\t\t\t});\n\t\t}\n\n\t\treturn true;\n\t};\n\n\t// Widget blueprint for instance extension.\n\tib.blueprint = function() { };\n\n\tib.blueprint.prototype.get = function(item) {\n\t\t// Does this widget have settings?\n\t\tif (typeof ib.settings[this.name] === \"undefined\")\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\t// Does this setting instance our option prototype?\n\t\tif (!(ib.settings[this.name][item] instanceof ib.option))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\n\t\treturn ib.settings[this.name][item].get();\n\t};\n\n\tib.blueprint.prototype.is = function(item) {\n\t\treturn !!this.get(item);\n\t};\n\n\t// This returns a non-referential copy of the blueprint for widget building.\n\tib.getBlueprint = function() {\n\t\tvar blueprint = function() { };\n\t\tblueprint.prototype = jQuery.extend(true, {}, ib.blueprint.prototype);\n\t\treturn blueprint;\n\t}\n\n\t// Returns all instances of a widget as jQuery.\n\tib.getInstances = function(widget) {\n\t\tvar instances  = ib.widgets[widget].instances;\n\t\tvar $instances = $();\n\n\t\tfor (var i = 0; i < instances.length; ++i)\n\t\t{\n\t\t\t$instances = $instances.add(instances[i].$widget);\n\t\t}\n\n\t\treturn $instances;\n\t};\n\n\tib.widgetArguments  = function(args) {\n\t\tvar widget  = this;\n\t\tvar target  = args[0];\n\t\tvar options = args[1];\n\n\t\tif (typeof options !== \"object\")\n\t\t{\n\t\t\toptions = {};\n\t\t}\n\n\t\twidget.options = $.extend(true, options, widget.defaults);\n\n\t\tif (typeof target !== \"string\" && $(target).length === 0)\n\t\t{\n\t\t\ttarget = widget.options.selector.widget;\n\t\t}\n\n\n\t\tvar $widget = widget.$widget = $(target).first();\n\n\t\tif ($widget.length)\n\t\t{\n\t\t\tif (typeof widget.can !== \"function\" || widget.can())\n\t\t\t{\n\t\t\t\tif (typeof widget.bind === \"object\")\n\t\t\t\t{\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\twidget.bind.widget.call(widget);\n\t\t\t\t\t}\n\t\t\t\t\tcatch (error)\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.error(\"Failed to initiate v1 widget!\", error);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse if (typeof widget.bind === \"function\")\n\t\t\t\t{\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\twidget.bind();\n\t\t\t\t\t}\n\t\t\t\t\tcatch (error)\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.error(\"Failed to initiate v2 widget!\", error);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\telse if (typeof widget.bind.failure === \"function\")\n\t\t\t{\n\t\t\t\twidget.bind.failure();\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t};\n\n\t// We handle widget binding in two ways, depending on browser support.\n\tif (typeof MutationObserver === \"function\")\n\t{\n\t\t// If the newer MutationObserver object exists, we can watch the DOM\n\t\t// for new elements and bind widgets immediately as they're conceived.\n\t\tib.observeMutation = function(records) {\n\t\t\t// This method must be EXTREMELY FAST as it is called on every\n\t\t\t// dom mutation as it happens.\n\t\t\tib.bindQueued();\n\n\t\t\tfor (var x = 0; x < records.length; ++x)\n\t\t\t{\n\t\t\t\tvar nodes = records[x].addedNodes;\n\n\t\t\t\tfor (var y = 0; y < nodes.length; ++y)\n\t\t\t\t{\n\t\t\t\t\tvar node = nodes[y];\n\n\t\t\t\t\tif (node.attributes && node.attributes['data-widget'])\n\t\t\t\t\t{\n\t\t\t\t\t\tib.bindWhenLoaded(node);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (document.readyState !== \"loading\")\n\t\t\t{\n\t\t\t\tib.mutationObserver.disconnect();\n\t\t\t}\n\t\t};\n\n\t\t// Widgets not fully loaded are queued for binding at a later time.\n\t\tib.queuedElements = [];\n\n\t\tib.bindWhenLoaded = function(node) {\n\t\t\tif (ib.widgetLoading(node))\n\t\t\t{\n\t\t\t\tib.queuedElements.push(node);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tib.bindElement(node);\n\t\t\t}\n\t\t};\n\n\t\tib.widgetLoading = function(node) {\n\t\t\tif (document.readyState !== \"loading\")\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\twhile(!node.nextSibling && node.parentNode)\n\t\t\t{\n\t\t\t\tnode = node.parentNode;\n\t\t\t}\n\n\t\t\treturn !node.nextSibling || (node.parentNode === document.body);\n\t\t};\n\n\t\tib.bindQueued = function() {\n\t\t\tvar queue = ib.queuedElements;\n\t\t\tib.queuedElements = [];\n\n\t\t\tfor (var i = 0; i < queue.length; ++i)\n\t\t\t{\n\t\t\t\tib.bindWhenLoaded(queue[i]);\n\t\t\t}\n\t\t};\n\n\t\tib.mutationObserver = new MutationObserver(ib.observeMutation);\n\t\tib.mutationObserver.observe(\n\t\t\tdocument.documentElement,\n\t\t\t{\n\t\t\t\tchildList : true,\n\t\t\t\tsubtree : true\n\t\t\t}\n\t\t);\n\t\t$(document).on('ready', ib.bindQueued);\n\t}\n\telse\n\t{\n\t\t// Otherwise, we must use jQuery after the document has loaded.\n\t\t$(document).on('ready', ib.bindAll);\n\t}\n\n\treturn ib;\n})(window, jQuery);\n","// ===========================================================================\n// Purpose          : Posts\n// Contributors     : jaw-sh\n// Widget Version   : 2\n// ===========================================================================\n\n(function(window, $, undefined) {\n\t// Widget blueprint\n\tvar blueprint = ib.getBlueprint();\n\t\n\tvar options = {};\n\t\n\tblueprint.prototype.defaults = {\n\t\t// Important class names.\n\t\tclassname : {\n\t\t\t'last-reply' : \"thread-last-reply\"\n\t\t},\n\t\t\n\t\t// Selectors for finding and binding elements.\n\t\tselector : {\n\t\t\t'enabled'        : \".autoupdater-enabled\",\n\t\t\t'timer'          : \".autoupdater-timer\",\n\t\t\t'force-update'   : \".autoupdater-update\",\n\t\t\t'updating'       : \".autoupdater-updating\",\n\t\t\t\n\t\t\t'cite'           : \"a.cite-post\",\n\t\t\t\n\t\t\t'thread-event-target' : \".thread:first\",\n\t\t\t'thread-reply'        : \".thread-reply\"\n\t\t},\n\t},\n\t\t\n\t// Update tracking\n\tblueprint.prototype.updating     = false;\n\tblueprint.prototype.updateTimer  = false;\n\tblueprint.prototype.updateURL    = false;\n\tblueprint.prototype.updateAsked  = false;\n\tblueprint.prototype.updateLast   = false;\n\tblueprint.prototype.updateMisses = 0;\n\t\n\t// Keeps track of what our last post was before we focused the window.\n\tblueprint.prototype.$lastPost    = null;\n\tblueprint.prototype.hasFocus     = false;\n\tblueprint.prototype.newReplies   = 0;\n\t\n\t// Keeps track of if we're scrolled to the bottom.\n\tblueprint.prototype.scrollLocked = false;\n\t\n\t// Returns the UNIX timestamp of our last received post.\n\tblueprint.prototype.getTimeFromPost = function($post) {\n\t\tvar $container = $post;\n\t\t\n\t\tif (!$container.is(\".post-container\"))\n\t\t{\n\t\t\t$container = $post.find(\".post-container:first\");\n\t\t}\n\t\t\n\t\tif (!$container.length)\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\t\n\t\tvar times = [0];\n\t\t\n\t\tif ($container.is(\"[data-created-at]\"))\n\t\t{\n\t\t\tvar createdAt = parseInt($container.attr('data-created-at'), 10);\n\t\t\t\n\t\t\tif (!isNaN(createdAt))\n\t\t\t{\n\t\t\t\ttimes.push(createdAt);\n\t\t\t}\n\t\t}\n\t\t\n\t\tif ($container.is(\"[data-deleted-at]\"))\n\t\t{\n\t\t\tvar deletedAt = parseInt($container.attr('data-deleted-at'), 10);\n\t\t\t\n\t\t\tif (!isNaN(deletedAt))\n\t\t\t{\n\t\t\t\ttimes.push(deletedAt);\n\t\t\t}\n\t\t}\n\t\t\n\t\tif ($container.is(\"[data-updated-at]\"))\n\t\t{\n\t\t\tvar updatedAt = parseInt($container.attr('data-updated-at'), 10);\n\t\t\t\n\t\t\tif (!isNaN(updatedAt))\n\t\t\t{\n\t\t\t\ttimes.push(updatedAt);\n\t\t\t}\n\t\t}\n\t\t\n\t\treturn Math.max.apply(Math, times);\n\t};\n\t\n\tblueprint.prototype.addYouPost = function(uri, id) {\n\t\tif (typeof window.localStorage !== \"object\")\n\t\t{\n\t\t\treturn [];\n\t\t}\n\t\t\n\t\ttry\n\t\t{\n\t\t\tvar storage = localStorage.getItem(\"yourPosts.\"+uri).split(\",\");\n\t\t}\n\t\tcatch (e)\n\t\t{\n\t\t\tvar storage = [];\n\t\t}\n\t\t\n\t\tstorage.push(id);\n\t\tstorage = storage.filter(function(index, item, array) {\n\t\t\treturn array.lastIndexOf(index) === item;\n\t\t});\n\t\t\n\t\tlocalStorage.setItem(\"yourPosts.\"+uri, storage.join(\",\"));\n\t};\n\t\n\tblueprint.prototype.bind = function() {\n\t\tvar widget  = this;\n\t\tvar $widget = this.$widget;\n\t\tvar data    = {\n\t\t\twidget  : widget,\n\t\t\t$widget : $widget\n\t\t};\n\t\t\n\t\t$(widget.options.selector['force-update'])\n\t\t\t.show();\n\t\t\n\t\t$(widget.options.selector['updating'])\n\t\t\t.hide();\n\t\t\n\t\t$(window)\n\t\t\t.on(\n\t\t\t\t'scroll.ib-au',\n\t\t\t\tdata,\n\t\t\t\twidget.events.windowScroll\n\t\t\t)\n\t\t\t.on(\n\t\t\t\t'focus.ib-au',\n\t\t\t\tdata,\n\t\t\t\twidget.events.windowFocus\n\t\t\t)\n\t\t\t.on(\n\t\t\t\t'blur.ib-au',\n\t\t\t\tdata,\n\t\t\t\twidget.events.windowUnfocus\n\t\t\t)\n\t\t;\n\t\t\n\t\t$widget\n\t\t\t.on(\n\t\t\t\t'click.ib-au',\n\t\t\t\twidget.options.selector['force-update'],\n\t\t\t\tdata,\n\t\t\t\twidget.events.updaterUpdateClick\n\t\t\t)\n\t\t\t.on(\n\t\t\t\t'au-update.ib-au',\n\t\t\t\tdata,\n\t\t\t\twidget.events.update\n\t\t\t)\n\t\t;\n\t\t\n\t\twidget.bindTimer();\n\t};\n\t\n\tblueprint.prototype.bindTimer = function() {\n\t\tvar widget       = this;\n\t\tvar $widget      = this.$widget;\n\t\tvar $lastReply   = $widget.prev();\n\t\twidget.$lastPost = $lastReply;\n\t\t\n\t\tif (!$lastReply.length)\n\t\t{\n\t\t\t// Select OP if we have no replies.\n\t\t\t$lastReply = $widget.parents( widget.options.selector['thread-event-target'] );\n\t\t\t\n\t\t\t// We don't want OP to be our last post.\n\t\t\twidget.$lastPost = null;\n\t\t}\n\t\t\n\t\twidget.updateLast = widget.getTimeFromPost($lastReply);\n\t\twidget.hasFocus   = document.hasFocus();\n\t\t\n\t\tvar url   = $widget.data('url');\n\t\t\n\t\tif (url)\n\t\t{\n\t\t\twidget.updateURL = url;\n\t\t\twidget.$widget.show();\n\t\t\t\n\t\t\tclearInterval(widget.updateTimer);\n\t\t\twidget.updateTimer = setInterval(function() {\n\t\t\t\twidget.updateInterval.apply(widget);\n\t\t\t}, 1000);\n\t\t}\n\t};\n\t\n\t// Events\n\tblueprint.prototype.events = {\n\t\tupdate : function(event) {\n\t\t\t// Calls the widget's update function with a contextual this.\n\t\t\tevent.data.widget.update.call(event.data.widget);\n\t\t},\n\t\t\n\t\tupdateComplete : function(json, textStatus, jqXHR) {\n\t\t\tvar widget = jqXHR.widget;\n\t\t\t\n\t\t\twidget.updating = false;\n\t\t\t\n\t\t\t$(widget.options.selector['force-update'])\n\t\t\t\t.show();\n\t\t\t$(widget.options.selector['updating'])\n\t\t\t\t.hide();\n\t\t\t\t\n\t\t\tclearInterval(widget.updateTimer);\n\t\t\twidget.updateTimer = setInterval(function() {\n\t\t\t\twidget.updateInterval.apply(widget);\n\t\t\t}, 1000);\n\t\t},\n\t\t\n\t\tupdateSuccess : function(json, textStatus, jqXHR, scrollIntoView) {\n\t\t\tvar widget       = jqXHR.widget;\n\t\t\tvar $widget      = widget.$widget;\n\t\t\tvar newPosts     = $();\n\t\t\tvar updatedPosts = $();\n\t\t\tvar deletedPosts = $();\n\t\t\tvar postData     = json;\n\t\t\t\n\t\t\t// This important event fire ensures that sibling data is intercepted.\n\t\t\tif (json.messenger)\n\t\t\t{\n\t\t\t\tpostData = json.data;\n\t\t\t\t$(window).trigger('messenger', json);\n\t\t\t}\n\t\t\t\n\t\t\tif (postData instanceof Array)\n\t\t\t{\n\t\t\t\t$.each(postData, function(index, reply)\n\t\t\t\t{\n\t\t\t\t\tvar $existingPost = $(\".post-container[data-post_id=\" + reply.post_id+\"]\");\n\t\t\t\t\t\n\t\t\t\t\tif ($existingPost.length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (reply.html !== null)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$newPost      = $(reply.html);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tvar existingUpdated = parseInt($existingPost.attr('data-updated-at'), 10),\n\t\t\t\t\t\t\t\tnewUpdated      = parseInt($newPost.attr('data-updated-at'), 10);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tif (isNaN(existingUpdated) || isNaN(newUpdated) || (newUpdated > existingUpdated))\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconsole.log(\"Autoupdater: Replacing \" + reply.post_id);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t$existingPost.replaceWith($newPost);\n\t\t\t\t\t\t\t\tib.bindAll($newPost[0]);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tupdatedPosts.push($newPost);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\twidget.updateLast = Math.max(widget.updateLast, widget.getTimeFromPost($newPost));\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconsole.log(\"Autoupdater: Deleting \" + reply.post_id);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t$existingPost.addClass('post-deleted');\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tupdatedPosts.push($existingPost);\n\t\t\t\t\t\t\tdeletedPosts.push($existingPost);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\twidget.updateLast = Math.max(widget.updateLast, widget.getTimeFromPost($existingPost));\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if(reply.html !== null)\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.log(\"Autoupdater: Inserting \" + reply.post_id);\n\t\t\t\t\t\t\n\t\t\t\t\t\t$newPost = $(\"<li class=\\\"thread-reply\\\"><article class=\\\"reply\\\">\"+reply.html+\"</article></li>\");\n\t\t\t\t\t\t$newPost.insertBefore($widget);\n\t\t\t\t\t\tib.bindAll($newPost);\n\t\t\t\t\t\t\n\t\t\t\t\t\tnewPosts.push($newPost);\n\t\t\t\t\t\t\n\t\t\t\t\t\twidget.updateLast = Math.max(widget.updateLast, widget.getTimeFromPost($newPost));\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Push this ID into our You lists if we made it.\n\t\t\t\t\t\tif (reply.recently_created)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\twidget.addYouPost(reply.board_uri, reply.board_id);\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\t// Used primarily by postbox updates to force the scroll to see our new post.\n\t\t\t\t\t\tif (scrollIntoView === true)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tif (typeof $newPost[0].scrollIntoViewIfNeeded !== \"undefined\")\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$newPost[0].scrollIntoViewIfNeeded({\n\t\t\t\t\t\t\t\t\tbehavior : \"smooth\",\n\t\t\t\t\t\t\t\t\tblock    : \"end\"\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse if (typeof $newPost[0].scrollIntoView !== \"undefined\")\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$newPost[0].scrollIntoView({\n\t\t\t\t\t\t\t\t\tbehavior : \"smooth\",\n\t\t\t\t\t\t\t\t\tblock    : \"end\"\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t\t\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\tif (newPosts.length)\n\t\t\t{\n\t\t\t\tif (!widget.hasFocus)\n\t\t\t\t{\n\t\t\t\t\twidget.newReplies += newPosts.length;\n\t\t\t\t}\n\t\t\t\telse if (widget.scrollLocked)\n\t\t\t\t{\n\t\t\t\t\twindow.scrollTo(0, document.body.scrollHeight);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\twidget.updateMisses = 0;\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t++widget.updateMisses;\n\t\t\t}\n\t\t\t\n\t\t\t$(window).trigger('au-updated', [{\n\t\t\t\t'newPosts'     : newPosts,\n\t\t\t\t'updatedPosts' : updatedPosts,\n\t\t\t\t'deletedPosts' : deletedPosts,\n\t\t\t}]);\n\t\t\t\n\t\t\twidget.updateLastReply();\n\t\t\t\n\t\t\treturn false;\n\t\t},\n\t\t\n\t\tupdaterUpdateClick : function(event) {\n\t\t\tvar widget  = event.data.widget;\n\t\t\tvar $widget = event.data.$widget;\n\t\t\tvar $timer  = $(widget.options.selector['timer'], $widget);\n\t\t\t\n\t\t\twidget.updateMisses = 0;\n\t\t\t$timer.attr('data-time', 5);\n\t\t\twidget.update();\n\t\t\t\n\t\t\tevent.preventDefault();\n\t\t\treturn false;\n\t\t},\n\t\t\n\t\twindowFocus : function(event) {\n\t\t\tvar widget  = event.data.widget;\n\t\t\tvar $widget = event.data.$widget;\n\t\t\t\n\t\t\twidget.hasFocus   = true;\n\t\t\twidget.$lastPost  = null;\n\t\t\twidget.newReplies = 0;\n\t\t\t\n\t\t\tdocument.title = $('<div/>').html(window.app.title).text();\n\t\t\t$(\"#favicon\").attr('href', window.app.favicon.normal);\n\t\t},\n\t\t\n\t\twindowUnfocus : function(event) {\n\t\t\tvar widget  = event.data.widget;\n\t\t\tvar $widget = event.data.$widget;\n\t\t\t\n\t\t\t// Sets our last seen post to the post immediately above the widget.\n\t\t\twidget.$lastPost    = widget.$widget.prev();\n\t\t\twidget.$lastPost    = widget.$lastPost.length ? widget.$lastPost : null;\n\t\t\twidget.hasFocus     = false;\n\t\t\twidget.scrollLocked = false;\n\t\t},\n\t\t\n\t\twindowScroll : function(event) {\n\t\t\tvar widget  = event.data.widget;\n\t\t\tvar $widget = event.data.$widget;\n\t\t\tvar $window = $(window);\n\t\t\t\n\t\t\t// Determine if the boundaries of this image are in the viewport.\n\t\t\t\n\t\t\tvar docViewTop    = $window.scrollTop();\n\t\t\tvar docViewBottom = docViewTop + $window.height();\n\t\t\t\n\t\t\tvar viewPad = 16;\n\t\t\t\n\t\t\tvar elemTop       = $widget.offset().top - viewPad;\n\t\t\tvar elemBottom    = elemTop + $widget.height() + viewPad;\n\t\t\t\n\t\t\t// We don't need the entire image to be present, just either edge.\n\t\t\t\n\t\t\t// If the top boundary is present\n\t\t\twidget.scrollLocked = (elemBottom <= docViewBottom) && (elemBottom >= docViewTop);\n\t\t}\n\t};\n\t\n\t// Main update trigger.\n\tblueprint.prototype.update = function() {\n\t\tvar widget  = this;\n\t\tvar $widget = this.widget;\n\t\t\n\t\tif (!widget.updating)\n\t\t{\n\t\t\t$(widget.options.selector['force-update'])\n\t\t\t\t.hide();\n\t\t\t\n\t\t\t$(widget.options.selector['updating'])\n\t\t\t\t.show();\n\t\t\t\n\t\t\tclearInterval(widget.updateTimer);\n\t\t\t\n\t\t\tvar jqXHR = $.ajax(widget.updateURL, {\n\t\t\t\tdata : {\n\t\t\t\t\t'updatesOnly'  : 1,\n\t\t\t\t\t'updateHtml'   : 1,\n\t\t\t\t\t'updatedSince' : widget.updateLast,\n\t\t\t\t\t'messenger'    : 1\n\t\t\t\t}\n\t\t\t});\n\t\t\t\n\t\t\tjqXHR.widget = widget;\n\t\t\tjqXHR.done(widget.events.updateSuccess)\n\t\t\tjqXHR.always(widget.events.updateComplete);\n\t\t\t\n\t\t\twidget.updating    = true;\n\t\t\twidget.updateTimer = false;\n\t\t\twidget.updateAsked = parseInt(parseInt(Date.now(), 10) / 1000, 10);\n\t\t}\n\t};\n\t\n\tblueprint.prototype.updateInterval = function() {\n\t\tvar widget  = this;\n\t\tvar $widget = this.$widget;\n\t\tclearInterval(widget.updateTimer);\n\t\t\n\t\tif ($(widget.options.selector['enabled']).is(\":checked\"))\n\t\t{\n\t\t\tvar $timer = $(widget.options.selector['timer'], widget.$widget);\n\t\t\tvar time   = parseInt($timer.attr('data-time'), 10);\n\t\t\t\n\t\t\tif (isNaN(time))\n\t\t\t{\n\t\t\t\ttime = 0;\n\t\t\t}\n\t\t\t\n\t\t\t--time;\n\t\t\t\n\t\t\tif (time <= 0)\n\t\t\t{\n\t\t\t\ttime = (widget.hasFocus ? widget.updateMisses * 2 : Math.pow(widget.updateMisses, 1.5)) + 3;\n\t\t\t\ttime = parseInt( Math.min(time, 30), 10);\n\t\t\t\t\n\t\t\t\t$widget.trigger('au-update');\n\t\t\t}\n\t\t\t\n\t\t\t$timer\n\t\t\t\t.text(time+'s')\n\t\t\t\t.attr('data-time', time);\n\t\t}\n\t\t\n\t\twidget.updateTimer = setInterval(function() {\n\t\t\twidget.updateInterval.apply(widget);\n\t\t}, 1000);\n\t};\n\t\n\tblueprint.prototype.updateLastReply = function() {\n\t\tvar widget  = this;\n\t\tvar $widget = this.$widget;\n\t\t\n\t\t// This corrects which post has the last reply class.\n\t\tif (widget.$lastPost !== null)\n\t\t{\n\t\t\twidget.$widget\n\t\t\t\t.siblings(\".\" + widget.options.classname['last-reply'])\n\t\t\t\t.removeClass(widget.options.classname['last-reply']);\n\t\t\t\n\t\t\t// If we have replies after this, add the border.\n\t\t\tif (widget.$lastPost.next(widget.options.selector['thread-reply']).length)\n\t\t\t{\n\t\t\t\twidget.$lastPost\n\t\t\t\t\t.addClass(widget.options.classname['last-reply']);\n\t\t\t}\n\t\t}\n\t\t\n\t\t// This corrects our favicon.\n\t\tif (widget.newReplies > 0)\n\t\t{\n\t\t\t$(\"#favicon\").attr('href', window.app.favicon.alert);\n\t\t\tdocument.title = \"(\" + widget.newReplies + \") \" + $('<div/>').html(window.app.title).text();\n\t\t}\n\t\telse\n\t\t{\n\t\t\t$(\"#favicon\").attr('href', window.app.favicon.normal);\n\t\t\tdocument.title = $('<div/>').html(window.app.title).text();\n\t\t}\n\t};\n\t\n\tib.widget(\"autoupdater\", blueprint, options);\n})(window, window.jQuery);\n","// ============================================================\n// Purpose                      : Board Favorites\n// Contributors                 : jaw-sh\n// ============================================================\n\nib.widget(\"board-favorite\", function(window, $, undefined) {\n\tvar widget = {\n\t\t\n\t\tcan :  function() {\n\t\t\tvar ls    = typeof localStorage === \"object\";\n\t\t\tvar board = widget.$widget.attr('data-board');\n\t\t\t\n\t\t\treturn ls && board;\n\t\t},\n\t\t\n\t\tfavorites : function() {\n\t\t\tvar storageItem = localStorage.getItem(widget.options.storage.favorites);\n\t\t\t\n\t\t\tif (typeof storageItem === \"string\")\n\t\t\t{\n\t\t\t\treturn storageItem.split(\",\");\n\t\t\t}\n\t\t\t\n\t\t\treturn [];\n\t\t},\n\t\t\n\t\tfavoriteThis : function( addFavorite ) {\n\t\t\tvar boards = widget.favorites();\n\t\t\t\n\t\t\tif (addFavorite)\n\t\t\t{\n\t\t\t\tboards.push(widget.board);\n\t\t\t\tboards = jQuery.unique(boards);\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tboards = jQuery.grep(boards, function(value) {\n\t\t\t\t\treturn value != widget.board;\n\t\t\t\t});\n\t\t\t}\n\t\t\t\n\t\t\tlocalStorage.setItem(widget.options.storage.favorites, boards);\n\t\t},\n\t\t\n\t\tdefaults : {\n\t\t\tclassname : {\n\t\t\t\t'favorited' : \"board-favorited\"\n\t\t\t},\n\t\t\t\n\t\t\tstorage   : {\n\t\t\t\t'favorites'      : \"ib.favorites\",\n\t\t\t\t'favorites-data' : \"ib.favoritedata\"\n\t\t\t},\n\t\t\t\n\t\t\tselector  : {\n\t\t\t\t'favorites-menu' : \"#favorite-boards\"\n\t\t\t}\n\t\t},\n\t\t\n\t\t// Events\n\t\tevents   : {\n\t\t\t\n\t\t\tfavoriteChange : function(event) {\n\t\t\t\tvar favorites = widget.favorites();\n\t\t\t\t\n\t\t\t\tfor (var i = 0; i < favorites.length; ++i)\n\t\t\t\t{\n\t\t\t\t\tif (widget.board == favorites[i])\n\t\t\t\t\t{\n\t\t\t\t\t\twidget.$widget.addClass(widget.options.classname.favorited);\n\t\t\t\t\t\treturn true;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\twidget.$widget.removeClass(widget.options.classname.favorited);\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\t\n\t\t\tfavoriteClick : function(event) {\n\t\t\t\twidget.favoriteThis( !widget.$widget.hasClass(widget.options.classname.favorited) );\n\t\t\t\twidget.events.favoriteChange.call(this, event);\n\t\t\t\twidget.events.favoriteUpdate.call(this, event);\n\t\t\t},\n\t\t\t\n\t\t\tfavoriteUpdate : function(event) {\n\t\t\t\t$.get(window.app.url+\"/board-details.json\", {\n\t\t\t\t\t'boards' : widget.favorites()\n\t\t\t\t}).done(function(response) {\n\t\t\t\t\t\n\t\t\t\t\tlocalStorage.setItem(\n\t\t\t\t\t\twidget.options.storage['favorites-data'],\n\t\t\t\t\t\tJSON.stringify(response)\n\t\t\t\t\t);\n\t\t\t\t\t\n\t\t\t\t\t$(widget.options.selector['favorites-menu'])\n\t\t\t\t\t\t.trigger('build');\n\t\t\t\t\t\n\t\t\t\t});\n\t\t\t},\n\t\t\t\n\t\t\t// This is an HTML localStorage event.\n\t\t\t// it only fires if ANOTHER WINDOW trips the change.\n\t\t\tstorage : function(event) {\n\t\t\t\tif (event.originalEvent.key == widget.options.storage.favorites)\n\t\t\t\t{\n\t\t\t\t\twidget.events.favoriteChange();\n\t\t\t\t}\n\t\t\t}\n\t\t\t\n\t\t},\n\t\t\n\t\t// Event bindings\n\t\tbind     : {\n\t\t\tfailure : function() {\n\t\t\t\twidget.$widget.hide();\n\t\t\t},\n\t\t\t\n\t\t\twidget  : function() {\n\t\t\t\twidget.board = widget.$widget.attr('data-board');\n\t\t\t\t\n\t\t\t\twidget.$widget\n\t\t\t\t\t.css('display', 'inline-block')\n\t\t\t\t\t.on( 'click.ib-board-favorite', widget.events.favoriteClick )\n\t\t\t\t;\n\t\t\t\t\n\t\t\t\t$(window)\n\t\t\t\t\t.on( 'storage.ib-board-favorite', widget.events.storage )\n\t\t\t\t;\n\t\t\t\t\n\t\t\t\twidget.events.favoriteChange();\n\t\t\t}\n\t\t}\n\t\t\n\t};\n\t\n\treturn widget;\n});\n\n","// ============================================================\n// Purpose                      : Board directory handling\n// Contributors                 : jaw-sh\n// ============================================================\n\nib.widget(\"boardlist\", function(window, $, undefined) {\n\tvar widget = {\n\t\t\n\t\t// The default values that are set behind init values.\n\t\tdefaults : {\n\t\t\t\n\t\t\tsearchUrl  : \"/boards.html\",\n\t\t\t\n\t\t\t// Selectors for finding and binding elements.\n\t\t\tselector   : {\n\t\t\t\t'board-head'    : \".board-list-head\",\n\t\t\t\t'board-body'    : \".board-list-tbody\",\n\t\t\t\t'board-loading' : \".board-list-loading\",\n\t\t\t\t'board-omitted' : \".board-list-omitted\",\n\t\t\t\t\n\t\t\t\t'search'        : \"#search-form\",\n\t\t\t\t'search-lang'   : \"#search-lang-input\",\n\t\t\t\t'search-sfw'    : \"#search-sfw-input\",\n\t\t\t\t'search-tag'    : \"#search-tag-input\",\n\t\t\t\t'search-title'  : \"#search-title-input\",\n\t\t\t\t'search-submit' : \"#search-submit\",\n\t\t\t\t\n\t\t\t\t'tag-list'      : \".tag-list\",\n\t\t\t\t'tag-link'      : \".tag-link\",\n\t\t\t\t\n\t\t\t\t'sortable'      : \"th.sortable\",\n\t\t\t\t\n\t\t\t\t'footer-page'   : \".board-page-num\",\n\t\t\t\t'footer-count'  : \".board-page-count\",\n\t\t\t\t'footer-total'  : \".board-page-total\",\n\t\t\t\t'footer-more'   : \"#board-list-more\"\n\t\t\t},\n\t\t\t\n\t\t\t// HTML Templates for dynamic construction\n\t\t\ttemplates   : {\n\t\t\t\t// Board row item\n\t\t\t\t'board-row'          : \"<tr></tr>\",\n\t\t\t\t\n\t\t\t\t// Individual cell definitions\n\t\t\t\t'board-cell-meta'    : \"<td class=\\\"board-meta\\\"></td>\",\n\t\t\t\t'board-cell-uri'     : \"<td class=\\\"board-uri\\\"></td>\",\n\t\t\t\t'board-cell-title'   : \"<td class=\\\"board-title\\\"></td>\",\n\t\t\t\t'board-cell-stats_pph'          : \"<td class=\\\"board-pph\\\"></td>\",\n\t\t\t\t'board-cell-stats_ppd'          : \"<td class=\\\"board-ppd\\\"></td>\",\n\t\t\t\t'board-cell-stats_plh'          : \"<td class=\\\"board-plh\\\"></td>\",\n\t\t\t\t'board-cell-stats_active_users' : \"<td class=\\\"board-unique\\\"></td>\",\n\t\t\t\t'board-cell-posts_total'        : \"<td class=\\\"board-max\\\"></td>\",\n\t\t\t\t'board-cell-active'  : \"<td class=\\\"board-unique\\\"></td>\",\n\t\t\t\t'board-cell-tags'    : \"<td class=\\\"board-tags\\\"></td>\",\n\t\t\t\t\n\t\t\t\t// Content wrapper\n\t\t\t\t// Used to help constrain contents to their <td>.\n\t\t\t\t'board-content-wrap' : \"<p class=\\\"board-cell\\\"></p>\",\n\t\t\t\t\n\t\t\t\t// Individual items or parts of a single table cell.\n\t\t\t\t'board-datum-fav'    : \"<i class=\\\"board-favorite fa fa-star\\\" data-widget=\\\"board-favorite\\\"></i>\",\n\t\t\t\t'board-datum-lang'   : \"<span class=\\\"board-lang\\\"></span>\",\n\t\t\t\t'board-datum-uri'    : \"<a class=\\\"board-link\\\"></a>\",\n\t\t\t\t'board-datum-sfw'    : \"<i class=\\\"fa fa-briefcase board-sfw\\\" title=\\\"SFW\\\"></i>\",\n\t\t\t\t'board-datum-nsfw'   : \"<i class=\\\"fa fa-briefcase board-nsfw\\\" title=\\\"NSFW\\\"></i>\",\n\t\t\t\t'board-datum-tags'   : \"<a class=\\\"tag-link\\\" href=\\\"#\\\"></a>\",\n\t\t\t\t\n\t\t\t\t\n\t\t\t\t// Tag list.\n\t\t\t\t'tag-list'           : \"<ul class=\\\"tag-list\\\"></ul>\",\n\t\t\t\t'tag-item'           : \"<li class=\\\"tag-item\\\"></li>\",\n\t\t\t\t'tag-link'           : \"<a class=\\\"tag-link\\\" href=\\\"#\\\"></a>\"\n\t\t\t}\n\t\t},\n\t\t\n\t\tlastSearch : {},\n\t\t\n\t\tbind : {\n\t\t\tform : function() {\n\t\t\t\tvar selectors = widget.options.selector;\n\t\t\t\t\n\t\t\t\tvar $search       = $( selectors['search'] );\n\t\t\t\tvar $searchLang   = $( selectors['search-lang'] );\n\t\t\t\tvar $searchSfw    = $( selectors['search-sfw'] );\n\t\t\t\tvar $searchTag    = $( selectors['search-tag'] );\n\t\t\t\tvar $searchTitle  = $( selectors['search-title'] );\n\t\t\t\tvar $searchSubmit = $( selectors['search-submit'] );\n\t\t\t\t\n\t\t\t\tvar searchForms   = {\n\t\t\t\t\t\t'boardlist'    : widget.$widget,\n\t\t\t\t\t\t'search'       : $search,\n\t\t\t\t\t\t'searchLang'   : $searchLang,\n\t\t\t\t\t\t'searchSfw'    : $searchSfw,\n\t\t\t\t\t\t'searchTag'    : $searchTag,\n\t\t\t\t\t\t'searchTitle'  : $searchTitle,\n\t\t\t\t\t\t'searchSubmit' : $searchSubmit\n\t\t\t\t\t};\n\t\t\t\t\n\t\t\t\tif ($search.length > 0)\n\t\t\t\t{\n\t\t\t\t\t// Bind form events.\n\t\t\t\t\twidget.$widget\n\t\t\t\t\t\t// Sort column\n\t\t\t\t\t\t.on( 'click',  selectors['sortable'], searchForms, widget.events.sortClick )\n\t\t\t\t\t\t// Load more\n\t\t\t\t\t\t.on( 'click',  selectors['board-omitted'], searchForms, widget.events.loadMore )\n\t\t\t\t\t\t// Tag click\n\t\t\t\t\t\t.on( 'click',  selectors['tag-link'], searchForms, widget.events.tagClick )\n\t\t\t\t\t\t// Form Submission\n\t\t\t\t\t\t.on( 'submit', selectors['search'], searchForms, widget.events.searchSubmit )\n\t\t\t\t\t\t// Submit click\n\t\t\t\t\t\t.on( 'click',  selectors['search-submit'], searchForms, widget.events.searchSubmit );\n\t\t\t\t\t\n\t\t\t\t\t$(window)\n\t\t\t\t\t\t.on( 'hashchange', searchForms, widget.events.hashChange );\n\t\t\t\t\t\n\t\t\t\t\t$searchSubmit.prop( 'disabled', false );\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\twidget : function() {\n\t\t\t\t\n\t\t\t\t// Parse ?GET parameters into lastSearch object.\n\t\t\t\tif (window.location.search != \"\" && window.location.search.length > 0)\n\t\t\t\t{\n\t\t\t\t\t// ?a=1&b=2 -> a=1&b=2 -> { a : 1, b : 2 }\n\t\t\t\t\twindow.location.search.substr(1).split(\"&\").forEach( function(item) {\n\t\t\t\t\t\twidget.lastSearch[item.split(\"=\")[0]] = item.split(\"=\")[1];\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t$( widget.options.selector['board-loading'], widget.$widget ).hide();\n\t\t\t\t\n\t\t\t\twidget.bind.form();\n\t\t\t\t\n\t\t\t\tif (window.location.hash != \"\")\n\t\t\t\t{\n\t\t\t\t\t$(window).trigger( 'hashchange' );\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\n\t\tbuild  : {\n\t\t\tboardlist : function(data) {\n\t\t\t\twidget.build.boards(data['boards']);\n\t\t\t\twidget.build.lastSearch(data['search']);\n\t\t\t\twidget.build.footer(data);\n\t\t\t\twidget.build.tags(data['tagWeight']);\n\t\t\t},\n\t\t\t\n\t\t\tboards : function(boards) {\n\t\t\t\t// Find our head, columns, and body.\n\t\t\t\tvar $head = $( widget.options.selector['board-head'], widget.$widget );\n\t\t\t\tvar $cols = $(\"[data-column]\", $head );\n\t\t\t\tvar $body = $( widget.options.selector['board-body'], widget.$widget );\n\t\t\t\t\n\t\t\t\t$.each( boards, function( index, board ) {\n\t\t\t\t\tvar row  = board;\n\t\t\t\t\tvar $row = $( widget.options.templates['board-row'] );\n\t\t\t\t\t\n\t\t\t\t\t$cols.each( function( index, col ) {\n\t\t\t\t\t\twidget.build.board( row, col ).appendTo( $row );\n\t\t\t\t\t} );\n\t\t\t\t\t\n\t\t\t\t\tib.bindAll( $row.appendTo( $body ) );\n\t\t\t\t} );\n\t\t\t\t\n\t\t\t},\n\t\t\t\n\t\t\tboard : function(row, col) {\n\t\t\t\tvar $col   = $(col);\n\t\t\t\tvar column = $col.attr('data-column');\n\t\t\t\tvar value  = row[column];\n\t\t\t\tvar $cell  = $( widget.options.templates['board-cell-' + column] );\n\t\t\t\tvar $wrap  = $( widget.options.templates['board-content-wrap'] );\n\t\t\t\t\n\t\t\t\tif (typeof widget.build.boardcell[column] === \"undefined\")\n\t\t\t\t{\n\t\t\t\t\tif (value instanceof Array)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (typeof widget.options.templates['board-datum-' + column] !== \"undefined\")\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$.each( value, function( index, singleValue )\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t$( widget.options.templates['board-datum-' + column] )\n\t\t\t\t\t\t\t\t\t.text( singleValue )\n\t\t\t\t\t\t\t\t\t.appendTo( $wrap );\n\t\t\t\t\t\t\t} );\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t$wrap.text( value.join(\" \") );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\t$wrap.text( value );\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tvar $content = widget.build.boardcell[column]( row, value );\n\t\t\t\t\t\n\t\t\t\t\tif ($content instanceof jQuery)\n\t\t\t\t\t{\n\t\t\t\t\t\tif ($content.is(\".\" + $wrap[0].class)) {\n\t\t\t\t\t\t\t// Our new content has the same classes as the wrapper.\n\t\t\t\t\t\t\t// Replace the old wrapper.\n\t\t\t\t\t\t\t$wrap = $content;\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\t// We use .append() instead of .appendTo() as we do elsewhere\n\t\t\t\t\t\t\t// because $content can be multiple elements.\n\t\t\t\t\t\t\t$wrap.append( $content );\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t\telse if (typeof $content === \"string\")\n\t\t\t\t\t{\n\t\t\t\t\t\t$wrap.html( $content );\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.log(\"Special cell constructor returned a \" + (typeof $content) + \" that board-directory.js cannot interpret.\");\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t$wrap.appendTo( $cell );\n\t\t\t\treturn $cell;\n\t\t\t},\n\t\t\t\n\t\t\tboardcell : {\n\t\t\t\t'meta' : function(row, value) {\n\t\t\t\t\treturn $( widget.options.templates['board-datum-lang'] ).text( row['locale'] );\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t'uri'  : function(row, value) {\n\t\t\t\t\tvar $fav  = $( widget.options.templates['board-datum-fav'] );\n\t\t\t\t\tvar $link = $( widget.options.templates['board-datum-uri'] );\n\t\t\t\t\tvar $sfw  = $( widget.options.templates['board-datum-' + (row['is_worksafe'] == 1 ? \"sfw\" : \"nsfw\")] );\n\t\t\t\t\t\n\t\t\t\t\t$fav\n\t\t\t\t\t\t.attr( 'data-board', row['board_uri'] );\n\t\t\t\t\t\n\t\t\t\t\t$link\n\t\t\t\t\t\t.attr( 'href', window.app.url + \"/\" + row['board_uri'] + \"/\" )\n\t\t\t\t\t\t.text( \"/\"+row['board_uri']+\"/\" );\n\t\t\t\t\t\n\t\t\t\t\t// I decided against NSFW icons because it clutters the index.\n\t\t\t\t\t// Blue briefcase = SFW. No briefcase = NSFW. Seems better.\n\t\t\t\t\treturn $fav[0].outerHTML + $link[0].outerHTML + (row['is_worksafe'] == 1 ? $sfw[0].outerHTML : \"\");\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t'active' : function(row, value) {\n\t\t\t\t\treturn $( widget.options.templates['board-datum-pph'] )\n\t\t\t\t\t\t.attr( 'title', function(index, value) {\n\t\t\t\t\t\t\treturn value.replace(\"%1\", row['stats_pph']).replace(\"%2\", row['pph_average']);\n\t\t\t\t\t\t} )\n\t\t\t\t\t\t.text( row['stats_pph'] );\n\t\t\t\t},\n\t\t\t\t\n\t\t\t\t'tags'  : function(row, value) {\n\t\t\t\t\tvar $datum = $( widget.options.templates['board-datum-tags'] )\n\t\t\t\t\t\n\t\t\t\t\t$.each( value, function( index, singleValue )\n\t\t\t\t\t{\n\t\t\t\t\t\t$( widget.options.templates['board-datum-tags'] )\n\t\t\t\t\t\t\t.text( singleValue.tag )\n\t\t\t\t\t\t\t.appendTo( $datum );\n\t\t\t\t\t} );\n\t\t\t\t\t\n\t\t\t\t\treturn $datum;\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\tlastSearch : function(search) {\n\t\t\t\t\n\t\t\t\treturn widget.lastSearch = { \n\t\t\t\t\t'lang'  : search.lang === false ? \"\" : search.lang,\n\t\t\t\t\t'page'  : search.page,\n\t\t\t\t\t'tags'  : search.tags === false ? \"\" : search.tags.join(\" \"),\n\t\t\t\t\t'time'  : search.time,\n\t\t\t\t\t'title' : search.title === false ? \"\" : search.title,\n\t\t\t\t\t'sfw'   : search.sfw ? 1 : 0,\n\t\t\t\t\t\n\t\t\t\t\t'sort'   : search.sort ? search.sort : null,\n\t\t\t\t\t'sortBy' : search.sortBy == \"asc\" ? \"asc\" : \"desc\"\n\t\t\t\t};\n\t\t\t},\n\t\t\t\n\t\t\tfooter : function(data) {\n\t\t\t\tvar selector = widget.options.selector;\n\t\t\t\tvar $page    = $( selector['footer-page'], widget.$widget );\n\t\t\t\tvar $count   = $( selector['footer-count'], widget.$widget );\n\t\t\t\tvar $total   = $( selector['footer-total'], widget.$widget );\n\t\t\t\tvar $more    = $( selector['footer-more'], widget.$widget );\n\t\t\t\tvar $omitted = $( selector['board-omitted'], widget.$widget );\n\t\t\t\t\n\t\t\t\tvar count    = (data['current_page'] * data['per_page']);\n\t\t\t\tvar total    = data['total'];\n\t\t\t\tvar omitted  = data['omitted'];\n\t\t\t\t\n\t\t\t\t//$page.text( data['search']['page'] * data['per_page']);\n\t\t\t\t$count.text( data['current_page'] * data['per_page'] );\n\t\t\t\t$total.text( total );\n\t\t\t\t$more.toggleClass( \"board-list-hasmore\", omitted > 0 );\n\t\t\t\t$omitted.toggle( omitted > 0 );\n\t\t\t\t$omitted.attr('data-page', data['page']);\n\t\t\t},\n\t\t\t\n\t\t\ttags : function(tags) {\n\t\t\t\tvar selector = widget.options.selector;\n\t\t\t\tvar template = widget.options.template;\n\t\t\t\tvar $list    = $( selector['tag-list'], widget.$widget );\n\t\t\t\t\n\t\t\t\tif ($list.length && tags instanceof Object)\n\t\t\t\t{\n\t\t\t\t\t$.each( tags, function(tag, weight) {\n\t\t\t\t\t\tvar $item = $( template['tag-item'] );\n\t\t\t\t\t\tvar $link = $( template['tag-link'] );\n\t\t\t\t\t\t\n\t\t\t\t\t\t$link\n\t\t\t\t\t\t\t.css( 'font-size', weight+\"%\" )\n\t\t\t\t\t\t\t.text( tag.tag )\n\t\t\t\t\t\t\t.appendTo( $item );\n\t\t\t\t\t\t\n\t\t\t\t\t\t$item.appendTo( $list );\n\t\t\t\t\t} );\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\n\t\tevents : {\n\t\t\tsortClick : function(event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\t\n\t\t\t\tvar $th       = $(this);\n\t\t\t\tvar sort       = $th.attr('data-column');\n\t\t\t\tvar sortBy     = \"desc\";\n\t\t\t\tvar parameters = $.extend( {}, widget.lastSearch );\n\t\t\t\t\n\t\t\t\tif ($th.hasClass(\"sorting-by-desc\")) {\n\t\t\t\t\tsortBy = \"asc\";\n\t\t\t\t}\n\t\t\t\telse if ($th.hasClass(\"sorting-by-asc\")) {\n\t\t\t\t\tsort   = false;\n\t\t\t\t\tsortBy = false;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t$( widget.options.selector['tag-list'], widget.$widget ).html(\"\");\n\t\t\t\t$( widget.options.selector['board-body'], widget.$widget ).html(\"\");\n\t\t\t\t\n\t\t\t\t$(\".sorting-by-asc, .sorting-by-desc\")\n\t\t\t\t\t.removeClass(\"sorting-by-asc sorting-by-desc\");\n\t\t\t\t\n\t\t\t\t$th.toggleClass(\"sorting-by-desc\", sortBy == \"desc\");\n\t\t\t\t$th.toggleClass(\"sorting-by-asc\",  sortBy == \"asc\");\n\t\t\t\t\n\t\t\t\tparameters.page   = 1;\n\t\t\t\tparameters.sort   = sort;\n\t\t\t\tparameters.sortBy = sortBy;\n\t\t\t\t\n\t\t\t\tif (sort === false || sortBy === false)\n\t\t\t\t{\n\t\t\t\t\tdelete parameters.sort;\n\t\t\t\t\tdelete parameters.sortBy;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\twidget.submit( parameters );\n\t\t\t\t\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\t\n\t\t\tloadMore : function(event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\t\n\t\t\t\tvar parameters = $.extend( {}, widget.lastSearch );\n\t\t\t\t\n\t\t\t\tparameters.page = parseInt(parameters.page, 10);\n\t\t\t\t\n\t\t\t\tif (isNaN(parameters.page))\n\t\t\t\t{\n\t\t\t\t\tparameters.page = 1;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t++parameters.page;\n\t\t\t\t\n\t\t\t\tif (parameters.page === 1)\n\t\t\t\t{\n\t\t\t\t\t++parameters.page;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\twidget.submit( parameters );\n\t\t\t\t\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\t\n\t\t\thashChange : function(event) {\n\t\t\t\tif (window.location.hash != \"\")\n\t\t\t\t{\n\t\t\t\t\t// Turns \"#porn,tits\" into \"porn tits\" for easier search results.\n\t\t\t\t\tvar tags = window.location.hash.substr(1, window.location.hash.length).split(\",\");\n\t\t\t\t\tvar hash = tags.join(\" \");\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tvar tags = [];\n\t\t\t\t\tvar hash = \"\";\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t$( widget.options.selector['search-tag'], widget.$widget ).val( hash );\n\t\t\t\t$( widget.options.selector['tag-list'], widget.$widget ).html(\"\");\n\t\t\t\t$( widget.options.selector['board-body'], widget.$widget ).html(\"\");\n\t\t\t\t\n\t\t\t\twidget.submit( { 'tags' : tags } );\n\t\t\t\t\n\t\t\t\treturn true;\n\t\t\t},\n\t\t\t\n\t\t\tsearchSubmit : function(event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\t\n\t\t\t\t$( widget.options.selector['tag-list'], widget.$widget ).html(\"\");\n\t\t\t\t$( widget.options.selector['board-body'], widget.$widget ).html(\"\");\n\t\t\t\t\n\t\t\t\twidget.submit( { \n\t\t\t\t\t'lang'  : event.data.searchLang.val(),\n\t\t\t\t\t'tags'  : event.data.searchTag.val(),\n\t\t\t\t\t'title' : event.data.searchTitle.val(),\n\t\t\t\t\t'sfw'   : event.data.searchSfw.prop('checked') ? 1 : 0\n\t\t\t\t} );\n\t\t\t\t\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\t\n\t\t\ttagClick : function(event) {\n\t\t\t\tevent.preventDefault();\n\t\t\t\t\n\t\t\t\tvar $this  = $(this),\n\t\t\t\t\t$input = $( widget.options.selector['search-tag'] );\n\t\t\t\t\n\t\t\t\t$input\n\t\t\t\t\t.val( ( $input.val() + \" \" + $this.text() ).replace(/\\s+/g, \" \").trim() )\n\t\t\t\t\t.trigger( 'change' )\n\t\t\t\t\t.focus();\n\t\t\t\t\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\t\t\n\t\tsubmit : function( data ) {\n\t\t\tvar $boardlist    = widget.$widget;\n\t\t\tvar $boardload    = $( widget.options.selector['board-loading'], $boardlist );\n\t\t\tvar $searchSubmit = $( widget.options.selector['search-submit'], $boardlist );\n\t\t\tvar $footerMore   = $( widget.options.selector['board-omitted'], $boardlist );\n\t\t\t\n\t\t\t$searchSubmit.prop( 'disabled', true );\n\t\t\t$boardload.css('display', 'table-row');\n\t\t\t$footerMore.hide();\n\t\t\t\n\t\t\treturn jQuery.ajax({\n\t\t\t\t\ttype:        \"GET\",\n\t\t\t\t\tmethod:      \"GET\",\n\t\t\t\t\turl:         widget.options.searchUrl,\n\t\t\t\t\tdata:        data,\n\t\t\t\t\tdataType:    \"json\",\n\t\t\t\t\tcontentType: \"application/json; charset=utf-8\"\n\t\t\t\t})\n\t\t\t\t.done(function(data) {\n\t\t\t\t\t$searchSubmit.prop( 'disabled', false );\n\t\t\t\t\t$boardload.hide();\n\t\t\t\t\t\n\t\t\t\t\twidget.build.boardlist( data );\n\t\t\t\t});\n\t\t}\n\t};\n\t\n\treturn widget;\n} );","/**\n * Captcha widget\n */\nib.widget(\"captcha\", function(window, $, undefined) {\n\tvar widget = {\n\t\t\n\t\t// The default values that are set behind init values.\n\t\tdefaults : {\n\t\t\t\n\t\t\tcaptchaUrl    : \"/cp/captcha\",\n\t\t\treloadUrl     : \"/cp/captcha/replace.json\",\n\t\t\t\n\t\t\t// Selectors for finding and binding elements.\n\t\t\tselector : {\n\t\t\t\t'captcha'         : \".captcha\",\n\t\t\t}\n\t\t},\n\t\t\n\t\t// Events\n\t\tevents   : {\n\t\t\tcaptchaAjaxFail : function(jqXHR, textStatus, errorThrown) {\n\t\t\t\tif (jqXHR.status == 429) {\n\t\t\t\t\t// Retry again in a second.\n\t\t\t\t\tsetTimeout(function() {\n\t\t\t\t\t\twidget.events.captchaReload();\n\t\t\t\t\t}, 1000);\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\tcaptchaLoad : function(event) {\n\t\t\t\tvar $captcha = $(this),\n\t\t\t\t\t$parent  = $captcha.parent();\n\t\t\t\t\n\t\t\t\t$parent.removeClass(\"captcha-loading\");\n\t\t\t},\n\t\t\t\n\t\t\tcaptchaLoadIn : function(event, captcha) {\n\t\t\t\tvar $captcha = $(widget.options.selector['captcha'], widget.$widget),\n\t\t\t\t\t$hidden  = $captcha.next();\n\t\t\t\t\n\t\t\t\t$captcha.attr('src', widget.options.captchaUrl + \"/\" + captcha['hash_string'] + \".png\");\n\t\t\t\t$hidden.val(captcha['hash_string']);\n\t\t\t},\n\t\t\t\n\t\t\tcaptchaReload : function() {\n\t\t\t\tvar $captcha = $(widget.options.selector['captcha'], widget.$widget),\n\t\t\t\t\t$parent  = $captcha.parent(),\n\t\t\t\t\t$field   = $captcha.parent().children(\"input\");\n\t\t\t\t\n\t\t\t\t$parent.addClass(\"captcha-loading\");\n\t\t\t\t$field.val(\"\").focus();\n\t\t\t\t\n\t\t\t\tjQuery.getJSON(widget.options.reloadUrl, function(data) {\n\t\t\t\t\twidget.$widget.trigger('load', data);\n\t\t\t\t})\n\t\t\t\t.fail(widget.events.captchaAjaxFail);\n\t\t\t}\n\t\t},\n\t\t\n\t\t// Event bindings\n\t\tbind     : {\n\t\t\twidget : function() {\n\t\t\t\t\n\t\t\t\t$(widget.options.selector['captcha'])\n\t\t\t\t\t// Load events cannot be tied on parents.\n\t\t\t\t\t// Watch for source changes on the captcha.\n\t\t\t\t\t.on('load.ip-captcha', widget.events.captchaLoad);\n\t\t\t\t\n\t\t\t\twidget.$widget\n\t\t\t\t\t// Watch for captcha clicks.\n\t\t\t\t\t.on('load.ib-captcha',                                       widget.events.captchaLoadIn)\n\t\t\t\t\t.on('reload.ib-captcha',                                     widget.events.captchaReload)\n\t\t\t\t\t.on('click.ib-captcha',  widget.options.selector['captcha'], widget.events.captchaReload);\n\t\t\t\t\n\t\t\t}\n\t\t}\n\t\t\n\t};\n\t\n\treturn widget;\n});\n","// ============================================================\n// Purpose                      : Config Sheets\n// Contributors                 : jaw-sh\n// ============================================================\n\nib.widget(\"config\", function(window, $, undefined) {\n\tvar widget = {\n\t\t\n\t\tdefaults : {\n\t\t\tselector : {\n\t\t\t\t'field'         : \".field-control\",\n\t\t\t\t\n\t\t\t\t'list-template' : \".option-list .option-item-template .field-control\",\n\t\t\t}\n\t\t},\n\t\t\n\t\t// Events\n\t\tevents   : {\n\t\t\t\n\t\t\t// Adds additional config list items on demand.\n\t\t\tlistTemplateChange : function(event) {\n\t\t\t\tvar $template = $(this);\n\t\t\t\tvar $oldItem  = $template.parent();\n\t\t\t\tvar $newItem  = $oldItem.clone();\n\t\t\t\t\n\t\t\t\t$oldItem.removeClass(\"option-item-template\");\n\t\t\t\t$newItem.hide().insertAfter($oldItem).fadeIn(250);\n\t\t\t\t$newItem.children( widget.options.selector['field'] ).val(\"\");\n\t\t\t}\n\t\t\t\n\t\t},\n\t\t\n\t\t// Event bindings\n\t\tbind     : {\n\t\t\twidget : function() {\n\t\t\t\t\n\t\t\t\twidget.$widget\n\t\t\t\t\t.on('keydown', widget.options.selector['list-template'], widget.events.listTemplateChange)\n\t\t\t\t;\n\t\t\t\t\n\t\t\t}\n\t\t}\n\t\t\n\t};\n\t\n\treturn widget;\n});\n","/**\n * Stripe Cashier Form\n */\nib.widget(\"donate\", function(window, $, undefined) {\n\tvar widget = {\n\t\t\n\t\tnotices  : null,\n\t\t\n\t\t// The default values that are set behind init values.\n\t\tdefaults : {\n\t\t\t// Config options for this widget.\n\t\t\tconfig   : {\n\t\t\t\t'merchant'      : window.ib.config('merchant', false),\n\t\t\t\t'stripe-key'    : window.ib.config('stripe_key', false),\n\t\t\t\t'braintree-key' : window.ib.config('stripe_key', false)\n\t\t\t},\n\t\t\t\n\t\t\t// Selectors for finding and binding elements.\n\t\t\tselector : {\n\t\t\t\t'widget'             : \"#payment-form\",\n\t\t\t\t'notices'            : \"[data-widget=notice]:first\",\n\t\t\t\t\n\t\t\t\t'time'               : \"#payment-time\",\n\t\t\t\t\n\t\t\t\t'input-ccn'          : \"#ccn\",\n\t\t\t\t'input-cvc'          : \"#cvc\",\n\t\t\t\t'input-exp-month'    : \"#month\",\n\t\t\t\t'input-exp-year'     : \"#year\",\n\t\t\t\t'input-pay-monthly'  : \"#payment-monthly\",\n\t\t\t\t'input-pay-once'     : \"#payment-once\",\n\t\t\t\t'input-sub'          : \"#subscription\",\n\t\t\t\t'input-amount'       : \".donate-option-input:checked\",\n\t\t\t\t'input-select-other' : \"#input_amount_other\",\n\t\t\t\t'input-amount-other' : \"#input_amount_other_box\",\n\t\t\t\t\n\t\t\t\t'inputs-cycle'       : \".donate-cycle-input:checked\",\n\t\t\t\t'inputs-amount'      : \".donate-option-input, #input_amount_other_box\",\n\t\t\t\t\n\t\t\t\t'message'            : \"#payment-process\"\n\t\t\t},\n\t\t\t\n\t\t\t// HTML Templates for dynamic construction\n\t\t\ttemplate : {\n\t\t\t\t'message-sent'      : \"<div id=\\\"payment-process\\\">Securely Contacting Merchant</div>\",\n\t\t\t\t'message-server'    : \"<div id=\\\"payment-process\\\">Processing Transaction</div>\",\n\t\t\t\t'thank-you'         : \"<div id=\\\"payment-received\\\">Thank you!</div>\"\n\t\t\t}\n\t\t},\n\t\t\n\t\t// Compiled settings.\n\t\toptions  : false,\n\t\t\n\t\t// Event binding.\n\t\tbind     : {\n\t\t\tmerchant : function() {\n\t\t\t\t\n\t\t\t\tswitch (widget.options.config['merchant'])\n\t\t\t\t{\n\t\t\t\t\tcase \"braintree\" :\n\t\t\t\t\t\twindow.braintree.setup(window.ib.config('braintree_key'), \"custom\", {\n\t\t\t\t\t\t\tcontainer: widget.options.selector['widget'],\n\t\t\t\t\t\t});\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t\n\t\t\t\t\tcase \"stripe\" :\n\t\t\t\t\t\twindow.Stripe.setPublishableKey(widget.options.config['stripe-key']);\n\t\t\t\t\t\tbreak;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t},\n\t\t\t\n\t\t\twidget : function() {\n\t\t\t\t\n\t\t\t\twidget.bind.merchant();\n\t\t\t\t\n\t\t\t\t// $(widget.options.selector['input-pay-once']).insertBefore(widget.options.selector['input-pay-monthly']);\n\t\t\t\t\n\t\t\t\twidget.$widget\n\t\t\t\t\t.on('submit', widget.events.formSubmit)\n\t\t\t\t\t.on('change', widget.options.selector['input-ccn'], widget.events.ccnChange)\n\t\t\t\t\t.on('change', widget.options.selector['inputs-cycle'], widget.events.cycleChange)\n\t\t\t\t\t.on('change', widget.options.selector['inputs-amount'], widget.events.paymentChange)\n\t\t\t\t\t.on('change', widget.options.selector['input-amount-other'], widget.events.otherChange)\n\t\t\t\t\t.on('focus', widget.options.selector['input-amount-other'], widget.events.otherFocus);\n\t\t\t\t\n\t\t\t\twidget.events.cycleChange();\n\t\t\t\twidget.events.paymentChange();\n\t\t\t\t\n\t\t\t\twidget.notices = $(widget.options.selector['notices'])[0].widget;\n\t\t\t}\n\t\t},\n\t\t\n\t\t// HTML building.\n\t\tbuild    : {\n\t\t\t\n\t\t},\n\t\t\n\t\t// Event trigger handlers.\n\t\tevents   : {\n\t\t\tajaxAlways     : function(data, textStatus, errorThrown) {\n\t\t\t\twidget.$widget.find('button').prop('disabled', false);\n\t\t\t},\n\t\t\t\n\t\t\tajaxDone     : function(data, textStatus, errorThrown) {\n\t\t\t\tif (data.amount !== false)\n\t\t\t\t{\n\t\t\t\t\tvar $ty = $(widget.options.template['thank-you']);\n\t\t\t\t\t\n\t\t\t\t\t$(widget.options.selector['message']).replaceWith($ty);\n\t\t\t\t\t$ty.hide().fadeIn(500);\n\t\t\t\t\tsetTimeout(function() { widget.$widget.unblock(); }, 1500);\n\t\t\t\t\t\n\t\t\t\t\twidget.notices.push(\"You were successfully charged for <strong>\" + data.amount + \"</strong>. Thank you for your support!\", \"success\");\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\twidget.$widget.unblock();\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t$.each(data.errors, function(index, error) {\n\t\t\t\t\twidget.notices.push(error, \"error\");\n\t\t\t\t});\n\t\t\t},\n\t\t\t\n\t\t\tajaxFail     : function(data, textStatus, errorThrown) {\n\t\t\t\tconsole.log(data);\n\t\t\t\t\n\t\t\t\twidget.$widget.unblock();\n\t\t\t\twidget.notices.push(\"The server responded with an unknown error. You were not charged. Please report this issue.\", \"error\");\n\t\t\t},\n\t\t\t\n\t\t\tccnChange      : function(event) {\n\t\t\t\tvar $ccn = $(this);\n\t\t\t\t\n\t\t\t\t$ccn.val( $ccn.val().trim() );\n\t\t\t\t$ccn.validateCreditCard(\n\t\t\t\t\t\twidget.events.ccnValidate,\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\taccept: [\n\t\t\t\t\t\t\t\t'visa',\n\t\t\t\t\t\t\t\t'mastercard',\n\t\t\t\t\t\t\t\t'amex',\n\t\t\t\t\t\t\t\t'jcb',\n\t\t\t\t\t\t\t\t'discover',\n\t\t\t\t\t\t\t\t'diners_club_international',\n\t\t\t\t\t\t\t\t'diners_club_carte_blanche'\n\t\t\t\t\t\t\t]\n\t\t\t\t\t\t}\n\t\t\t\t\t);\n\t\t\t},\n\t\t\t\n\t\t\tccnValidate    : function(result) {\n\t\t\t\t$(this)[0].className = \"field-control\";\n\t\t\t\t\n\t\t\t\tif (result.card_type)\n\t\t\t\t{\n\t\t\t\t\t$(this).addClass(result.card_type.name);\n\t\t\t\t\t\n\t\t\t\t\tvar cvcMax = result.card_type.name === \"amex\" ? 4 : 3;\n\t\t\t\t\t\n\t\t\t\t\t$(widget.options.selector['input-cvc'], widget.$widget).attr({\n\t\t\t\t\t\t'maxlength' : cvcMax,\n\t\t\t\t\t\t'size'      : cvcMax,\n\t\t\t\t\t\t'pattern'   : \"[0-9]{\"+cvcMax+\"}\"\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\tif (result.valid) {\n\t\t\t\t\t\treturn $(this).addClass('control-valid');\n\t\t\t\t\t}\n\t\t\t\t\telse {\n\t\t\t\t\t\treturn $(this).removeClass('control-invalid');\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\tcycleChange    : function(event) {\n\t\t\t\tvar paymentVal = $(widget.options.selector['inputs-cycle']).filter(\":checked\").val();\n\t\t\t\t\n\t\t\t\tif (paymentVal != \"once\")\n\t\t\t\t{\n\t\t\t\t\t$(widget.options.selector['input-amount-other'])\n\t\t\t\t\t\t.prop('checked', false)\n\t\t\t\t\t\t.parent()\n\t\t\t\t\t\t\t.toggle(false);\n\t\t\t\t\t\n\t\t\t\t\t$(widget.options.selector['inputs-amount'])\n\t\t\t\t\t\t.filter(\"[value=12]\")\n\t\t\t\t\t\t\t.prop('checked', true);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$(widget.options.selector['input-amount-other'])\n\t\t\t\t\t\t.parent()\n\t\t\t\t\t\t\t.toggle(true);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\twidget.events.paymentChange();\n\t\t\t},\n\t\t\t\n\t\t\totherFocus     : function(event) {\n\t\t\t\t$(this).val(\"\");\n\t\t\t\t$(widget.options.selector['input-select-other']).prop('checked', true);\n\t\t\t\twidget.events.paymentChange();\n\t\t\t},\n\t\t\t\n\t\t\totherChange    : function(event) {\n\t\t\t\twidget.events.paymentChange();\n\t\t\t},\n\t\t\t\n\t\t\tformSubmit     : function(event) {\n\t\t\t\twidget.notices.clear();\n\t\t\t\t\n\t\t\t\tvar valid = true;\n\t\t\t\tvar sel   = widget.options.selector;\n\t\t\t\t\n\t\t\t\t// Make sure the CCN has been validated by the jQuery tool.\n\t\t\t\tvar $ccn  = $(sel['input-ccn']);\n\t\t\t\tif (!$ccn.is(\".control-valid\"))\n\t\t\t\t{\n\t\t\t\t\twidget.notices.push(\"Please enter a valid credit card number.\", 'error');\n\t\t\t\t\t$ccn.focus().trigger('focus');\n\t\t\t\t\tvalid = false;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Check to see if CVC is valid.\n\t\t\t\tvar $cvc = $(sel['input-cvc']);\n\t\t\t\tif ((new RegExp(\"^\"+$cvc.attr('pattern')+\"$\")).test($cvc.val()) === false)\n\t\t\t\t{\n\t\t\t\t\twidget.notices.push(\"Please enter a valid security code. It is three or four digits and found on the back of the card.\", 'error');\n\t\t\t\t\t$ccn.focus().trigger('focus');\n\t\t\t\t\tvalid = false;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Check if expiration date is older than this month.\n\t\t\t\tvar $month     = $(sel['input-exp-month']);\n\t\t\t\tvar $year      = $(sel['input-exp-year']);\n\t\t\t\tvar expiration = parseInt($month.val(), 10) + (parseInt($year.val(), 10) * 12);\n\t\t\t\tvar expiredBy  = new Date().getMonth() + (new Date().getFullYear() * 12);\n\t\t\t\tif (expiration < expiredBy)\n\t\t\t\t{\n\t\t\t\t\twidget.notices.push(\"Double-check your expiration date. This card is invalid.\", 'error');\n\t\t\t\t\tvalid = false;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// See what amount we've entered.\n\t\t\t\tvar $amountSel = $(sel['input-amount']).filter(\":checked\");\n\t\t\t\tvar $amountInp = $(sel['input-amount-other']);\n\t\t\t\tvar amount     = 0;\n\t\t\t\tif (!$amountSel.length)\n\t\t\t\t{\n\t\t\t\t\twidget.notices.push(\"Please enter an amount.\", 'error');\n\t\t\t\t\tvalid = false;\n\t\t\t\t}\n\t\t\t\telse if ($amountSel.val() == \"Other\")\n\t\t\t\t{\n\t\t\t\t\tamount = parseInt($amountInp.val(), 10);\n\t\t\t\t\t\n\t\t\t\t\tif (isNaN(amount) || amount <= 3)\n\t\t\t\t\t{\n\t\t\t\t\t\twidget.notices.push(\"Please enter a real amount that is greater than $3.\", 'error');\n\t\t\t\t\t\t$amountInp.focus();\n\t\t\t\t\t\tvalid = false;\n\t\t\t\t\t}\n\t\t\t\t\telse if (amount.toString() !== $amountInp.val())\n\t\t\t\t\t{\n\t\t\t\t\t\twidget.notices.push(\"Please enter a real, whole number as a donation amount.\", 'error');\n\t\t\t\t\t\t$amountInp.focus();\n\t\t\t\t\t\tvalid = false;\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (valid)\n\t\t\t\t{\n\t\t\t\t\tvar $form = $(this);\n\t\t\t\t\t\n\t\t\t\t\t$form.block({\n\t\t\t\t\t\tmessage : widget.options.template['message-sent'],\n\t\t\t\t\t\ttheme   : true\n\t\t\t\t\t});\n\t\t\t\t\t\n\t\t\t\t\t// Disable the submit button to prevent repeated clicks\n\t\t\t\t\t$form.find('button').prop('disabled', true);\n\t\t\t\t\t\n\t\t\t\t\t// Send the information to our merchant.\n\t\t\t\t\tswitch (widget.options.config['merchant'])\n\t\t\t\t\t{\n\t\t\t\t\t\tcase \"stripe\" :\n\t\t\t\t\t\t\tStripe.card.createToken($form, widget.events.stripeResponse);\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t\n\t\t\t\t\t\tdefault :\n\t\t\t\t\t\tcase \"braintree\" :\n\t\t\t\t\t\t\tvar client = new braintree.api.Client({clientToken: window.ib.config('braintree_key')});\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tclient.tokenizeCard({\n\t\t\t\t\t\t\t\t\tnumber:          $ccn.val(),\n\t\t\t\t\t\t\t\t\texpirationMonth: $month.val(),\n\t\t\t\t\t\t\t\t\texpirationYear:  $year.val(),\n\t\t\t\t\t\t\t\t\tcvv:             $cvc.val()\n\t\t\t\t\t\t\t\t}, widget.events.braintreeResponse);\n\t\t\t\t\t\t\t\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\t// Clear personal information.\n\t\t\t\t\t$(widget.options.selector['input-ccn'])\n\t\t\t\t\t\t.add(widget.options.selector['input-cvc'])\n\t\t\t\t\t\t\t.val(\"\")\n\t\t\t\t\t\t\t.trigger('change');\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Prevent the form from submitting with the default action\n\t\t\t\treturn false;\n\t\t\t},\n\t\t\t\n\t\t\tpaymentChange  : function(event) {\n\t\t\t\tvar workFactor = 0.1;\n\t\t\t\tvar timestamp = \"\";\n\t\t\t\t\n\t\t\t\tvar paymentVal = $(widget.options.selector['inputs-cycle']).filter(\":checked\").val();\n\t\t\t\tvar amount = $(widget.options.selector['input-amount']).filter(\":checked\").val();\n\t\t\t\t\n\t\t\t\tif( amount == \"Other\")\n\t\t\t\t{\n\t\t\t\t\tamount = parseInt($(widget.options.selector['input-amount-other']).val(), 10);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tamount = parseInt(amount, 10);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tif (isNaN(amount))\n\t\t\t\t{\n\t\t\t\t\tamount = 0;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvar hours = parseFloat(amount * workFactor);\n\t\t\t\t\n\t\t\t\tif (hours < 1)\n\t\t\t\t{\n\t\t\t\t\ttimestamp = (hours*60).toFixed(0) + \" minutes\";\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\ttimestamp = hours.toFixed(2) + \" hours\";\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\tvar text = \"<strong>$\" + amount + \" USD</strong> will afford up to <wbr> <strong>\" + timestamp + \"</strong> of development time\" + (paymentVal == \"monthly\" ? \" per month\" : \"\");\n\t\t\t\t\n\t\t\t\t$(widget.options.selector['time']).html(text);\n\t\t\t},\n\t\t\t\n\t\t\t\n\t\t\tbraintreeResponse : function(err, nonce) {\n\t\t\t\tvar $form = widget.$widget;\n\t\t\t\t\n\t\t\t\tif (err) {\n\t\t\t\t\t// Show the errors on the form\n\t\t\t\t\twidget.notices.push(err, \"error\");\n\t\t\t\t\t\n\t\t\t\t\t$form.unblock();\n\t\t\t\t\t$form.find('button').prop('disabled', false);\n\t\t\t\t}\n\t\t\t\telse if (nonce) {\n\t\t\t\t\t// Response contains id and card, which contains additional card details\n\t\t\t\t\tvar token = nonce;\n\t\t\t\t\t\n\t\t\t\t\t// Insert the token into the form so it gets submitted to the server\n\t\t\t\t\t$form.append($('<input type=\"hidden\" name=\"nonce\" />').val(token));\n\t\t\t\t\t\n\t\t\t\t\t// Submit to server\n\t\t\t\t\tvar parameters = $form\n\t\t\t\t\t\t.add(\"<input type=\\\"hidden\\\" name=\\\"ajax\\\" value=\\\"1\\\" />\")\n\t\t\t\t\t\t.serialize();\n\t\t\t\t\t\n\t\t\t\t\tif ($(widget.options.selector['input-amount']).val() == \"Other\")\n\t\t\t\t\t{\n\t\t\t\t\t\tparameters += \"&amount=\" + $(widget.options.selector['input-amount-other']).val();\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\twidget.submit(parameters);\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tconsole.log(\"Unrecognized braintree response.\", arguments);\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\tstripeResponse : function(status, response) {\n\t\t\t\tvar $form = widget.$widget;\n\t\t\t\t\n\t\t\t\tif (response.error) {\n\t\t\t\t\t// Show the errors on the form\n\t\t\t\t\twidget.notices.push(response.error.message, \"error\");\n\t\t\t\t\t\n\t\t\t\t\t$form.unblock();\n\t\t\t\t\t$form.find('button').prop('disabled', false);\n\t\t\t\t}\n\t\t\t\telse {\n\t\t\t\t\t// Response contains id and card, which contains additional card details\n\t\t\t\t\tvar token = response.id;\n\t\t\t\t\t\n\t\t\t\t\t// Insert the token into the form so it gets submitted to the server\n\t\t\t\t\t$form.append($('<input type=\"hidden\" name=\"nonce\" />').val(token));\n\t\t\t\t\t\n\t\t\t\t\t// Submit to server\n\t\t\t\t\tvar parameters = $form\n\t\t\t\t\t\t.add(\"<input type=\\\"hidden\\\" name=\\\"ajax\\\" value=\\\"1\\\" />\")\n\t\t\t\t\t\t.serialize();\n\t\t\t\t\t\n\t\t\t\t\tif ($(widget.options.selector['input-amount']).val() == \"Other\")\n\t\t\t\t\t{\n\t\t\t\t\t\tparameters += \"&amount=\" + $(widget.options.selector['input-amount-other']).val();\n\t\t\t\t\t}\n\t\t\t\t\t\n\t\t\t\t\twidget.submit(parameters);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\n\t\t// Form submission.\n\t\tsubmit   : function(parameters) {\n\t\t\tvar $form = widget.$widget;\n\t\t\t\n\t\t\t// Change our server message.\n\t\t\t$(widget.options.selector['message']).replaceWith(widget.options.template['message-server']);\n\t\t\t\n\t\t\t$.post(\n\t\t\t\t$form.attr('action'),\n\t\t\t\tparameters\n\t\t\t)\n\t\t\t\t.done(widget.events.ajaxDone)\n\t\t\t\t.fail(widget.events.ajaxFail)\n\t\t\t\t.always(widget.events.ajaxAlways);\n\t\t}\n\t\t\n\t};\n\t\n\treturn widget;\n});\n","// ============================================================\n// Purpose                      : Global navigation\n// Contributors                 : jaw-sh\n// ============================================================\n\nib.widget(\"gnav\", function(window, $, undefined) {\n\tvar widget = {\n\t\t\n\t\tdefaults : {\n\t\t\tstorage   : {\n\t\t\t\t// Mirrors board-favorite widget's.\n\t\t\t\t'favorites-data' : \"ib.favoritedata\"\n\t\t\t},\n\t\t\t\n\t\t\tselector : {\n\t\t\t\t'class-open'  : \"flyout-open\",\n\t\t\t\t\n\t\t\t\t'nav-link'    : \".gnav-link[data-item]\",\n\t\t\t\t\n\t\t\t\t'flyout'      : \".flyout\",\n\t\t\t\t'flyout-list' : \".flyout-list\",\n\t\t\t\t'flyout-link' : \".flyout-link\",\n\t\t\t\t\n\t\t\t\t'favorites'   : \"#favorite-boards\"\n\t\t\t},\n\t\t\t\n\t\t\ttemplates : {\n\t\t\t\t'flyout-item'  : \"<li class=\\\"flyout-item\\\"></li>\",\n\t\t\t\t'flyout-link'  : \"<a href=\\\"\\\" class=\\\"flyout-link\\\"></a>\",\n\t\t\t\t'flyout-uri'   : \"<span class=\\\"flyout-uri\\\"></span>\",\n\t\t\t\t'flyout-title' : \"<span class=\\\"flyout-title\\\"></span>\"\n\t\t\t}\n\t\t},\n\t\t\n\t\t// Events\n\t\tevents   : {\n\t\t\tanyClick  : function(event) {\n\t\t\t\t// Close ally open flyouts.\n\t\t\t\tvar $flyouts = $(\".\"+widget.options.selector['class-open']);\n\t\t\t\t\n\t\t\t\t$flyouts.each(function() {\n\t\t\t\t\tconsole.log($(event.target).closest(this));\n\t\t\t\t\tif (!$(event.target).closest(this).length)\n\t\t\t\t\t{\n\t\t\t\t\t\t$(this).removeClass(widget.options.selector['class-open']);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t},\n\t\t\t\n\t\t\titemClick : function(event) {\n\t\t\t\tevent.stopPropagation();\n\t\t\t\t\n\t\t\t\tvar $link    = $(this);\n\t\t\t\tvar item     = $link.attr('data-item');\n\t\t\t\tvar $flyout  = $(\"#flyout-\"+item);\n\t\t\t\t\n\t\t\t\tif ($flyout.length)\n\t\t\t\t{\n\t\t\t\t\t$flyout.toggleClass(widget.options.selector['class-open']);\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t},\n\t\t\t\n\t\t\tfavoritesBuild : function(event) {\n\t\t\t\twidget.build.favorites();\n\t\t\t},\n\t\t\t\n\t\t\tflyoutClick : function(event) {\n\t\t\t\t$(this).parents(\".\"+widget.options.selector['class-open'])\n\t\t\t\t\t.removeClass(widget.options.selector['class-open']);\n\t\t\t},\n\t\t\t\n\t\t\t// This is an HTML localStorage event.\n\t\t\t// it only fires if ANOTHER WINDOW trips the change.\n\t\t\tstorage : function(event) {\n\t\t\t\tif (event.originalEvent.key == widget.options.storage['favorites-data'])\n\t\t\t\t{\n\t\t\t\t\twidget.build.favorites();\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\n\t\t// Event bindings\n\t\tbind     : {\n\t\t\twidget : function() {\n\t\t\t\t$(window)\n\t\t\t\t\t.on( 'click.ib-gnav',   widget.events.anyClick )\n\t\t\t\t\t.on( 'storage.ib-gnav', widget.events.storage )\n\t\t\t\t;\n\t\t\t\t\n\t\t\t\twidget.$widget\n\t\t\t\t\t.on( 'click.ib-gnav', widget.options.selector['flyout-link'], widget.events.flyoutClick )\n\t\t\t\t\t.on( 'click.ib-gnav', widget.options.selector['nav-link'],    widget.events.itemClick )\n\t\t\t\t\t.on( 'build.ib-gnav', widget.options.selector['favorites'],   widget.events.favoritesBuild )\n\t\t\t\t;\n\t\t\t\t\n\t\t\t\t$(widget.options.selector['nav-link'], widget.$widget).each(function() {\n\t\t\t\t\tvar $link = $(this);\n\t\t\t\t\t\n\t\t\t\t\tif ($(\"#flyout-\" + $link.attr('data-item')).length > 0)\n\t\t\t\t\t{\n\t\t\t\t\t\t$link.attr('data-no-instant', \"true\");\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\twidget.build.favorites();\n\t\t\t}\n\t\t},\n\t\t\n\t\tbuild    : {\n\t\t\tfavorites : function() {\n\t\t\t\tif (typeof localStorage === \"object\")\n\t\t\t\t{\n\t\t\t\t\tvar $favorites = $(widget.options.selector['favorites'], widget.$widget);\n\t\t\t\t\tvar $list      = $(widget.options.selector['flyout-list'], $favorites);\n\t\t\t\t\tvar favorites  = localStorage.getItem(widget.options.storage['favorites-data']);\n\t\t\t\t\t\n\t\t\t\t\tif (typeof favorites === \"string\")\n\t\t\t\t\t{\n\t\t\t\t\t\tfavorites = JSON.parse(favorites);\n\t\t\t\t\t\t\n\t\t\t\t\t\t$favorites.css('display', favorites.length > 0 ? \"block\" : \"none\");\n\t\t\t\t\t\t$list.children().remove();\n\t\t\t\t\t\t\n\t\t\t\t\t\tif (favorites.length)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tfor (var i = 0; i < favorites.length; ++i)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar favorite = favorites[i];\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\tvar $item  = $(widget.options.templates['flyout-item']);\n\t\t\t\t\t\t\t\tvar $link  = $(widget.options.templates['flyout-link']);\n\t\t\t\t\t\t\t\tvar $uri   = $(widget.options.templates['flyout-uri']);\n\t\t\t\t\t\t\t\tvar $title = $(widget.options.templates['flyout-title']);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t$item\n\t\t\t\t\t\t\t\t\t.appendTo($list);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t$link\n\t\t\t\t\t\t\t\t\t.attr('href', window.app.url+\"/\"+favorite.board_uri+\"/\")\n\t\t\t\t\t\t\t\t\t.appendTo($item);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t$uri\n\t\t\t\t\t\t\t\t\t.text(\"/\"+favorite.board_uri+\"/\")\n\t\t\t\t\t\t\t\t\t.appendTo($link);\n\t\t\t\t\t\t\t\t\n\t\t\t\t\t\t\t\t$title\n\t\t\t\t\t\t\t\t\t.text(favorite.title)\n\t\t\t\t\t\t\t\t\t.appendTo($link);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t};\n\t\n\treturn widget;\n});\n","// ===========================================================================\n// Purpose          : Posts\n// Contributors     : jaw-sh\n// Widget Version   : 2\n// ===========================================================================\n\n(function(window, $, undefined) {\n\t// Widget blueprint\n\tvar blueprint = ib.getBlueprint();\n\t\n\t// Configuration options\n\tvar options = {\n\t\tenable : {\n\t\t\ttype : \"bool\",\n\t\t\tinitial : false\n\t\t}\n\t};\n\t\n\t// Event bindings\n\tblueprint.prototype.bind = function() {\n\t\tif (!this.is('enable'))\n\t\t{\n\t\t\tconsole.log(\"InstantClick ignored\");\n\t\t\treturn false;\n\t\t}\n\t\t\n\t\tconsole.log(\"InstantClick init\");\n\t\t\n\t\tInstantClick.init(this.options.wait);\n\t\t\n\t\tblueprint.prototype.storage.jQuery       = window.jQuery;\n\t\tblueprint.prototype.storage.ib           = window.ib;\n\t\tblueprint.prototype.storage.InstantClick = window.InstantClick;\n\t\t\n\t\t$.each(this.events.InstantClick, function(eventName, eventClosure) {\n\t\t\tInstantClick.on(eventName, eventClosure);\n\t\t});\n\t};\n\t\n\tblueprint.prototype.defaults = {\n\t\t'wait' : 50\n\t};\n\t\n\tblueprint.prototype.events = {\n\t\tInstantClick : {\n\t\t\tchange : function() {\n\t\t\t\tconsole.log(\"InstantClick change\");\n\t\t\t\t\n\t\t\t\tthis.storage;\n\t\t\t\t// Restore our cached objects.\n\t\t\t\twindow.jQuery       = blueprint.prototype.storage.jQuery;\n\t\t\t\twindow.$            = blueprint.prototype.storage.jQuery;\n\t\t\t\twindow.ib           = blueprint.prototype.storage.ib;\n\t\t\t\twindow.InstantClick = blueprint.prototype.storage.InstantClick;\n\t\t\t\t\n\t\t\t\t// Insert our window.app data.\n\t\t\t\tjQuery.globalEval( $(\"#js-app-data\").html() );\n\t\t\t\t\n\t\t\t\t// Bind all widgets.\n\t\t\t\tib.bindAll();\n\t\t\t\t\n\t\t\t\t// Scroll to requested item.\n\t\t\t\tif (window.location.hash != \"\")\n\t\t\t\t{\n\t\t\t\t\tvar elem = document.getElementById(window.location.hash);\n\t\t\t\t\t\n\t\t\t\t\tif (elem && typeof elem.scrollToElement === \"function\")\n\t\t\t\t\t{\n\t\t\t\t\t\telem.scrollToElement();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t};\n\t\n\t// Long-term storage that the InstantCLick widget uses to preserve script\n\t// items between page sessions.\n\tblueprint.prototype.storage = {\n\t\tjQuery       : null,\n\t\tib           : null,\n\t\tInstantClick : null,\n\t};\n\t\n\tib.widget(\"instantclick\", blueprint, options);\n\t\n\t$(document).one('ready', function(event) {\n\t\tib.bindElement(document.documentElement);\n\t});\n})(window, window.jQuery);\n","// ===========================================================================\n// Purpose          : JavaScript Configuration UI Dialog\n// Contributors     : jaw-sh\n// Widget Version   : 2\n// ===========================================================================\n\n(function(window, $, undefined) {\n\t// Widget blueprint\n\tvar blueprint = ib.getBlueprint();\n\t\n\t// Configuration options\n\tvar options = {\n\t\t\n\t};\n\t\n\t// Main Widget Initialization Binding\n\tblueprint.prototype.bind = function() {\n\t\tvar data = {\n\t\t\twidget  : this,\n\t\t\t$widget : this.$widget\n\t\t};\n\t\t\n\t\tthis.$widget.on('click.ib-js-config', data, this.events.navClick);\n\t};\n\t\n\t// Default configurable valuess.\n\tblueprint.prototype.defaults = {\n\t\t\n\t\t// Significant Class Names\n\t\tclassname : {\n\t\t\tmenuactive : \"config-nav-active\"\n\t\t},\n\t\t\n\t\t// jQuery Selectors\n\t\tselector : {\n\t\t\tclose     : \"#js-config-close\",\n\t\t\tmenuitems : \".config-nav-item\",\n\t\t\tfieldsets : \".config-group\"\n\t\t},\n\t\t\n\t\t// HTML Templates\n\t\ttemplate : {\n\t\t\t// The outer panel.\n\t\t\tpanel     : \"<form id=\\\"js-config\\\"></form>\",\n\t\t\t\n\t\t\t// Close button\n\t\t\tclose     : \"<div id=\\\"js-config-close\\\"><i class=\\\"fa fa-close\\\"></i></div>\",\n\t\t\t\n\t\t\t// Config title\n\t\t\ttitle     : \"<h1 class=\\\"config-title\\\">Infinity Next User Options</h1>\",\n\t\t\t\n\t\t\t// Inner container.\n\t\t\tcontainer : \"<table class=\\\"config-table\\\"></table>\",\n\t\t\t\n\t\t\t// Sub-container for both nav and fieldsets.\n\t\t\tinterior  : \"<tr class=\\\"config-interior\\\"></tr>\",\n\t\t\t\n\t\t\t// Outer container for the navigation list.\n\t\t\tnavcell   : \"<td class=\\\"config-cell cell-nav\\\"></td>\",\n\t\t\t\n\t\t\t// Navigation list.\n\t\t\tnavlist   : \"<ul class=\\\"config-nav-list\\\"></ul>\",\n\t\t\t\n\t\t\t// Navigation item.\n\t\t\tnavitem   : \"<li class=\\\"config-nav-item\\\"><i class=\\\"fa\\\"></i></li>\",\n\t\t\t\n\t\t\t// Outer container for the fieldsets\n\t\t\tfieldcell : \"<td class=\\\"config-cell cell-fields\\\"></td>\",\n\t\t\t\n\t\t\t// Widget fieldset\n\t\t\tfieldset  : \"<fieldset class=\\\"config-group\\\"></fieldset>\",\n\t\t\t\n\t\t\t// Widget fieldset legend\n\t\t\tlegend    : \"<legend class=\\\"config-legend\\\"></legend>\",\n\t\t\t\n\t\t\t// Fieldset description\n\t\t\tfielddesc : \"<p class=\\\"config-desc\\\"></p>\",\n\t\t\t\n\t\t\t// Row for the fields.\n\t\t\trow       : \"<label class=\\\"config-row\\\"></label>\",\n\t\t\t\n\t\t\t// Text container for field labels.\n\t\t\trowname   : \"<span class=\\\"config-row-name\\\"></span>\"\n\t\t}\n\t};\n\t\n\t// Event definitions\n\tblueprint.prototype.events = {\n\t\t\n\t\tmenuClick : function(event) {\n\t\t\t// Change the active fieldset.\n\t\t\tvar widget = event.data.widget;\n\t\t\tvar target = event.delegateTarget;\n\t\t\tvar menuWidgetName = event.target.dataset.fieldset;\n\t\t\t\n\t\t\tvar $menuitems = $(widget.options.selector.menuitems, target);\n\t\t\tvar $fieldsets = $(widget.options.selector.fieldsets, target);\n\t\t\t\n\t\t\t// Change visible fieldsets.\n\t\t\t$fieldsets.each(function() {\n\t\t\t\t$(this).toggle(this.dataset.fieldset == menuWidgetName);\n\t\t\t});\n\t\t\t\n\t\t\t// Change active menu item.\n\t\t\t$menuitems.each(function() {\n\t\t\t\t$(this).toggleClass(\n\t\t\t\t\twidget.options.classname.menuactive,\n\t\t\t\t\tthis.dataset.fieldset == menuWidgetName\n\t\t\t\t);\n\t\t\t});\n\t\t},\n\t\t\n\t\tnavClick : function(event) {\n\t\t\t// Open the interface for changing settings.\n\t\t\tevent.data.widget.presentDialog();\n\t\t}\n\t\t\n\t};\n\t\n\t// Dialog (Option Menu) Presentation\n\tblueprint.prototype.presentDialog = function() {\n\t\tvar widget     = this;\n\t\tvar $dialog    = $(widget.options.template.panel);\n\t\t\n\t\t// Begin putting together the dialog.\n\t\tvar $close = $(widget.options.template.close);\n\t\t$close.appendTo($dialog);\n\t\t\n\t\tvar $title = $(widget.options.template.title);\n\t\t$title.appendTo($dialog);\n\t\t\n\t\tvar $container = $(widget.options.template.container);\n\t\t$container.appendTo($dialog);\n\t\t\n\t\tvar $interior  = $(widget.options.template.interior);\n\t\t$interior.appendTo($container);\n\t\t\n\t\tvar $navcell   = $(widget.options.template.navcell);\n\t\t$navcell.appendTo($interior);\n\t\t\n\t\tvar $fieldcell = $(widget.options.template.fieldcell);\n\t\t$fieldcell.appendTo($interior);\n\t\t\n\t\tvar $navlist   = $(widget.options.template.navlist);\n\t\t$navlist.appendTo($navcell);\n\t\t\n\t\t// This indicates if we've unhidden our first fieldset pane.\n\t\tvar firstFieldset = true;\n\t\t\n\t\t// Loop through each widget and pluck their settings.\n\t\tjQuery.each(ib.settings, function(widgetName, settings) {\n\t\t\t// Ensure there are options for this group.\n\t\t\tif (Object.keys(settings).length)\n\t\t\t{\n\t\t\t\t// Translate our widget name to a title.\n\t\t\t\tvar widgetTitle = ib.trans(widgetName + \".title\");\n\t\t\t\tvar widgetDesc  = ib.trans(widgetName + \".desc\");\n\t\t\t\t\n\t\t\t\t// Add a fieldset.\n\t\t\t\tvar $fieldset = $(widget.options.template.fieldset)\n\t\t\t\t\t.data('fieldset', widgetName)\n\t\t\t\t\t.attr('data-fieldset', widgetName)\n\t\t\t\t\t.appendTo($fieldcell);\n\t\t\t\t\n\t\t\t\t// Append its legend.\n\t\t\t\t$(widget.options.template.legend)\n\t\t\t\t\t.append(widgetTitle)\n\t\t\t\t\t.appendTo($fieldset);\n\t\t\t\t\n\t\t\t\t// Append an optional description.\n\t\t\t\tif (widgetDesc.length > 0)\n\t\t\t\t{\n\t\t\t\t\t$(widget.options.template.fielddesc)\n\t\t\t\t\t\t.append(widgetDesc)\n\t\t\t\t\t\t.appendTo($fieldset);\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Add a navigation item.\n\t\t\t\t$(widget.options.template.navitem)\n\t\t\t\t\t.addClass('item-'+widgetName)\n\t\t\t\t\t.data('fieldset', widgetName)\n\t\t\t\t\t.attr('data-fieldset', widgetName)\n\t\t\t\t\t.append(widgetTitle)\n\t\t\t\t\t.appendTo($navlist);\n\t\t\t\t\n\t\t\t\tjQuery.each(settings, function(settingName, setting) {\n\t\t\t\t\t// Turn a setting into a row.\n\t\t\t\t\tvar $name = $(widget.options.template.rowname)\n\t\t\t\t\t\t.append(setting.getLabel());\n\t\t\t\t\t\n\t\t\t\t\tvar $field = setting.toHTML();\n\t\t\t\t\t\n\t\t\t\t\t$(widget.options.template.row)\n\t\t\t\t\t\t.append($name)\n\t\t\t\t\t\t.append($field)\n\t\t\t\t\t\t.appendTo($fieldset)\n\t\t\t\t\t\t.attr('id', \"js-config-row-\"+widgetName+\"-\"+settingName);\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tif (firstFieldset)\n\t\t\t\t{\n\t\t\t\t\tfirstFieldset = false;\n\t\t\t\t\t$fieldset.show();\n\t\t\t\t}\n\t\t\t}\n\t\t});\n\t\t\n\t\t// Blocks out the screen with an interruptable dialog.\n\t\t$.blockUI({\n\t\t\tmessage    : $dialog,\n\t\t\tcss        : {\n\t\t\t\tbackground : \"none\",\n\t\t\t\tborder     : \"none\",\n\t\t\t\tpadding    : 0,\n\t\t\t\tmargin     : 0,\n\t\t\t\ttextAlign  : \"left\",\n\t\t\t\tcursor     : \"normal\",\n\t\t\t\ttop        : \"10vh\",\n\t\t\t\tleft       : \"0\",\n\t\t\t\twidth      : \"100%\",\n\t\t\t\t'pointer-events' : \"none\"\n\t\t\t},\n\t\t\toverlayCSS : {\n\t\t\t\tborder     : \"none\",\n\t\t\t\tpadding    : 0,\n\t\t\t\tmargin     : 0,\n\t\t\t\ttextAlign  : \"left\",\n\t\t\t\tcursor     : \"normal\"\n\t\t\t}\n\t\t});\n\t\t\n\t\t// Bind fade event.\n\t\t$(\".blockOverlay\").one('click.ib-js-config', $.unblockUI);\n\t\t$(widget.options.selector.close)\n\t\t\t.one('click.ib-js-config', $.unblockUI);\n\t\t\n\t\t// Bind menu toggle items\n\t\t$dialog.on(\n\t\t\t'click.ib-js-config',\n\t\t\twidget.options.selector.menuitems,\n\t\t\t{\n\t\t\t\twidget  : widget,\n\t\t\t\t$widget : widget.$widget\n\t\t\t},\n\t\t\tthis.events.menuClick\n\t\t);\n\t};\n\t\n\tib.widget(\"js-config\", blueprint, options);\n})(window, window.jQuery);\n","// ===========================================================================\n// Purpose          : Lazy Image Loading\n// Contributors     : jaw-sh\n// Widget Version   : 2\n// ===========================================================================\n\n(function(window, $, undefined) {\n\t// Widget blueprint\n\tvar blueprint = ib.getBlueprint();\n\t\n\t// Configuration options\n\tvar options = {\n\t\tenable : {\n\t\t\ttype : \"bool\",\n\t\t\tinitial : false\n\t\t}\n\t};\n\t\n\t// Main Widget Initialization Binding\n\tblueprint.prototype.bind = function() {\n\t\tif (!this.is('enable'))\n\t\t{\n\t\t\treturn false;\n\t\t}\n\t\tvar widget  = this;\n\t\tvar $widget = this.$widget;\n\t\tvar data    = {\n\t\t\twidget  : widget,\n\t\t\t$widget : $widget\n\t\t};\n\t\t\n\t\t$widget.on('click', data, this.events.navClick);\n\t\t\n\t\t// With this image remove src data and indicate it's lazy.\n\t\t$widget.addClass(\"lazy-load\");\n\t\t$widget.attr('data-src', $widget[0].src);\n\t\t$widget[0].src = \"\";\n\t\t\n\t\t$widget.on('lazywake.ib-lazymg',  data, widget.events.imageLazyWake);\n\t\t$(window).on('scroll.ib-lazyimg', data, widget.events.windowScroll);\n\t\t\n\t\treturn true;\n\t};\n\t\n\t// The default values that are set behind init values.\n\tblueprint.prototype.defaults = {\n\t\t// Selectors for finding and binding elements.\n\t\tselector : {\n\t\t\t'img'      : \"img\",\n\t\t\t'img-lazy' : \"img.lazy-load\",\n\t\t}\n\t};\n\t\n\tblueprint.prototype.events = {\n\t\timageLazyWake : function(event) {\n\t\t\tvar widget  = event.data.widget;\n\t\t\tvar $widget = event.data.$widget;\n\t\t\t\n\t\t\t$(widget.options.selector['img-lazy'], $widget).each(function() {\n\t\t\t\tvar $this = $(this);\n\t\t\t\t\n\t\t\t\t$this.removeClass(\"lazy-load\");\n\t\t\t\t\n\t\t\t\t// Correct the source.\n\t\t\t\tthis.src = $this.attr('data-src');\n\t\t\t\t\n\t\t\t\t// Call the postbox widget to check if the image can be played\n\t\t\t\t// before the user tries to click it.\n\t\t\t\t$this.trigger('media-check');\n\t\t\t});\n\t\t},\n\t\t\n\t\twindowScroll : function(event) {\n\t\t\t// Determine if the boundaries of this image are in the viewport.\n\t\t\tvar widget        = event.data.widget;\n\t\t\tvar $widget       = event.data.$widget;\n\t\t\tvar $window       = $(window);\n\t\t\t\n\t\t\tvar docViewTop    = $window.scrollTop();\n\t\t\tvar docViewBottom = docViewTop + $window.height();\n\t\t\t\n\t\t\tvar viewPad = 200;\n\t\t\t\n\t\t\tvar elemTop       = $widget.offset().top - viewPad;\n\t\t\tvar elemBottom    = elemTop + $widget.height() + viewPad;\n\t\t\t\n\t\t\t// We don't need the entire image to be present, just either edge.\n\t\t\t\n\t\t\t// If the top boundary is present\n\t\t\tif ( ((elemTop <= docViewBottom) && (elemTop >= docViewTop)) ||\n\t\t\t\t((elemBottom <= docViewBottom) && (elemBottom >= docViewTop)) )\n\t\t\t{\n\t\t\t\t$widget.trigger('lazywake');\n\t\t\t}\n\t\t}\n\t};\n\t\n\tib.widget(\"lazyimg\", blueprint, options);\n})(window, window.jQuery);\n","/**\n * Message Widget\n */\nib.widget(\"notice\", function(window, $, undefined) {\n\tvar widget = {\n\t\t\n\t\t// The default values that are set behind init values.\n\t\tdefaults : {\n\t\t\t// Selectors for finding and binding elements.\n\t\t\tselector : {\n\t\t\t\t'widget'        : \".form-messages\",\n\t\t\t\t'message'       : \".form-message\",\n\t\t\t},\n\t\t\t\n\t\t\t// HTML Templates for dynamic construction\n\t\t\ttemplate : {\n\t\t\t\t'message'         : \"<li class=\\\"form-message\\\"></li>\",\n\t\t\t\t'message-info'    : \"<li class=\\\"form-message message-info\\\"></li>\",\n\t\t\t\t'message-success' : \"<li class=\\\"form-message message-success\\\"></li>\",\n\t\t\t\t'message-error'   : \"<li class=\\\"form-message message-error\\\"></li>\"\n\t\t\t}\n\t\t},\n\t\t\n\t\t// Compiled settings.\n\t\toptions  : false,\n\t\t\n\t\tbind     : {\n\t\t\twidget : function() {\n\t\t\t\twidget.$widget\n\t\t\t\t\t.on('click.ib-notice', widget.options.selector['message'], widget.events.noticeClick)\n\t\t\t\t;\n\t\t\t}\n\t\t},\n\t\t\n\t\tevents   : {\n\t\t\t\n\t\t\tnoticeClick : function(event) {\n\t\t\t\tvar $this = $(this);\n\t\t\t\t\n\t\t\t\t// Make sure we don't hijack and link clicks.\n\t\t\t\tif ($(this.toElement).is('[href]'))\n\t\t\t\t{\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t\t\n\t\t\t\t// Fade out and remove the notice very quickly after clicking it.\n\t\t\t\t$this.fadeOut(250, function() {\n\t\t\t\t\t$this.remove();\n\t\t\t\t});\n\t\t\t\t\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\t\n\t\t},\n\t\t\n\t\tbuild    : {\n\t\t\t\n\t\t},\n\t\t\n\t\tclear    : function() {\n\t\t\twidget.$widget.children().remove();\n\t\t},\n\t\t\n\t\tpush     : function(message, messageType) {\n\t\t\tif (widget.options === false) {\n\t\t\t\twidget.init();\n\t\t\t}\n\t\t\t\n\t\t\tvar $message;\n\t\t\tvar className = \"message\";\n\t\t\t\n\t\t\tif (widget.options.template['message-'+messageType] !== undefined)\n\t\t\t{\n\t\t\t\tclassName = 'message-'+messageType;\n\t\t\t}\n\t\t\t\n\t\t\t$message = $(widget.options.template[className]);\n\t\t\t$message.append(message).appendTo(widget.$widget);\n\t\t\t\n\t\t\t// Scroll our window up to meet the notification if required.\n\t\t\tif ($message.offsetParent().css('position') !== \"fixed\")\n\t\t\t{\n\t\t\t\t$('html, body').animate({\n\t\t\t\t\t\tscrollTop : $message.offset().top - $(\".board-header\").height() - 10\n\t\t\t\t\t},\n\t\t\t\t\t250\n\t\t\t\t);\n\t\t\t}\n\t\t\t\n\t\t\treturn $message;\n\t\t}\n\t\t\n\t};\n\t\n\treturn widget;\n});\n","// ============================================================\n// Purpose                      : Permission Sheets\n// Contributors                 : jaw-sh\n// ============================================================\n\nib.widget(\"permissions\", function(window, $, undefined) {\n\tvar widget = {\n\t\t\n\t\tdefaults : {\n\t\t\tselector : {\n\t\t\t\t\n\t\t\t}\n\t\t},\n\t\t\n\t\t// Events\n\t\tevents   : {\n\t\t\t\n\t\t},\n\t\t\n\t\t// Event bindings\n\t\tbind     : {\n\t\t\twidget : function() {\n\t\t\t\t\n\t\t\t}\n\t\t}\n\t\t\n\t};\n\t\n\treturn widget;\n});\n\n","// ===========================================================================\n// Purpose          : Posts\n// Contributors     : jaw-sh\n// Widget Version   : 2\n// ===========================================================================\n\n(function(window, $, undefined) {\n\t// Widget blueprint\n\tvar blueprint = ib.getBlueprint();\n\n\tvar events = {\n\t\tdoContentUpdate : function(event) {\n\t\t\t// On setting update, trigger reformating..\n\t\t\tvar setting = event.data.setting;\n\t\t\tvar widget  = setting.widget;\n\t\t\tib.getInstances(widget).trigger('contentUpdate');\n\t\t}\n\t};\n\n\t// Configuration options\n\tvar options = {\n\t\tauthor_id : {\n\t\t\ttype : \"bool\",\n\t\t\tinitial : true,\n\t\t\tonChange : events.doContentUpdate,\n\t\t\tonUpdate : events.doContentUpdate\n\t\t},\n\t\tattachment_preview : {\n\t\t\ttype : \"bool\",\n\t\t\tinitial : true\n\t\t}\n\t};\n\n\tblueprint.prototype.defaults = {\n\t\t// Important class names.\n\t\tclassname : {\n\t\t\t'post-hover'  : \"post-hover\",\n\t\t\t'cite-you'    : \"cite-you\"\n\t\t},\n\n\t\t// Selectors for finding and binding elements.\n\t\tselector : {\n\t\t\t'widget'         : \".post-container\",\n\n\t\t\t'hover-box'      : \"#attachment-preview\",\n\t\t\t'hover-box-img'  : \"#attachment-preview-img\",\n\n\t\t\t'mode-reply'     : \"main.mode-reply\",\n\t\t\t'mode-index'     : \"main.mode-index\",\n\n\t\t\t'post-reply'     : \".post-reply\",\n\n\t\t\t'element-code'   : \"pre code\",\n\t\t\t'element-quote'  : \"blockquote\",\n\n\t\t\t'author_id'      : \".authorid\",\n\n\t\t\t'cite-slot'      : \"li.detail-cites\",\n\t\t\t'cite'           : \"a.cite-post\",\n\t\t\t'backlinks'      : \"a.cite-backlink\",\n\t\t\t'forwardlink'    : \"blockquote.post a.cite-post\",\n\n\t\t\t'post-form'      : \"#post-form\",\n\t\t\t'post-form-body' : \"#body\",\n\n\t\t\t'attachment'         : \"li.post-attachment\",\n\t\t\t'attacment-expand'   : \"li.post-attachment:not(.attachment-expanded) a.attachment-link\",\n\t\t\t'attacment-collapse' : \"li.post-attachment.attachment-expanded a.attachment-link\",\n\t\t\t'attachment-media'   : \"audio.attachment-inline, video.attachment-inline\",\n\t\t\t'attachment-image'   : \"img.attachment-img\",\n\t\t\t'attachment-image-download'   : \"img.attachment-type-file\",\n\t\t\t'attachment-image-expandable' : \"img.attachment-type-img\",\n\t\t\t'attachment-image-audio'      : \"img.attachment-type-audio\",\n\t\t\t'attachment-image-video'      : \"img.attachment-type-video\",\n\t\t\t'attachment-inline'  : \"audio.attachment-inline, video.attachment-inline\",\n\t\t\t'attachment-link'    : \"a.attachment-link\"\n\t\t},\n\n\t\t// HTML Templates\n\t\ttemplate : {\n\t\t\t'backlink' : \"<a class=\\\"cite cite-post cite-backlink\\\"></a>\"\n\t\t}\n\t};\n\n\t// The temporary hover-over item created to show backlink posts.\n\tblueprint.prototype.$cite    = null;\n\tblueprint.prototype.citeLoad = null;\n\n\t// Takes an element and positions it near a backlink.\n\tblueprint.prototype.anchorBoxToLink = function($box, $link) {\n\t\tvar bodyWidth = document.body.scrollWidth;\n\n\t\tvar linkRect  = $link[0].getBoundingClientRect();\n\n\t\t$(this.options.classname['post-hover']).remove();\n\n\t\tif (!$box.parents().length)\n\t\t{\n\t\t\t$box.appendTo(\"body\")\n\t\t\t\t.addClass(this.options.classname['post-hover'])\n\t\t\t\t.css('position', \"absolute\");\n\t\t\tib.bindAll($box);\n\t\t}\n\n\t\tvar boxHeight = $box.outerHeight();\n\t\tvar boxWidth  = $box.outerWidth();\n\n\t\tvar posTop  = linkRect.top + window.scrollY;\n\n\t\t// Is the box's bottom below the bottom of the screen?\n\t\tif (posTop + boxHeight + 25 > window.scrollY + window.innerHeight)\n\t\t{\n\t\t\t// Selects the larger of two values:\n\t\t\t// A) Our position in the scroll, or\n\t\t\t// B) The hidden part of the post subtracted from the top.\n\t\t\t// This check will try to keep the entire post visible,\n\t\t\t// but will always keep the top of the post visible.\n\t\t\tvar posTopDiff = (posTop + boxHeight + 25) - (window.scrollY + window.innerHeight);\n\t\t\tposTop = Math.max( window.scrollY, posTop - posTopDiff );\n\t\t}\n\n\n\t\t// Float to the right.\n\t\t// Default for LTR\n\t\tvar posLeft;\n\t\tvar posLeftOnRight = linkRect.right + 5;\n\t\tvar posLeftOnLeft  = linkRect.left  - 5;\n\t\tvar maxWidth       = (document.body.scrollWidth * 0.7) - 15;\n\t\tvar newWidth;\n\n\t\t// LTR display\n\t\tif (ib.ltr)\n\t\t{\n\t\t\t// Left side has more space than right side,\n\t\t\t// and box is wider than remaining space.\n\t\t\tif (linkRect.left > document.body.scrollWidth - posLeftOnRight\n\t\t\t\t&& boxWidth > document.body.scrollWidth - posLeftOnRight)\n\t\t\t{\n\t\t\t\tposLeft  = posLeftOnLeft;\n\t\t\t\tnewWidth = Math.min(maxWidth, boxWidth, linkRect.left - 15);\n\t\t\t\tposLeft -= newWidth;\n\t\t\t}\n\t\t\t// Right side has more adequate room,\n\t\t\t// Or box fits in.\n\t\t\telse\n\t\t\t{\n\t\t\t\tposLeft  = posLeftOnRight;\n\t\t\t\tnewWidth = Math.min(\n\t\t\t\t\tmaxWidth,\n\t\t\t\t\tboxWidth,\n\t\t\t\t\tdocument.body.scrollWidth - posLeftOnRight  - 15\n\t\t\t\t);\n\t\t\t}\n\t\t}\n\t\telse\n\t\t{\n\t\t\t// TODO\n\t\t}\n\n\t\t$box.css({\n\t\t\t'top'       : posTop,\n\t\t\t'left'      : posLeft,\n\t\t\t'width'     : newWidth,\n\t\t});\n\n\t\tthis.$cite = $box;\n\t};\n\n\t// Includes (You) classes on posts that we think we own.\n\tblueprint.prototype.addCiteAuthorship = function() {\n\t\tvar widget = this;\n\t\tvar cites  = [];\n\n\t\t// Loop through each citation.\n\t\t$(this.options.selector['cite'], this.$widget).each(function() {\n\t\t\tvar board = this.dataset.board_uri;\n\t\t\tvar post  = this.dataset.board_id.toString();\n\n\t\t\t// Check and see if we have an item for this citation's board.\n\t\t\tif (typeof cites[board] === \"undefined\")\n\t\t\t{\n\t\t\t\tif (localStorage.getItem(\"yourPosts.\"+board) !== null)\n\t\t\t\t{\n\t\t\t\t\tcites[board] = localStorage.getItem(\"yourPosts.\"+board).split(\",\");\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tcites[board] = [];\n\t\t\t\t}\n\t\t\t}\n\n\t\t\tif (cites[board].length > 0 && cites[board].indexOf(post) >= 0)\n\t\t\t{\n\t\t\t\tthis.className += \" \" + widget.options.classname['cite-you'];\n\t\t\t}\n\t\t});\n\t};\n\n\t// Event bindings\n\tblueprint.prototype.bind = function() {\n\t\tvar widget  = this;\n\t\tvar $widget = this.$widget;\n\t\tvar data    = {\n\t\t\twidget  : widget,\n\t\t\t$widget : $widget\n\t\t};\n\n\t\t$(window)\n\t\t\t.on(\n\t\t\t\t'au-updated.ib-post',\n\t\t\t\tdata,\n\t\t\t\twidget.events.threadNewPosts\n\t\t\t);\n\n\t\t$(document)\n\t\t\t.on(\n\t\t\t\t'ready.ib-post',\n\t\t\t\tdata,\n\t\t\t\twidget.events.codeHighlight\n\t\t\t);\n\n\t\t$widget\n\t\t\t.on(\n\t\t\t\t'contentUpdate.ib-post',\n\t\t\t\tdata,\n\t\t\t\twidget.events.postContentUpdate\n\t\t\t)\n\t\t\t.on(\n\t\t\t\t'click.ib-post',\n\t\t\t\twidget.options.selector['post-reply'],\n\t\t\t\tdata,\n\t\t\t\twidget.events.postClick\n\t\t\t)\n\t\t\t.on(\n\t\t\t\t'highlight-syntax.ib-post',\n\t\t\t\twidget.options.selector['post-reply'],\n\t\t\t\tdata,\n\t\t\t\twidget.events.codeHighlight\n\t\t\t)\n\t\t\t.on(\n\t\t\t\t'mouseover.ib-post',\n\t\t\t\twidget.options.selector['attachment-image-expandable'],\n\t\t\t\tdata,\n\t\t\t\twidget.events.attachmentMediaMouseOver\n\t\t\t)\n\t\t\t.on(\n\t\t\t\t'mouseout.ib-post',\n\t\t\t\twidget.options.selector['attachment-image-expandable'],\n\t\t\t\tdata,\n\t\t\t\twidget.events.attachmentMediaMouseOut\n\t\t\t)\n\t\t\t.on(\n\t\t\t\t'media-check.ib-post',\n\t\t\t\twidget.options.selector['attachment-image'],\n\t\t\t\tdata,\n\t\t\t\twidget.events.attachmentMediaCheck\n\t\t\t)\n\t\t\t.on(\n\t\t\t\t'click.ib-post',\n\t\t\t\twidget.options.selector['attacment-expand'],\n\t\t\t\tdata,\n\t\t\t\twidget.events.attachmentExpandClick\n\t\t\t)\n\t\t\t.on(\n\t\t\t\t'click.ib-post',\n\t\t\t\twidget.options.selector['attacment-collapse'],\n\t\t\t\tdata,\n\t\t\t\twidget.events.attachmentCollapseClick\n\t\t\t)\n\n\t\t\t// Citations\n\t\t\t.on(\n\t\t\t\t'click.ib-post',\n\t\t\t\twidget.options.selector['cite'],\n\t\t\t\tdata,\n\t\t\t\twidget.events.citeClick\n\t\t\t)\n\t\t\t.on(\n\t\t\t\t'mouseover.ib-post',\n\t\t\t\twidget.options.selector['cite'],\n\t\t\t\tdata,\n\t\t\t\twidget.events.citeMouseOver\n\t\t\t)\n\t\t\t.on(\n\t\t\t\t'mouseout.ib-post',\n\t\t\t\twidget.options.selector['cite'],\n\t\t\t\tdata,\n\t\t\t\twidget.events.citeMouseOut\n\t\t\t)\n\t\t;\n\n\t\t$widget.trigger('contentUpdate');\n\t\twidget.addCiteAuthorship();\n\t\twidget.cachePosts($widget);\n\t};\n\n\tblueprint.prototype.bindMediaEvents = function($element) {\n\t\tvar data = {\n\t\t\twidget  : this,\n\t\t\t$widget : this.$widget\n\t\t};\n\n\t\t$element.on(\n\t\t\t'ended.ib-post',\n\t\t\tdata,\n\t\t\tthis.events.attachmentMediaEnded\n\t\t);\n\t};\n\n\t// Stores a post in the session store.\n\tblueprint.prototype.cachePosts = function(jsonOrjQuery) {\n\t\t// This stores the post data into a session storage for fast loading.\n\t\tif (typeof sessionStorage === \"object\")\n\t\t{\n\t\t\tvar $post;\n\n\t\t\tif (jsonOrjQuery instanceof jQuery)\n\t\t\t{\n\t\t\t\t$post = jsonOrjQuery;\n\t\t\t}\n\t\t\telse if (jsonOrjQuery.html)\n\t\t\t{\n\t\t\t\tvar $post = $(jsonOrjQuery.html);\n\t\t\t}\n\n\t\t\t// We do this even with an item we pulled from AJAX to remove the ID.\n\t\t\t// The HTML dom cannot have duplicate IDs, ever. It's important.\n\t\t\tvar $post = $($post[0].outerHTML); // Can't use .clone()\n\n\t\t\tif (typeof $post[0] !== \"undefined\")\n\t\t\t{\n\t\t\t\tvar id    = $post[0].id;\n\t\t\t\t$post.removeAttr('id');\n\t\t\t\tvar html = $post[0].outerHTML;\n\n\t\t\t\t// Attempt to set a new storage item.\n\t\t\t\t// Destroy older items if we are full.\n\t\t\t\tvar setting = true;\n\n\t\t\t\twhile (setting === true)\n\t\t\t\t{\n\t\t\t\t\ttry\n\t\t\t\t\t{\n\t\t\t\t\t\tsessionStorage.setItem( id, html );\n\t\t\t\t\t\tbreak;\n\t\t\t\t\t}\n\t\t\t\t\tcatch (e)\n\t\t\t\t\t{\n\t\t\t\t\t\tif (sessionStorage.length > 0)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsessionStorage.removeItem( sessionStorage.key(0) );\n\t\t\t\t\t\t}\n\t\t\t\t\t\telse\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tsetting = false;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn $post;\n\t\t\t}\n\t\t}\n\n\t\treturn null;\n\t};\n\n\t// Clears existing hover-over divs created by anchorBoxToLink.\n\tblueprint.prototype.clearCites = function() {\n\t\tif (this.$cite instanceof jQuery)\n\t\t{\n\t\t\tthis.$cite.remove();\n\t\t}\n\n\t\t$(\".\"+this.options.classname['post-hover']).remove();\n\n\t\tthis.$cite    = null;\n\t\tthis.citeLoad = null;\n\t};\n\n\t// Events\n\tblueprint.prototype.events = {\n\t\tattachmentCollapseClick : function(event) {\n\t\t\tvar widget  = event.data.widget;\n\t\t\tvar $link   = $(this);\n\t\t\tvar $item   = $link.parents(\"li.post-attachment\");\n\t\t\tvar $img    = $(widget.options.selector['attachment-image'], $item);\n\t\t\tvar $inline = $(widget.options.selector['attachment-inline'], $item);\n\n\t\t\tif ($inline.length > 0)\n\t\t\t{\n\t\t\t\t$(\"[src]\", $item).attr('src', \"\");\n\t\t\t\t$inline[0].pause(0);\n\t\t\t\t$inline[0].src = \"\";\n\t\t\t\t$inline[0].load();\n\t\t\t}\n\n\t\t\tif ($img.is('[data-thumb-width]'))\n\t\t\t{\n\t\t\t\t$img.css('width', $img.attr('data-thumb-width') + \"px\");\n\t\t\t}\n\n\t\t\tif ($img.is('[data-thumb-height]'))\n\t\t\t{\n\t\t\t\t$img.css('height', $img.attr('data-thumb-height') + \"px\");\n\t\t\t}\n\n\t\t\t$item.removeClass('attachment-expanded');\n\t\t\t$img.attr('src', $link.attr('data-thumb-url'));\n\t\t\t$inline.remove();\n\t\t\t$img.toggle(true);\n\t\t\t$img.parent().css({\n\t\t\t\t'background-image' : 'none',\n\t\t\t\t'min-width'        : '',\n\t\t\t\t'min-height'       : '',\n\t\t\t});\n\n\t\t\tif (event.delegateTarget === widget.$widget[0])\n\t\t\t{\n\t\t\t\twidget.$widget[0].scrollIntoView({\n\t\t\t\t\tblock    : \"start\",\n\t\t\t\t\tbehavior : \"instant\"\n\t\t\t\t});\n\t\t\t}\n\n\t\t\tevent.preventDefault();\n\t\t\treturn false;\n\t\t},\n\n\t\tattachmentMediaCheck : function(event) {\n\t\t\tvar widget = event.data.widget;\n\t\t\tvar $img   = $(this);\n\t\t\tvar $link  = $img.parents(widget.options.selector['attachment-link']).first();\n\n\t\t\t// Check for previous results.\n\t\t\tif ($link.is(\".attachment-canplay\"))\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t\telse if ($link.is(\".attachment-cannotplay\"))\n\t\t\t{\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\t// Test audio.\n\t\t\tif ($img.is(widget.options.selector['attachment-image-audio']))\n\t\t\t{\n\t\t\t\tvar $audio  = $(\"<audio></audio>\");\n\t\t\t\tvar mimetype = $img.attr('data-mime');\n\t\t\t\tvar fileext  = $link.attr('href').split('.').pop();\n\n\t\t\t\tif ($audio[0].canPlayType(mimetype) != \"\" || $audio[0].canPlayType(\"audio/\"+fileext) != \"\")\n\t\t\t\t{\n\t\t\t\t\t$link.addClass(\"attachment-canplay\");\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\t// Test video.\n\t\t\telse if ($img.is(widget.options.selector['attachment-image-video']))\n\t\t\t{\n\t\t\t\tvar $video   = $(\"<video></video>\");\n\t\t\t\tvar mimetype = $img.attr('data-mime');\n\t\t\t\tvar fileext  = $link.attr('href').split('.').pop();\n\n\t\t\t\tif ($video[0].canPlayType(mimetype) || $video[0].canPlayType(\"video/\"+fileext))\n\t\t\t\t{\n\t\t\t\t\t$link.addClass(\"attachment-canplay\");\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$link.addClass(\"attachment-canplay\");\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// Add failure results.\n\t\t\t$link.addClass('attachment-cannotplay');\n\n\t\t\t$img\n\t\t\t\t.addClass('attachment-type-file')\n\t\t\t\t.removeClass('attachment-type-video attachment-type-audio');\n\n\t\t\treturn false;\n\t\t},\n\n\t\tattachmentMediaEnded : function(event) {\n\t\t\tvar widget  = event.data.widget;\n\t\t\tvar $media  = $(this);\n\t\t\tvar $item   = $media.parents(\"li.post-attachment\");\n\t\t\tvar $link   = $(widget.options.selector['attachment-link'], $item);\n\t\t\tvar $img    = $(widget.options.selector['attachment-image'], $item);\n\t\t\tvar $inline = $(widget.options.selector['attachment-inline'], $item);\n\n\t\t\t$item.removeClass('attachment-expanded');\n\t\t\t$img.attr('src', $link.attr('data-thumb-url'));\n\t\t\t$inline.remove();\n\t\t\t$img.toggle(true);\n\t\t\t$img.parent().addClass('attachment-grow');\n\t\t},\n\n\t\tattachmentMediaMouseOver : function(event) {\n\t\t\tvar widget   = event.data.widget;\n\n\t\t\tif (!widget.is('attachment_preview')) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tvar $img     = $(this);\n\t\t\tvar $link    = $img.parents(widget.options.selector['attachment-link']).first();\n\t\t\tvar $preview = $(widget.options.selector['hover-box']);\n\n\t\t\t$preview.children().attr('src', $link.attr('data-download-url'));\n\t\t\t$preview.show();\n\t\t},\n\n\t\tattachmentMediaMouseOut : function(event) {\n\t\t\tvar widget   = event.data.widget;\n\t\t\tvar $img     = $(this);\n\t\t\tvar $link    = $img.parents(widget.options.selector['attachment-link']).first();\n\t\t\tvar $preview = $(widget.options.selector['hover-box']);\n\n\t\t\t$preview.children().attr('src', \"\");\n\t\t\t$preview.hide();\n\t\t},\n\n\t\tattachmentExpandClick : function(event) {\n\t\t\tvar widget = event.data.widget;\n\t\t\tvar $link  = $(this);\n\t\t\tvar $item  = $link.parents(\"li.post-attachment\");\n\t\t\tvar $img   = $(widget.options.selector['attachment-image'], $link);\n\n\t\t\t// We don't do anything if the user is CTRL+Clicking,\n\t\t\t// or if the file is a download type.\n\t\t\tif (event.altKey || event.ctrlKey || $img.is(widget.options.selector['attachment-image-download']))\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// If the attachment type is not an image, we can't expand inline.\n\t\t\tif ($img.is(widget.options.selector['attachment-image-expandable']))\n\t\t\t{\n\t\t\t\t$item.addClass('attachment-expanded');\n\t\t\t\t$img.parent().css({\n\t\t\t\t\t\t// Removed because the effect was gross.\n\t\t\t\t\t\t// 'background-image'    : 'url(' + $link.attr('data-thumb-url') + ')',\n\t\t\t\t\t\t// 'background-size'     : '100%',\n\t\t\t\t\t\t// 'background-repeat'   : 'no-repeat',\n\t\t\t\t\t\t// 'background-position' : 'center center',\n\t\t\t\t\t\t'min-width'           : $img.width() + 'px',\n\t\t\t\t\t\t'min-height'          : $img.height() + 'px',\n\t\t\t\t\t\t'height'              : \"auto\",\n\t\t\t\t\t\t'width'               : \"auto\",\n\t\t\t\t\t\t'opacity'             : 0.5,\n\t\t\t\t\t});\n\n\t\t\t\t// Clear source first so that lodaing works correctly.\n\t\t\t\t$img\n\t\t\t\t\t.attr('data-thumb-width', $img.width())\n\t\t\t\t\t.attr('data-thumb-height', $img.height())\n\t\t\t\t\t.attr('src', \"\")\n\t\t\t\t\t.css({\n\t\t\t\t\t\t'width'  : \"auto\",\n\t\t\t\t\t\t'height' : \"auto\"\n\t\t\t\t\t});\n\n\t\t\t\t$img\n\t\t\t\t\t// Change the source of our thumb to the full image.\n\t\t\t\t\t.attr('src', $link.attr('data-download-url'))\n\t\t\t\t\t// Bind an event to handle the image loading.\n\t\t\t\t\t.one(\"load\", function() {\n\t\t\t\t\t\t// Remove our opacity change.\n\t\t\t\t\t\t$(this).parent().css({\n\t\t\t\t\t\t\t// 'background-image' : \"none\",\n\t\t\t\t\t\t\t// 'min-width'        : '',\n\t\t\t\t\t\t\t// 'min-height'       : '',\n\t\t\t\t\t\t\t'opacity'          : \"\"\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t\telse if ($img.is(widget.options.selector['attachment-image-audio']))\n\t\t\t{\n\t\t\t\tvar $audio  = $(\"<audio controls autoplay class=\\\"attachment-inline attachment-audio\\\"></audio>\");\n\t\t\t\tvar $source = $(\"<source />\");\n\t\t\t\tvar mimetype = $img.attr('data-mime');\n\t\t\t\tvar fileext  = $link.attr('href').split('.').pop();\n\n\t\t\t\tif ($audio[0].canPlayType(mimetype) || $audio[0].canPlayType(\"audio/\"+fileext))\n\t\t\t\t{\n\t\t\t\t\t$item.addClass('attachment-expanded');\n\n\t\t\t\t\t$source\n\t\t\t\t\t\t.attr('src',  $link.attr('href'))\n\t\t\t\t\t\t.attr('type', $img.attr('data-mime'))\n\t\t\t\t\t\t.one('error', function(event) {\n\t\t\t\t\t\t\t// Our source has failed to load!\n\t\t\t\t\t\t\t// Trigger a download.\n\t\t\t\t\t\t\t$img\n\t\t\t\t\t\t\t\t.trigger('click')\n\t\t\t\t\t\t\t\t.removeClass('attachment-type-audio')\n\t\t\t\t\t\t\t\t.addClass('attachment-type-file');\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.appendTo($audio);\n\n\t\t\t\t\t$audio.insertBefore($link);\n\t\t\t\t\twidget.bindMediaEvents($audio);\n\n\t\t\t\t\t$audio.parent().addClass('attachment-grow');\n\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse if ($img.is(widget.options.selector['attachment-image-video']))\n\t\t\t{\n\t\t\t\tvar $video   = $(\"<video controls autoplay class=\\\"attachment-inline attachment-video\\\"></video>\");\n\t\t\t\tvar $source  = $(\"<source />\");\n\t\t\t\tvar mimetype = $img.attr('data-mime');\n\t\t\t\tvar fileext  = $link.attr('href').split('.').pop();\n\n\t\t\t\tif ($video[0].canPlayType(mimetype) || $video[0].canPlayType(\"video/\"+fileext))\n\t\t\t\t{\n\t\t\t\t\t$item.addClass('attachment-expanded');\n\n\t\t\t\t\t$source\n\t\t\t\t\t\t.attr('src',  $link.attr('href'))\n\t\t\t\t\t\t.attr('type', $img.attr('data-mime'))\n\t\t\t\t\t\t.one('error', function(event) {\n\t\t\t\t\t\t\t// Our source has failed to load!\n\t\t\t\t\t\t\t// Trigger a download.\n\t\t\t\t\t\t\t$img\n\t\t\t\t\t\t\t\t.trigger('click')\n\t\t\t\t\t\t\t\t.removeClass('attachment-type-video')\n\t\t\t\t\t\t\t\t.addClass('attachment-type-download attachment-type-failed');\n\t\t\t\t\t\t})\n\t\t\t\t\t\t.appendTo($video);\n\n\t\t\t\t\t$img.toggle(false);\n\n\t\t\t\t\twidget.bindMediaEvents($video);\n\t\t\t\t\t$video.insertBefore($link);\n\n\t\t\t\t\tevent.preventDefault();\n\t\t\t\t\treturn false;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\t$img\n\t\t\t\t\t\t.addClass('attachment-type-file')\n\t\t\t\t\t\t.removeClass('attachment-type-video');\n\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\t\t},\n\n\t\tciteClick : function(event) {\n\t\t\tif (event.altKey || event.ctrlKey)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tvar $cite     = $(this);\n\t\t\tvar board_uri = $cite.attr('data-board_uri');\n\t\t\tvar board_id  = parseInt($cite.attr('data-board_id'), 10);\n\t\t\tvar $target   = $(\"#post-\"+board_uri+\"-\"+board_id);\n\n\t\t\tif ($target.length)\n\t\t\t{\n\t\t\t\twindow.location.hash = board_id;\n\t\t\t\t$target[0].scrollIntoView();\n\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\n\t\tciteMouseOver : function(event) {\n\t\t\tvar widget    = event.data.widget;\n\t\t\tvar $cite     = $(this);\n\t\t\tvar board_uri = $cite.attr('data-board_uri');\n\t\t\tvar board_id  = parseInt($cite.attr('data-board_id'), 10);\n\t\t\tvar post_id   = \"post-\"+board_uri+\"-\"+board_id;\n\t\t\tvar $post;\n\n\t\t\t// Prevent InstantClick hijacking requests we can handle without\n\t\t\t// reloading the document.\n\t\t\tif ($(\"#\"+post_id).length)\n\t\t\t{\n\t\t\t\t$cite.attr('data-no-instant', \"data-no-instant\");\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t$cite.removeAttr('data-no-instant');\n\t\t\t}\n\n\t\t\twidget.clearCites();\n\n\t\t\tif (widget.citeLoad == post_id)\n\t\t\t{\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\t// Loads session storage for our post if it exists.\n\t\t\tif (typeof sessionStorage === \"object\")\n\t\t\t{\n\t\t\t\t$post = $(sessionStorage.getItem( post_id ));\n\n\t\t\t\tif ($post instanceof jQuery && $post.length)\n\t\t\t\t{\n\t\t\t\t\twidget.anchorBoxToLink($post, $cite);\n\t\t\t\t\treturn true;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\twidget.citeLoad = post_id;\n\n\t\t\tjQuery.ajax({\n\t\t\t\ttype:        \"GET\",\n\t\t\t\turl:         \"/\"+board_uri+\"/post/\"+board_id+\".json\",\n\t\t\t\tcontentType: \"application/json; charset=utf-8\"\n\t\t\t}).done(function(response, textStatus, jqXHR) {\n\t\t\t\t$post = widget.cachePosts(response);\n\n\t\t\t\tif (widget.citeLoad === post_id)\n\t\t\t\t{\n\t\t\t\t\twidget.anchorBoxToLink($post, $cite);\n\t\t\t\t}\n\t\t\t});\n\t\t},\n\n\t\tciteMouseOut : function(event) {\n\t\t\tevent.data.widget.clearCites();\n\t\t},\n\n\t\t// Adds HLJS syntax formatting to posts.\n\t\tcodeHighlight : function(event) {\n\t\t\tvar widget  = event.data.widget;\n\t\t\tvar $widget =  event.data.$widget;\n\n\t\t\t// Activate code highlighting if the JS module is enabled.\n\t\t\tif (typeof window.hljs === \"object\")\n\t\t\t{\n\t\t\t\t$(widget.options.selector['element-code'], $widget).each(function()\n\t\t\t\t{\n\t\t\t\t\twindow.hljs.highlightBlock(this);\n\t\t\t\t});\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tconsole.log(\"post.codeHighlight: missing hljs\");\n\t\t\t}\n\t\t},\n\n\t\tpostClick : function(event) {\n\t\t\tvar widget = event.data.widget;\n\n\t\t\tif ($(widget.options.selector['mode-reply']).length !== 0)\n\t\t\t{\n\t\t\t\tevent.preventDefault();\n\n\t\t\t\tvar $this = $(this);\n\t\t\t\tvar $body = $(widget.options.selector['post-form-body']);\n\n\t\t\t\t$body\n\t\t\t\t\t.val($body.val() + \">>\" + $this.data('board_id') + \"\\n\")\n\t\t\t\t\t.focus();\n\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn true;\n\t\t},\n\n\t\tpostContentUpdate : function(event) {\n\t\t\tvar widget  = event.data.widget;\n\t\t\tvar $widget =  event.data.$widget;\n\n\t\t\t$(widget.options.selector.author_id, $widget)\n\t\t\t\t.toggle(widget.is('author_id'));\n\n\t\t\t$widget.trigger('highlight-syntax');\n\t\t},\n\n\t\tthreadNewPosts : function(event, posts) {\n\t\t\t// Data of our widget, the item we are hoping to insert new citations into.\n\t\t\tvar widget           = event.data.widget;\n\t\t\tvar $detail          = $(widget.options.selector['cite-slot'], widget.$widget);\n\t\t\tvar $backlinks       = $detail.children();\n\t\t\tvar backlinks        = 0;\n\t\t\tvar widget_board_uri = widget.$widget.attr('data-board_uri');\n\t\t\tvar widget_board_id  = widget.$widget.attr('data-board_id');\n\n\t\t\t// All new updates show off their posts in three difeferent groups.\n\t\t\tjQuery.each(posts, function(index, group) {\n\t\t\t\t// Each group can have many jQuery dom elements.\n\t\t\t\tjQuery.each(group, function(index, $post) {\n\t\t\t\t\t// This information belongs to a new post.\n\t\t\t\t\tvar $container     = $post.find(\"[data-board_uri][data-board_id]:first\");\n\t\t\t\t\tvar post_board_uri = $container.attr('data-board_uri');\n\t\t\t\t\tvar post_board_id  = $container.attr('data-board_id');\n\t\t\t\t\tvar $cites         = $(widget.options.selector['forwardlink'], $container);\n\n\t\t\t\t\t$post.trigger('highlight-syntax');\n\n\t\t\t\t\t// Each post may have many citations.\n\t\t\t\t\t$cites.each(function(index) {\n\t\t\t\t\t\t// This information represents the post we are citing.\n\t\t\t\t\t\tvar $cite          = $(this);\n\t\t\t\t\t\tvar cite_board_uri = $cite.attr('data-board_uri');\n\t\t\t\t\t\tvar cite_board_id  = $cite.attr('data-board_id');\n\n\t\t\t\t\t\t// If it doesn't belong to our widget, we don't want it.\n\t\t\t\t\t\tif (cite_board_uri == widget_board_uri && cite_board_id == widget_board_id)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tvar $target    = $(\"#post-\" + cite_board_uri + \"-\" + post_board_id);\n\n\t\t\t\t\t\t\tif (!$backlinks.filter(\"[data-board_uri=\"+post_board_uri+\"][data-board_id=\"+post_board_id+\"]\").length)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar $backlink = $(widget.options.template['backlink'])\n\t\t\t\t\t\t\t\t\t.attr('data-board_uri', post_board_uri)\n\t\t\t\t\t\t\t\t\t.data('board_uri', post_board_uri)\n\t\t\t\t\t\t\t\t\t.attr('data-board_id', post_board_id)\n\t\t\t\t\t\t\t\t\t.data('board_id', post_board_id)\n\t\t\t\t\t\t\t\t\t.attr('href', \"/\" + post_board_uri + \"/post/\" + post_board_id)\n\t\t\t\t\t\t\t\t\t.appendTo($detail);\n\n\t\t\t\t\t\t\t\t$backlinks = $backlinks.add($backlink);\n\t\t\t\t\t\t\t\t++backlinks;\n\n\t\t\t\t\t\t\t\t// Believe it or not this is actually important.\n\t\t\t\t\t\t\t\t// it adds a space after each item.\n\t\t\t\t\t\t\t\t$detail.append(\"\\n\");\n\n\t\t\t\t\t\t\t\tif (post_board_uri == window.app.board)\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$backlink.addClass('cite-local').html(\"&gt;&gt;\" + post_board_id);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t$backlink.addClass('cite-remote').html(\"&gt;&gt;&gt;/\" + post_board_uri + \"/\" + post_board_id);\n\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t}\n\t\t\t\t\t});\n\t\t\t\t});\n\t\t\t});\n\n\t\t\tif (backlinks)\n\t\t\t{\n\t\t\t\twidget.addCiteAuthorship();\n\t\t\t}\n\t\t}\n\t};\n\n\tib.widget(\"post\", blueprint, options);\n})(window, window.jQuery);\n","// ===========================================================================\n// Purpose          : Posts\n// Contributors     : jaw-sh\n// Widget Version   : 2\n// ===========================================================================\n\n(function(window, $, undefined) {\n\t// Widget blueprint\n\tvar blueprint = ib.getBlueprint();\n\n\tvar options = {\n\t\tpassword : {\n\t\t\ttype : \"text\",\n\t\t\tinitial : ib.randomString(8),\n\t\t}\n\t};\n\n\t// Dropzone instance.\n\tblueprint.prototype.dropzone = null;\n\n\t\t// jQuery UI bind indicators\n\tblueprint.prototype.resizable = false;\n\tblueprint.prototype.draggable = false;\n\tblueprint.prototype.axis      = ib.ltr ? \"sw\" : \"se\";\n\n\t// Other widget instances.\n\tblueprint.prototype.notices = null;\n\n\t// Number of uploads running.\n\t// Used to prevent premature form submission.\n\tblueprint.prototype.activeUploads = 0;\n\n\t\t// The default values that are set behind init values.\n\tblueprint.prototype.defaults = {\n\t\tcheckFileUrl  : window.app.board_url + \"/check-file\",\n\n\t\t// Selectors for finding and binding elements.\n\t\tselector : {\n\t\t\t'widget'          : \"#post-form\",\n\t\t\t'notices'         : \"[data-widget=notice]:first\",\n\t\t\t'autoupdater'     : \".autoupdater:first\",\n\n\t\t\t'dropzone'        : \".dz-container\",\n\n\t\t\t'submit-post'     : \"#submit-post\",\n\n\t\t\t// This is the main postbox password.\n\t\t\t'password'        : \"#password\",\n\t\t\t// This is any field that uses the same password.\n\t\t\t'post-password'   : \".post-password\",\n\n\t\t\t'form-fields'     : \".form-fields\",\n\t\t\t'form-body'       : \"#body\",\n\t\t\t'form-clear'      : \"#subject, #body, #captcha\",\n\t\t\t'form-spoiler'    : \".dz-spoiler-check\",\n\n\t\t\t'captcha'         : \".captcha\",\n\t\t\t'captcha-row'     : \".row-captcha\",\n\t\t\t'captcha-field'   : \".field-control\",\n\n\t\t\t'button-close'    : \".menu-icon-close\",\n\t\t\t'button-maximize' : \".menu-icon-maximize\",\n\t\t\t'button-minimize' : \".menu-icon-minimize\"\n\t\t},\n\n\t\ttemplate : {\n\t\t\t'counter'         : \"<tt id=\\\"body-counter\\\"></tt>\",\n\t\t},\n\n\t\tdropzone : {\n\t\t\t// Localization strings.\n\t\t\t// dictDefaultMessage: \"Drop files here to upload\",\n\t\t\t// dictFallbackMessage: \"Your browser does not support drag'n'drop file uploads.\",\n\t\t\t// dictFallbackText: \"Please use the fallback form below to upload your files like in the olden days.\",\n\t\t\t// dictFileTooBig: \"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.\",\n\t\t\t// dictInvalidFileType: \"You can't upload files of this type.\",\n\t\t\t// dictResponseError: \"Server responded with {{statusCode}} code.\",\n\t\t\t// dictCancelUpload: \"Cancel upload\",\n\t\t\t// dictCancelUploadConfirmation: \"Are you sure you want to cancel this upload?\",\n\t\t\t// dictRemoveFile: \"Remove file\",\n\t\t\t// dictRemoveFileConfirmation: null,\n\t\t\t// dictMaxFilesExceeded: \"You can not upload any more files.\",\n\n\t\t\t// The input field name.\n\t\t\tparamName      : \"files\",\n\n\t\t\t// File upload URL\n\t\t\turl            : window.app.board_url + \"/upload-file\",\n\n\t\t\t// Allow multiple uploads.\n\t\t\tuploadMultiple : true,\n\n\t\t\t// Maximum filesize (MB)\n\t\t\tmaxFilesize    : window.app.settings.attachmentFilesize / 1024,\n\n\t\t\t// Binds the instance to our widget.\n\t\t\tinit: function() {\n\t\t\t\tvar widget = this.options.widget;\n\n\t\t\t\twidget.dropzone = this;\n\t\t\t\tthis.widget     = widget;\n\t\t\t\tthis.$widget    = widget.$widget;\n\n\t\t\t\t$(this.element).append(\"<input type=\\\"hidden\\\" name=\\\"dropzone\\\" value=\\\"1\\\" />\");\n\t\t\t},\n\n\t\t\t// Handles the acceptance of files.\n\t\t\taccept : function(file, done) {\n\t\t\t\tvar widget  = this.widget;\n\t\t\t\tvar $widget = this.$widget;\n\t\t\t\tvar reader  = new FileReader();\n\n\t\t\t\twidget.$widget.trigger('fileUploading', [ file ]);\n\n\t\t\t\treader.onload = function (event) {\n\t\t\t\t\tvar Hasher = new SparkMD5;\n\t\t\t\t\tHasher.appendBinary(this.result);\n\n\t\t\t\t\tvar hash = Hasher.end();\n\t\t\t\t\tfile.hash = hash;\n\n\t\t\t\t\tjQuery.get( widget.options.checkFileUrl, {\n\t\t\t\t\t\t'md5' : hash\n\t\t\t\t\t})\n\t\t\t\t\t\t.done(function(data, textStatus, jqXHR) {\n\t\t\t\t\t\t\tif (typeof data === \"object\")\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tvar response = data;\n\n\t\t\t\t\t\t\t\tjQuery.each(response, function(index, datum) {\n\t\t\t\t\t\t\t\t\t// Make sure this datum is for our file.\n\t\t\t\t\t\t\t\t\tif (index !== hash)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\treturn true;\n\t\t\t\t\t\t\t\t\t}\n\n\t\t\t\t\t\t\t\t\t// Does this file exist?\n\t\t\t\t\t\t\t\t\tif (datum !== null)\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t// Is the file banned?\n\t\t\t\t\t\t\t\t\t\tif (datum.banned == 1)\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\t// Language\n\t\t\t\t\t\t\t\t\t\t\tconsole.log(\"File \"+file.name+\" is banned from being uploaded.\");\n\n\t\t\t\t\t\t\t\t\t\t\tfile.status = Dropzone.ERROR;\n\t\t\t\t\t\t\t\t\t\t\twidget.dropzone.emit(\"error\", file, \"File <tt>\"+file.name+\"</tt> is banned from being uploaded\", jqXHR);\n\t\t\t\t\t\t\t\t\t\t\twidget.dropzone.emit(\"complete\", file);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\t\tconsole.log(\"File \"+file.name+\" already exists.\");\n\n\t\t\t\t\t\t\t\t\t\t\tfile.status = window.Dropzone.SUCCESS;\n\t\t\t\t\t\t\t\t\t\t\twidget.dropzone.emit(\"success\", file, datum, jqXHR);\n\t\t\t\t\t\t\t\t\t\t\twidget.dropzone.emit(\"complete\", file);\n\t\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t\t// If no presence, upload anew.\n\t\t\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\t\t\tconsole.log(\"Uploading file \"+file.name+\".\");\n\n\t\t\t\t\t\t\t\t\t\tdone();\n\t\t\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t\t});\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\telse\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\tconsole.log(\"Received weird response:\", data);\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t});\n\t\t\t\t};\n\n\t\t\t\treader.readAsBinaryString(file);\n\t\t\t},\n\n\t\t\tcanceled : function(file) {\n\t\t\t\tvar $widget = this.$widget;\n\t\t\t\t$widget.trigger('fileCanceled', [ file ]);\n\t\t\t},\n\n\t\t\terror : function(file, message, xhr) {\n\t\t\t\tvar widget  = this.widget;\n\t\t\t\tvar $widget = this.$widget;\n\n\t\t\t\twidget.notices.push(message, 'error');\n\n\t\t\t\t$(file.previewElement).remove();\n\n\t\t\t\t$widget.trigger('fileFailed', [ file ]);\n\t\t\t},\n\n\t\t\tremovedfile : function(file) {\n\t\t\t\tvar widget = this.widget;\n\t\t\t\tvar _ref;\n\n\t\t\t\tif (file.previewElement) {\n\t\t\t\t\tif ((_ref = file.previewElement) != null) {\n\t\t\t\t\t\t_ref.parentNode.removeChild(file.previewElement);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\twidget.resizePostbox();\n\n\t\t\t\treturn this._updateMaxFilesReachedClass();\n\t\t\t},\n\n\t\t\tsuccess : function(file, response, xhr) {\n\t\t\t\tvar widget  = this.widget;\n\t\t\t\tvar $widget = this.$widget;\n\n\t\t\t\tif (typeof response !== \"object\")\n\t\t\t\t{\n\t\t\t\t\tvar response = jQuery.parseJSON(response);\n\t\t\t\t}\n\n\t\t\t\tif (typeof response.errors !== \"undefined\")\n\t\t\t\t{\n\t\t\t\t\tjQuery.each(response.errors, function(field, errors)\n\t\t\t\t\t{\n\t\t\t\t\t\tjQuery.each(errors, function(index, error)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\twidget.dropzone.emit(\"error\", file, error, xhr);\n\t\t\t\t\t\t\twidget.dropzone.emit(\"complete\", file);\n\t\t\t\t\t\t});\n\t\t\t\t\t});\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tvar $preview = $(file.previewElement);\n\n\t\t\t\t\t$preview\n\t\t\t\t\t\t.addClass('dz-success')\n\t\t\t\t\t\t.append($(\"<input type=\\\"hidden\\\" />\").attr('name', widget.options.dropzone.paramName+\"[hash][]\").val(file.hash))\n\t\t\t\t\t\t.append($(\"<input type=\\\"hidden\\\" />\").attr('name', widget.options.dropzone.paramName+\"[name][]\").val(file.name))\n\t\t\t\t\t;\n\n\t\t\t\t\t$(\"[data-dz-spoiler]\", $preview)\n\t\t\t\t\t\t.attr('name', widget.options.dropzone.paramName+\"[spoiler][]\");\n\t\t\t\t}\n\n\t\t\t\t$widget.trigger('fileUploaded', [ file ]);\n\t\t\t},\n\n\t\t\tpreviewTemplate :\n\t\t\t\t\"<div class=\\\"dz-preview dz-file-preview\\\">\" +\n\t\t\t\t\t\"<div class=\\\"dz-image\\\">\" +\n\t\t\t\t\t\t\"<img data-dz-thumbnail />\" +\n\t\t\t\t\t\"</div>\" +\n\t\t\t\t\t\"<div class=\\\"dz-actions\\\">\" +\n\t\t\t\t\t\t\"<span class=\\\"dz-remove\\\" data-dz-remove>x</span>\" +\n\t\t\t\t\t\t\"<label class=\\\"dz-spoiler\\\">\" +\n\t\t\t\t\t\t\t\"<input type=\\\"checkbox\\\" class=\\\"dz-spoiler-check\\\" name=\\\"\\\" value=\\\"\\\" />\" +\n\t\t\t\t\t\t\t\"<input type=\\\"chidden\\\" class=\\\"dz-spoiler-hidden\\\" value=\\\"0\\\" data-dz-spoiler />\" +\n\t\t\t\t\t\t\t\"<span class=\\\"dz-spoiler-desc\\\">Spoiler</span>\" +\n\t\t\t\t\t\t\"</label>\" +\n\t\t\t\t\t\"</div>\" +\n\t\t\t\t\t\"<div class=\\\"dz-details\\\">\" +\n\t\t\t\t\t\t\"<div class=\\\"dz-size\\\"><span data-dz-size></span></div>\" +\n\t\t\t\t\t\t\"<div class=\\\"dz-filename\\\"><span data-dz-name></span></div>\" +\n\t\t\t\t\t\"</div>\" +\n\t\t\t\t\t\"<div class=\\\"dz-progress\\\"><span class=\\\"dz-upload\\\" data-dz-uploadprogress></span></div>\" +\n\t\t\t\t\t\"<div class=\\\"dz-success\\\">\" +\n\t\t\t\t\t\t\"<div class=\\\"dz-success-mark\\\">\" +\n\t\t\t\t\t\t\t\"<svg viewBox=\\\"0 0 54 54\\\" version=\\\"1.1\\\" xmlns=\\\"http://www.w3.org/2000/svg\\\" xmlns:xlink=\\\"http://www.w3.org/1999/xlink\\\" xmlns:sketch=\\\"http://www.bohemiancoding.com/sketch/ns\\\">\" +\n\t\t\t\t\t\t\t\t\"<g id=\\\"Page-1\\\" stroke=\\\"none\\\" stroke-width=\\\"1\\\" fill=\\\"none\\\" fill-rule=\\\"evenodd\\\" sketch:type=\\\"MSPage\\\">\" +\n\t\t\t\t\t\t\t\t\t\"<path d=\\\"M23.5,31.8431458 L17.5852419,25.9283877 C16.0248253,24.3679711 13.4910294,24.366835 11.9289322,25.9289322 C10.3700136,27.4878508 10.3665912,30.0234455 11.9283877,31.5852419 L20.4147581,40.0716123 C20.5133999,40.1702541 20.6159315,40.2626649 20.7218615,40.3488435 C22.2835669,41.8725651 24.794234,41.8626202 26.3461564,40.3106978 L43.3106978,23.3461564 C44.8771021,21.7797521 44.8758057,19.2483887 43.3137085,17.6862915 C41.7547899,16.1273729 39.2176035,16.1255422 37.6538436,17.6893022 L23.5,31.8431458 Z M27,53 C41.3594035,53 53,41.3594035 53,27 C53,12.6405965 41.3594035,1 27,1 C12.6405965,1 1,12.6405965 1,27 C1,41.3594035 12.6405965,53 27,53 Z\\\" \" +\n\t\t\t\t\t\t\t\t\t\t\"id=\\\"Oval-2\\\" \" +\n\t\t\t\t\t\t\t\t\t\t\"stroke-opacity=\\\"0.198794158\\\" \" +\n\t\t\t\t\t\t\t\t\t\t\"stroke=\\\"#747474\\\" \" +\n\t\t\t\t\t\t\t\t\t\t\"fill-opacity=\\\"0.816519475\\\" \" +\n\t\t\t\t\t\t\t\t\t\t\"fill=\\\"#FFFFFF\\\" \" +\n\t\t\t\t\t\t\t\t\t\t\"sketch:type=\\\"MSShapeGroup\\\" \" +\n\t\t\t\t\t\t\t\t\t\"></path>\" +\n\t\t\t\t\t\t\t\t\"</g>\" +\n\t\t\t\t\t\t\t\"</svg>\" +\n\t\t\t\t\t\t\"</div>\" +\n\t\t\t\t\t\"</div>\" +\n\t\t\t\t\"</div>\"\n\t\t}\n\t};\n\n\t// Compiled settings.\n\tblueprint.prototype.options = false;\n\n\tblueprint.prototype.hasCaptcha = function() {\n\t\treturn $(this.options.selector['captcha-row'], this.$widget).is(\":visible\");\n\t};\n\n\tblueprint.prototype.resizePostbox = function() {\n\t\tvar widget  = this;\n\t\tvar $widget = this.$widget;\n\n\t\tif (widget.resizable)\n\t\t{\n\t\t\tif (window.innerHeight < 480 || window.innerWidth < 728)\n\t\t\t{\n\t\t\t\twidget.unbindDraggable();\n\t\t\t\twidget.unbindResize();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\t// Trigger resize on the post body.\n\t\t\t\t// Forces the post box to obey new window constraints.\n\t\t\t\tvar $post    = $(widget.options.selector['form-body'], widget.$widget);\n\t\t\t\tvar uiWidget = $post.data('ui-resizable');\n\n\t\t\t\t// Widget is bound and we have data\n\t\t\t\tif (uiWidget && !jQuery.isEmptyObject(uiWidget.prevPosition))\n\t\t\t\t{\n\t\t\t\t\t// This is copy+pasted from the source code because there is no polite way\n\t\t\t\t\t// to handle it otherwise.\n\t\t\t\t\tuiWidget._updatePrevProperties();\n\t\t\t\t\tuiWidget._trigger( \"resize\", event, uiWidget.ui() );\n\t\t\t\t\tuiWidget._applyChanges();\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t\telse if (window.innerHeight >= 480 && window.innerWidth >= 728)\n\t\t{\n\t\t\tvar isClosed = $widget.hasClass(\"postbox-closed\");\n\t\t\tvar isMaximized = $widget.hasClass(\"postbox-maximized\");\n\n\t\t\tif (!isMaximized && !isClosed)\n\t\t\t{\n\t\t\t\twidget.bindResize();\n\t\t\t}\n\n\t\t\tif (!isMaximized)\n\t\t\t{\n\t\t\t\twidget.bindDraggable();\n\t\t\t}\n\t\t}\n\t};\n\n\t// Events\n\tblueprint.prototype.events = {\n\t\tbodyChange    : function(event) {\n\t\t\tvar widget  = event.data.widget;\n\t\t\tvar $widget = event.data.$widget;\n\n\t\t\tif (widget.$counter && widget.$counter instanceof jQuery)\n\t\t\t{\n\t\t\t\tvar $body = $(this);\n\t\t\t\tvar len   = $body.val().length;\n\t\t\t\tvar text  = \"<strong id=\\\"body-counter-curr\\\">\" + len + \"</strong>\";\n\t\t\t\tvar valid = true;\n\t\t\t\tvar free  = true;\n\t\t\t\tvar max   = parseInt(window.app.board_settings.postMaxLength, 10);\n\t\t\t\tvar min   = parseInt(window.app.board_settings.postMinLength, 10);\n\n\t\t\t\tif (!isNaN(max))\n\t\t\t\t{\n\t\t\t\t\ttext  = text + \"<span id=\\\"body-counter-max\\\">\" + max + \"</span>\";\n\t\t\t\t\tfree  = false;\n\t\t\t\t\tvalid = valid && (len <= max);\n\t\t\t\t}\n\n\t\t\t\tif (!isNaN(min))\n\t\t\t\t{\n\t\t\t\t\ttext  = \"<span id=\\\"body-counter-min\\\">\" + min + \"</span>\" + text;\n\t\t\t\t\tfree  = false;\n\t\t\t\t\tvalid = valid && (len >= min);\n\t\t\t\t}\n\n\t\t\t\tif (!free)\n\t\t\t\t{\n\t\t\t\t\twidget.$counter\n\t\t\t\t\t\t.toggleClass(\"counter-valid\",    valid)\n\t\t\t\t\t\t.toggleClass(\"counter-invalid\", !valid)\n\t\t\t\t\t\t.html(text);\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tcaptchaHide   : function(widget) {\n\t\t\tvar $widget = widget.$widget;\n\n\t\t\t$(widget.options.selector['captcha-row'], $widget).hide();\n\t\t},\n\n\t\tcaptchaShow   : function(widget) {\n\t\t\tvar $widget = widget.$widget;\n\n\t\t\t$(widget.options.selector['captcha-row'], $widget).show();\n\t\t},\n\n\t\tcloseClick    : function(event) {\n\t\t\tvar widget  = event.data.widget;\n\t\t\tvar $widget = event.data.$widget;\n\n\t\t\t// Tweak classes.\n\t\t\t$widget\n\t\t\t\t.removeClass(\"postbox-maximized postbox-minimized\")\n\t\t\t\t.addClass(\"postbox-closed\");\n\n\t\t\t// Unbind the jQuery UI resize.\n\t\t\twidget.unbindResize();\n\n\t\t\t// Prevents formClick from immediately firing.\n\t\t\tevent.stopPropagation();\n\t\t},\n\n\t\tfileUploading : function(event, file) {\n\t\t\tvar widget  = event.data.widget;\n\t\t\tvar $widget = event.data.$widget;\n\n\t\t\t++widget.activeUploads;\n\t\t\tconsole.log(widget.activeUploads + \" concurrent uploads.\");\n\n\t\t\t$(widget.options.selector['submit-post'], $widget)\n\t\t\t\t.prop('disabled', widget.activeUploads > 0);\n\t\t},\n\n\t\tfileCanceled  : function(event, file) {\n\t\t\tvar widget  = event.data.widget;\n\t\t\tvar $widget = event.data.$widget;\n\n\t\t\t--widget.activeUploads;\n\t\t\tconsole.log(widget.activeUploads + \" concurrent uploads.\");\n\n\t\t\t$(widget.options.selector['submit-post'], $widget)\n\t\t\t\t.prop('disabled', widget.activeUploads > 0);\n\t\t},\n\n\t\tfileFailed    : function(event, file) {\n\t\t\tvar widget  = event.data.widget;\n\t\t\tvar $widget = event.data.$widget;\n\n\t\t\t--widget.activeUploads;\n\t\t\tconsole.log(widget.activeUploads + \" concurrent uploads.\");\n\n\t\t\t$(widget.options.selector['submit-post'], $widget)\n\t\t\t\t.prop('disabled', widget.activeUploads > 0);\n\t\t},\n\n\t\tfileUploaded  : function(event, file) {\n\t\t\tvar widget  = event.data.widget;\n\t\t\tvar $widget = event.data.$widget;\n\n\t\t\t--widget.activeUploads;\n\t\t\tconsole.log(widget.activeUploads + \" concurrent uploads.\");\n\n\t\t\t$(widget.options.selector['submit-post'], $widget)\n\t\t\t\t.prop('disabled', widget.activeUploads > 0);\n\t\t},\n\n\t\tformClear     : function(event) {\n\t\t\tvar widget  = event.data.widget;\n\t\t\tvar $widget = event.data.$widget;\n\n\t\t\t// Stops redundant loading of captcha when we don't need one.\n\t\t\tif (widget.hasCaptcha())\n\t\t\t{\n\t\t\t\t$(widget.options.selector['captcha'], $widget).trigger('reload');\n\t\t\t}\n\n\t\t\tif (widget.dropzone)\n\t\t\t{\n\t\t\t\twidget.dropzone.removeAllFiles();\n\t\t\t}\n\n\t\t\t$(widget.options.selector['form-clear'], $widget)\n\t\t\t\t.val(\"\")\n\t\t\t\t.html(\"\");\n\n\t\t\t$(widget.options.selector['form-body'], $widget)\n\t\t\t\t.trigger('change')\n\t\t\t\t.focus();\n\t\t},\n\n\t\tformClick     : function(event) {\n\t\t\tvar widget  = event.data.widget;\n\t\t\tvar $widget = event.data.$widget;\n\n\t\t\tif ($widget.is(\".postbox-closed\"))\n\t\t\t{\n\t\t\t\t// Tweak classes.\n\t\t\t\t$widget.removeClass(\"postbox-minimized postbox-closed postbox-maximized\");\n\n\t\t\t\t// Rebind jQuery UI widgets.\n\t\t\t\twidget.bindDraggable();\n\t\t\t\twidget.bindResize();\n\t\t\t}\n\t\t},\n\n\t\tformSubmit    : function(event) {\n\t\t\tvar widget  = event.data.widget;\n\t\t\tvar $widget = event.data.$widget;\n\n\t\t\twidget.notices.clear();\n\n\t\t\tvar $form       = $(this).add(\"<input name=\\\"messenger\\\" value=\\\"1\\\" />\");\n\t\t\tvar $updater    = $(widget.options.selector['autoupdater']);\n\t\t\tvar autoupdater = false;\n\n\t\t\t// Note: serializeJSON is a plugin we use to convert form data into\n\t\t\t// a multidimensional array for application/json posts.\n\n\t\t\tif ($updater.length && $updater[0].widget)\n\t\t\t{\n\t\t\t\tvar data = $form.serialize();\n\n\t\t\t\tautoupdater = $updater[0].widget;\n\t\t\t\tdata = $form\n\t\t\t\t\t.add(\"<input name=\\\"updatesOnly\\\" value=\\\"1\\\" />\")\n\t\t\t\t\t.add(\"<input name=\\\"updateHtml\\\" value=\\\"1\\\" />\")\n\t\t\t\t\t.add(\"<input name=\\\"updatedSince\\\" value=\\\"\" + autoupdater.updateLast +\"\\\" />\")\n\t\t\t\t\t.serializeJSON();\n\t\t\t}\n\t\t\telse\n\t\t\t{\n\t\t\t\tvar data = $form.serializeJSON();\n\t\t\t}\n\n\t\t\t// Indicate we want a full messenger response.\n\t\t\tdata.messenger = true;\n\n\t\t\t// Temporarialy disable form and submit button to prevent double posting\n\t\t\t$form.prop('disabled', true);\n\t\t\t$(widget.options.selector['submit']).prop('disabled', true);\n\n\t\t\tjQuery.ajax({\n\t\t\t\ttype:        \"POST\",\n\t\t\t\tmethod:      \"PUT\",\n\t\t\t\turl:         $form.attr('action') + \".json\",\n\t\t\t\tdata:        data,\n\t\t\t\tdataType:    \"json\",\n\t\t\t\tcontentType: \"application/json; charset=utf-8\"\n\t\t\t})\n\t\t\t\t.done(function(response, textStatus, jqXHR) {\n\t\t\t\t\t$form.prop('disabled', false);\n\t\t\t\t\t$(widget.options.selector['submit']).prop('disabled', false);\n\n\t\t\t\t\tif (typeof response !== \"object\")\n\t\t\t\t\t{\n\t\t\t\t\t\ttry\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tresponse = jQuery.parseJSON(response);\n\t\t\t\t\t\t}\n\t\t\t\t\t\tcatch (exception)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tconsole.log(\"Post submission returned unpredictable response. Refreshing.\");\n\t\t\t\t\t\t\twindow.location.reload();\n\t\t\t\t\t\t\treturn;\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\n\t\t\t\t\t// This event trigger will cascade effects with our supplemental Messenger information.\n\t\t\t\t\tif (response.messenger)\n\t\t\t\t\t{\n\t\t\t\t\t\t$(window).trigger('messenger', response);\n\t\t\t\t\t\tvar json = response.data;\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tvar json = response;\n\t\t\t\t\t}\n\n\t\t\t\t\tif (typeof json.redirect !== \"undefined\")\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.log(\"Post submitted. Redirecting.\");\n\t\t\t\t\t\twindow.location = json.redirect;\n\t\t\t\t\t}\n\t\t\t\t\telse if (typeof json.errors !== \"undefined\")\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.log(\"Post rejected.\");\n\n\t\t\t\t\t\tjQuery.each(json.errors, function(field, errors)\n\t\t\t\t\t\t{\n\t\t\t\t\t\t\tjQuery.each(errors, function(index, error)\n\t\t\t\t\t\t\t{\n\t\t\t\t\t\t\t\twidget.notices.push(error, 'error');\n\t\t\t\t\t\t\t});\n\t\t\t\t\t\t});\n\t\t\t\t\t}\n\t\t\t\t\telse if (autoupdater !== false)\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.log(\"Post submitted. Inline updating.\");\n\n\t\t\t\t\t\tclearInterval(autoupdater.updateTimer);\n\n\t\t\t\t\t\tjqXHR.widget = autoupdater;\n\t\t\t\t\t\tautoupdater.updating    = true;\n\t\t\t\t\t\tautoupdater.updateTimer = false;\n\t\t\t\t\t\tautoupdater.updateAsked = parseInt(parseInt(Date.now(), 10) / 1000, 10);\n\t\t\t\t\t\tautoupdater.events.updateSuccess(json, textStatus, jqXHR, true);\n\t\t\t\t\t\tautoupdater.events.updateComplete(json, textStatus, jqXHR);\n\n\t\t\t\t\t\twidget.events.formClear(event);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\tconsole.log(\"Post submitted. No autoupdater. Refreshing.\");\n\t\t\t\t\t\twindow.location.reload();\n\t\t\t\t\t}\n\t\t\t\t});\n\n\t\t\tevent.preventDefault();\n\t\t\treturn false;\n\t\t},\n\n\t\tmaximizeClick : function(event) {\n\t\t\tvar widget  = event.data.widget;\n\t\t\tvar $widget = event.data.$widget;\n\n\t\t\t// Tweak classes.\n\t\t\t$widget\n\t\t\t\t.removeClass(\"postbox-minimized postbox-closed\")\n\t\t\t\t.addClass(\"postbox-maximized\");\n\n\t\t\t// Remove jQuery UI widgets.\n\t\t\twidget.unbindDraggable();\n\t\t\twidget.unbindResize();\n\t\t},\n\n\t\tmessenger     : function(event, messages) {\n\t\t\tif (messages.messenger)\n\t\t\t{\n\t\t\t\tib.getInstances('postbox').each(function()\n\t\t\t\t{\n\t\t\t\t\tvar widget  = this.widget;\n\t\t\t\t\tvar $widget = widget.$widget;\n\n\t\t\t\t\t// Toggles captcha based on messenger information.\n\t\t\t\t\tif (messages.captcha)\n\t\t\t\t\t{\n\t\t\t\t\t\twidget.events.captchaShow(widget);\n\t\t\t\t\t\t$(widget.options.selector['captcha-row'], $widget)\n\t\t\t\t\t\t\t.trigger('load', messages.captcha);\n\t\t\t\t\t}\n\t\t\t\t\telse\n\t\t\t\t\t{\n\t\t\t\t\t\twidget.events.captchaHide(widget);\n\t\t\t\t\t}\n\t\t\t\t});\n\t\t\t}\n\t\t},\n\n\t\tminimizeClick : function(event) {\n\t\t\tvar widget  = event.data.widget;\n\t\t\tvar $widget = event.data.$widget;\n\n\t\t\t// Tweak classes.\n\t\t\t$widget\n\t\t\t\t.removeClass(\"postbox-maximized postbox-closed\")\n\t\t\t\t.addClass(\"postbox-minimized\");\n\n\t\t\t// Rebind jQuery UI Resize.\n\t\t\twidget.bindDraggable();\n\t\t\twidget.bindResize();\n\t\t},\n\n\t\tpageChange    : function(event) {\n\t\t\twidget.options.checkFileUrl = window.app.board_url + \"check-file\";\n\t\t\twidget.dropzone.options.url = window.app.board_url + \"upload-file\";\n\t\t\twidget.dropzone.options.maxFilesize = window.app.settings.attachmentFilesize / 1024;\n\t\t},\n\n\t\tpostDragStop  : function(event, ui) {\n\t\t\tvar widget  = this.widget;\n\t\t\tvar $widget = this.widget.$widget;\n\n\t\t\tif (ib.ltr && widget.axis == \"sw\")\n\t\t\t{\n\t\t\t\t// Okay, so:\n\t\t\t\t// Our styling using top,right.\n\t\t\t\t// Draggable sets the position using top,left.\n\t\t\t\t// This causes the box to expand to the right when dragging with the resize handles.\n\t\t\t\t// Because you cannot drag to expand and drag to move at the same time, it's safe\n\t\t\t\t// to fix the right/left assignent after the drag has stopped.\n\t\t\t\t// This uses little jQuery as well which is just gravy.\n\t\t\t\tvar rect  = this.getBoundingClientRect();\n\t\t\t\tvar right = (document.body.clientWidth - rect.right);\n\n\t\t\t\tif (rect.top <= 80 && right <= 40)\n\t\t\t\t{\n\t\t\t\t\tright = 10;\n\t\t\t\t\tthis.style.top = 45 + \"px\";\n\t\t\t\t}\n\n\t\t\t\tthis.style.height = \"auto\";\n\t\t\t\tthis.style.left   = \"auto\";\n\t\t\t\tthis.style.right  = right + \"px\";\n\t\t\t}\n\t\t},\n\n\t\tpostKeyDown  : function(event) {\n\t\t\tvar widget  = event.data.widget;\n\t\t\tvar $widget = event.data.$widget;\n\n\t\t\t// Captures CTRL+ENTER\n\t\t\tif ((event.keyCode == 10 || event.keyCode == 13) && event.ctrlKey)\n\t\t\t{\n\t\t\t\t$(widget.options.selector['submit-post'], $widget)\n\t\t\t\t\t.trigger('click');\n\n\t\t\t\tevent.preventDefault();\n\t\t\t\treturn false;\n\t\t\t}\n\t\t},\n\n\t\tpostResize    : function(event, ui) {\n\t\t\tvar widget  = this.widget;\n\t\t\tvar $widget = this.widget.$widget;\n\n\t\t\tvar $post = $(this);\n\n\t\t\tui.position.top  = 0;\n\t\t\tui.position.left = 0;\n\n\t\t\tvar formHangY   = window.innerHeight - ($widget.position().top + widget.$widget.outerHeight());\n\t\t\tui.size.width   = Math.min(ui.size.width, $widget.width());\n\t\t\tui.size.height += Math.min(0, formHangY);\n\n\t\t\twidget.$widget.css({\n\t\t\t\t'height' : formHangY > 0 ? \"auto\" : window.innerHeight - $widget.position().top\n\t\t\t});\n\n\t\t\t$post.css('width', ui.size.width);\n\t\t\t$post.children().first().css('width', \"100%\");\n\n\t\t\treturn ui;\n\t\t},\n\n\t\tpostResizeStart : function(event, ui) {\n\t\t\tvar widget  = this.widget;\n\t\t\tvar $widget = this.widget.$widget;\n\t\t\tvar axis    = $(this).data('ui-resizable').axis;\n\n\t\t\tif (widget.axis != axis)\n\t\t\t{\n\t\t\t\tvar rect  = this.getBoundingClientRect();\n\n\t\t\t\tif (widget.axis == \"sw\")\n\t\t\t\t{\n\t\t\t\t\t$widget[0].style.left  = rect.left + \"px\";\n\t\t\t\t\t$widget[0].style.right = \"auto\";\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tpostResizeStop  : function(event, ui) {\n\t\t\tvar widget  = this.widget;\n\t\t\tvar $widget = this.widget.$widget;\n\t\t\tvar axis    = $(this).data('ui-resizable').axis;\n\n\t\t\tif (widget.axis != axis)\n\t\t\t{\n\t\t\t\tvar rect  = this.getBoundingClientRect();\n\n\t\t\t\tif (widget.axis == \"sw\")\n\t\t\t\t{\n\t\t\t\t\tvar right = (document.body.clientWidth - rect.right);\n\n\t\t\t\t\t$widget[0].style.left  = \"auto\";\n\t\t\t\t\t$widget[0].style.right = right + \"px\";\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\n\t\tspoilerChange : function(event) {\n\t\t\tvar $this = $(this);\n\t\t\tvar $next = $this.next();\n\n\t\t\t$this.next().attr('value', $this.prop('checked') ? 1 : 0);\n\t\t},\n\n\t\twindowResize  : function(event) {\n\t\t\t// For some pathetic reason, the jQery UI Resize widget uses the \"resize\"\n\t\t\t// event name, which is also an HTML default for window resizes. Events fired\n\t\t\t// also bubble up to the window, so this gets called when the post box resizes too.\n\t\t\tif (event.target === window)\n\t\t\t{\n\t\t\t\tevent.data.widget.resizePostbox();\n\t\t\t}\n\t\t}\n\t},\n\n\t// Event bindings\n\tblueprint.prototype.bind = function() {\n\t\tvar widget  = this;\n\t\tvar $widget = this.$widget;\n\t\tvar data    = {\n\t\t\twidget  : widget,\n\t\t\t$widget : $widget\n\t\t};\n\n\t\t$(widget.options.selector['password'], $widget)\n\t\t\t.val(ib.settings.postbox.password.get());\n\n\t\t// Force the notices widget to be bound, and then record it.\n\t\t// We have to do this because the notices widget is a child within this widget.\n\t\t// The parent is bound first.\n\t\twidget.notices = window.ib.bindElement($(widget.options.selector['notices'])[0]);\n\n\t\tif (typeof window.Dropzone !== 'undefined')\n\t\t{\n\t\t\tvar dropzoneOptions = jQuery.extend({}, widget.options.dropzone);\n\t\t\tdropzoneOptions.widget  = widget;\n\t\t\tdropzoneOptions.$widget = $widget;\n\n\t\t\t$(widget.options.selector['dropzone'], $widget)\n\t\t\t\t.dropzone(dropzoneOptions);\n\t\t}\n\n\t\t$(window)\n\t\t\t.on('messenger.ib-postbox.', data, widget.events.messenger)\n\t\t\t.on('resize.ib-postbox',     data, widget.events.windowResize);\n\n\t\t// This will actually bind multiple times so make sure it only happens once.\n\t\tif (widget.initOnce !== true)\n\t\t{\n\t\t\t// Ensures window.app is current with dropzone stuff.\n\t\t\t//InstantClick.on(\"change\", data, widget.events.pageChange);\n\t\t}\n\n\t\t$widget\n\t\t\t// Watch for key downs as to capture ctrl+enter submission.\n\t\t\t// We don't die this to any particular item.\n\t\t\t.on(\n\t\t\t\t'keydown.ib-postbox',\n\t\t\t\tdata,\n\t\t\t\twidget.events.postKeyDown\n\t\t\t)\n\n\t\t\t// Watch for form size clicks\n\t\t\t.on(\n\t\t\t\t'click.ib-postbox',\n\t\t\t\tdata,\n\t\t\t\twidget.events.formClick\n\t\t\t)\n\t\t\t.on(\n\t\t\t\t'click.ib-postbox',\n\t\t\t\twidget.options.selector['button-close'],\n\t\t\t\tdata,\n\t\t\t\twidget.events.closeClick\n\t\t\t)\n\t\t\t.on(\n\t\t\t\t'click.ib-postbox',\n\t\t\t\twidget.options.selector['button-maximize'],\n\t\t\t\tdata,\n\t\t\t\twidget.events.maximizeClick\n\t\t\t)\n\t\t\t.on(\n\t\t\t\t'click.ib-postbox',\n\t\t\t\twidget.options.selector['button-minimize'],\n\t\t\t\tdata,\n\t\t\t\twidget.events.minimizeClick\n\t\t\t)\n\n\t\t\t// Watch field changes\n\t\t\t.on(\n\t\t\t\t'change.ib-postbox',\n\t\t\t\twidget.options.selector['form-body'],\n\t\t\t\tdata,\n\t\t\t\twidget.events.bodyChange\n\t\t\t)\n\t\t\t.on(\n\t\t\t\t'keyup.ib-postbox',\n\t\t\t\twidget.options.selector['form-body'],\n\t\t\t\tdata,\n\t\t\t\twidget.events.bodyChange\n\t\t\t)\n\t\t\t.on(\n\t\t\t\t'change.ib-postbox',\n\t\t\t\twidget.options.selector['form-spoiler'],\n\t\t\t\tdata,\n\t\t\t\twidget.events.spoilerChange\n\t\t\t)\n\n\t\t\t// Watch form submission.\n\t\t\t.on(\n\t\t\t\t'submit.ib-postbox',\n\t\t\t\tdata,\n\t\t\t\twidget.events.formSubmit\n\t\t\t)\n\n\t\t\t// Watch for file statuses.\n\t\t\t.on(\n\t\t\t\t'fileFailed.ib-postbox',\n\t\t\t\tdata,\n\t\t\t\twidget.events.fileFailed\n\t\t\t)\n\t\t\t.on(\n\t\t\t\t'fileCanceled.ib-postbox',\n\t\t\t\tdata,\n\t\t\t\twidget.events.fileCanceled\n\t\t\t)\n\t\t\t.on(\n\t\t\t\t'fileUploaded.ib-postbox',\n\t\t\t\tdata,\n\t\t\t\twidget.events.fileUploaded\n\t\t\t)\n\t\t\t.on(\n\t\t\t\t'fileUploading.ib-postbox',\n\t\t\t\tdata,\n\t\t\t\twidget.events.fileUploading\n\t\t\t)\n\t\t;\n\n\t\twidget.bindCounter();\n\t\twidget.bindDraggable();\n\t\twidget.bindResize();\n\t};\n\n\tblueprint.prototype.bindCounter = function() {\n\t\tvar widget   = this;\n\t\tvar $widget  = this.$widget;\n\t\tvar $body    = $(widget.options.selector['form-body'], widget.$widget);\n\t\tvar $counter = $(widget.options.template['counter']);\n\n\t\t$counter.insertAfter($body);\n\t\twidget.$counter = $counter;\n\t\t$body.trigger('change');\n\t};\n\n\tblueprint.prototype.bindDraggable = function() {\n\t\tvar widget   = this;\n\t\tvar $widget  = this.$widget;\n\n\t\tif (window.innerHeight >= 480 && window.innerWidth >= 728)\n\t\t{\n\t\t\t$widget.draggable({\n\t\t\t\tcontainment : \"window\",\n\t\t\t\thandle      : \"legend.form-legend\",\n\t\t\t\tstop        : widget.events.postDragStop\n\t\t\t});\n\n\t\t\twidget.draggable = true;\n\t\t}\n\t};\n\n\tblueprint.prototype.bindResize = function() {\n\t\tvar widget   = this;\n\t\tvar $widget  = this.$widget;\n\n\t\tif (window.innerHeight >= 480 && window.innerWidth >= 728)\n\t\t{\n\t\t\t// Bind resizability onto the post area.\n\t\t\tvar $body   = $(widget.options.selector['form-body'], $widget);\n\n\t\t\tif (!widget.resizable && $body.length && typeof $body.resizable === \"function\")\n\t\t\t{\n\t\t\t\t$body.resizable({\n\t\t\t\t\thandles:     \"sw,se\",\n\t\t\t\t\tresize:      widget.events.postResize,\n\t\t\t\t\tstart:       widget.events.postResizeStart,\n\t\t\t\t\tstop:        widget.events.postResizeStop,\n\t\t\t\t\talsoResize:  widget.$widget,\n\t\t\t\t\tminWidth:    300,\n\t\t\t\t\tminHeight:   26\n\t\t\t\t});\n\n\t\t\t\t// This gives the jQuery UI events a scope back to the widget.\n\t\t\t\tvar jWidget = $body.resizable(\"widget\")[0];\n\t\t\t\tjWidget.widget  = widget;\n\t\t\t\tjWidget.$widget = $widget;\n\n\t\t\t\t$widget\n\t\t\t\t\t.resizable({\n\t\t\t\t\t\thandles:  null,\n\t\t\t\t\t\tminWidth: 300\n\t\t\t\t\t})\n\t\t\t\t\t.css({\n\t\t\t\t\t\theight: \"auto\"\n\t\t\t\t\t});\n\n\t\t\t\twidget.resizable = true;\n\t\t\t}\n\t\t}\n\t};\n\n\tblueprint.prototype.unbindCounter = function() {\n\t\tvar widget   = this;\n\n\t\tif (widget.$counter && widget.$counter instanceof jQuery)\n\t\t{\n\t\t\twidget.$counter.remove();\n\t\t}\n\t};\n\n\tblueprint.prototype.unbindDraggable = function() {\n\t\tvar widget   = this;\n\t\tvar $widget  = this.$widget;\n\n\t\tif (widget.draggable && typeof $widget.draggable === \"function\")\n\t\t{\n\t\t\t$widget.draggable( \"destroy\" ).attr('style', \"\");\n\n\t\t\twidget.draggable = false;\n\t\t}\n\t};\n\n\tblueprint.prototype.unbindResize = function() {\n\t\tvar widget   = this;\n\t\tvar $widget  = this.$widget;\n\n\t\t// Bind resizability onto the post area.\n\t\tvar $body = $(widget.options.selector['form-body'], widget.$widget);\n\n\t\tif (widget.resizable && $body.length && typeof $body.resizable === \"function\")\n\t\t{\n\t\t\t$body.resizable( \"destroy\" ).attr('style', \"\");\n\n\t\t\t$widget.resizable( \"destroy\" ).attr('style', \"\");\n\n\t\t\twidget.resizable = false;\n\t\t}\n\t};\n\n\tib.widget(\"postbox\", blueprint, options);\n\tib.settings.postbox.password.setInitial(false);\n\n\t$(document).on('ready.ib-postbox', function(event) {\n\t\t// Bit of a hack.\n\t\t// Sets form values to our password by default even outside\n\t\t// of the scope of a thread.\n\t\t$(blueprint.prototype.defaults.selector['post-password'])\n\t\t\t.val(ib.settings['postbox']['password'].get());\n\t});\n})(window, window.jQuery);\n","// ===========================================================================\n// Purpose          : Custom Styling\n// Contributors     : jaw-sh\n// Widget Version   : 2\n// ===========================================================================\n\n(function(window, $, undefined) {\n\t// Widget blueprint\n\tvar blueprint = ib.getBlueprint();\n\t\n\t// Configuration options\n\tvar options = {\n\t\ttheme : {\n\t\t\tdefault : \"\",\n\t\t\ttype    : \"select\",\n\t\t\tvalues  : [\n\t\t\t\t\"\",\n\t\t\t\t\"next-yotsuba.css\",\n\t\t\t\t\"next-dark.css\",\n\t\t\t\t\"next-tomorrow.css\",\n\t\t\t\t\"kappa-burichan.css\",\n\t\t\t],\n\t\t\tonChange : function(event) {\n\t\t\t\tvar setting = event.data.setting.get();\n\t\t\t\tvar domObj  = document.getElementById('theme-stylesheet');\n\t\t\t\t\n\t\t\t\tif (setting)\n\t\t\t\t{\n\t\t\t\t\tdomObj.href = window.app.url + \"/static/css/skins/\" + setting;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tdomObj.href = \"\";\n\t\t\t\t}\n\t\t\t},\n\t\t\tonUpdate : function(event) {\n\t\t\t\tvar setting = event.data.setting.get();\n\t\t\t\tvar domObj  = document.getElementById('theme-stylesheet');\n\t\t\t\t\n\t\t\t\tif (setting)\n\t\t\t\t{\n\t\t\t\t\tdomObj.href = window.app.url + \"/static/css/skins/\" + setting;\n\t\t\t\t}\n\t\t\t\telse\n\t\t\t\t{\n\t\t\t\t\tdomObj.href = \"\";\n\t\t\t\t}\n\t\t\t}\n\t\t},\n\t\t\n\t\tcss : {\n\t\t\tdefault : \"\",\n\t\t\ttype    : \"textarea\",\n\t\t\tonChange : function(event) {\n\t\t\t\tvar setting = event.data.setting.get();\n\t\t\t\tvar domObj  = document.getElementById('user-css');\n\t\t\t\tdomObj.innerHTML = setting;\n\t\t\t},\n\t\t\tonUpdate : function(event) {\n\t\t\t\tvar setting = event.data.setting.get();\n\t\t\t\tvar domObj  = document.getElementById('user-css');\n\t\t\t\tdomObj.innerHTML = setting;\n\t\t\t}\n\t\t}\n\t};\n\t\n\tib.widget(\"stylist\", blueprint, options);\n})(window, window.jQuery);\n","// ===========================================================================\n// Purpose          : Timestamp Configuration\n// Contributors     : jaw-sh\n// Widget Version   : 2\n// ===========================================================================\n\n(function(window, $, undefined) {\n\t// Widget blueprint\n\tvar blueprint = ib.getBlueprint();\n\t\n\t// Configuration options\n\tvar options = {\n\t\t// Date Format\n\t\tformat : {\n\t\t\ttype : \"select\",\n\t\t\tinitial : \"YYYY-MMM-DD HH:MM:SS\",\n\t\t\tvalues : [\n\t\t\t\t'YYYY-MMM-DD HH:MM:SS',\n\t\t\t\t'MM/DD/YY(DDD)HH:MM:SS'\n\t\t\t],\n\t\t\tonChange : function(event) {\n\t\t\t\t// On setting update, trigger reformating..\n\t\t\t\tvar setting = event.data.setting;\n\t\t\t\tvar widget  = setting.widget;\n\t\t\t\tib.getInstances(widget).trigger('reformat.ib-time');\n\t\t\t},\n\t\t\tonUpdate : function(event) {\n\t\t\t\t// On storage update, trigger reformating.\n\t\t\t\tvar setting = event.data.setting;\n\t\t\t\tvar widget  = setting.widget;\n\t\t\t\t\n\t\t\t\tfor (var i = 0; i < ib.widgets[widget].instances.length; ++i)\n\t\t\t\t{\n\t\t\t\t\tvar instance = ib.widgets[widget].instances[i];\n\t\t\t\t\tinstance.$widget.trigger('reformat.ib-time');\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\t};\n\t\n\t// Main Widget Initialization Binding\n\tblueprint.prototype.bind = function() {\n\t\tvar data = {\n\t\t\twidget  : this,\n\t\t\t$widget : this.$widget\n\t\t};\n\t\t\n\t\tthis.$widget\n\t\t\t.on('reformat.ib-time', data, this.events.timeReformat)\n\t\t\t.trigger('reformat.ib-time');\n\t};\n\t\n\t// Event hooks\n\tblueprint.prototype.events = {\n\t\t// Reformat timestamps on command.\n\t\ttimeReformat : function(event) {\n\t\t\t// Fetch our existing information.\n\t\t\tvar widget = event.data.widget;\n\t\t\tvar text   = event.data.$widget.text();\n\t\t\tvar time   = new Date(event.data.$widget.attr('datetime'));\n\t\t\t\n\t\t\tvar y = ib.lpad(time.getFullYear(), 2, \"0\");\n\t\t\tvar m = ib.lpad(time.getMonth() + 1, 2, \"0\");\n\t\t\tvar d = ib.lpad(time.getDate(), 2, \"0\");\n\t\t\tvar hour = ib.lpad(time.getHours(), 2, \"0\");\n\t\t\tvar min  = ib.lpad(time.getMinutes(), 2, \"0\");\n\t\t\tvar sec  = ib.lpad(time.getSeconds(), 2, \"0\");\n\t\t\t\n\t\t\tswitch (widget.get('format'))\n\t\t\t{\n\t\t\t\tcase 'YYYY-MMM-DD HH:MM:SS' :\n\t\t\t\t\t// Translate 0 into Dec\n\t\t\t\t\tm = ib.trans(\"time.calendar.abbrevmonths.\"+time.getMonth());\n\t\t\t\t\ttext = y+\"-\"+m+\"-\"+d+\" \"+hour+\":\"+min+\":\"+sec;\n\t\t\t\t\tbreak;\n\t\t\t\t\n\t\t\t\tcase 'MM/DD/YY(DDD)HH:MM:SS' :\n\t\t\t\t\tvar dow = time.getDay();\n\t\t\t\t\tdow = ib.trans(\"time.calendar.abbrevdays.\" + dow);\n\t\t\t\t\t\n\t\t\t\t\ttext = m+\"/\"+d+\"/\"+y+\"(\"+dow+\")\"+hour+\":\"+min+\":\"+sec;\n\t\t\t\t\tbreak;\n\t\t\t\t\n\t\t\t\tdefault :\n\t\t\t\t\tconsole.log(\"Invalid format \\\"\"+this.get('format')+\"\\\"\");\n\t\t\t\t\tbreak;\n\t\t\t}\n\t\t\t\n\t\t\tevent.data.$widget.text(text);\n\t\t}\n\t};\n\t\n\tib.widget(\"time\", blueprint, options);\n})(window, window.jQuery);\n"],"sourceRoot":"/source/"}